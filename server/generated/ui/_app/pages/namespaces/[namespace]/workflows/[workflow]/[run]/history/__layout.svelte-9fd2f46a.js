var ie=Object.defineProperty,ue=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var U=(s,e,t)=>e in s?ie(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,H=(s,e)=>{for(var t in e||(e={}))Q.call(e,t)&&U(s,t,e[t]);if(C)for(var t of C(e))z.call(e,t)&&U(s,t,e[t]);return s},W=(s,e)=>ue(s,de(e));var X=(s,e)=>{var t={};for(var r in s)Q.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&C)for(var r of C(s))e.indexOf(r)<0&&z.call(s,r)&&(t[r]=s[r]);return t};import{az as me,S as J,i as B,s as V,N as ge,e as q,j as I,c as P,a as R,m as b,d as w,b as y,R as D,f as L,o as $,U as pe,x as _,u as v,v as j,G as Y,aa as he,aA as we,Q as _e,I as Z,K as x,L as A,M as ee,y as te,t as ve,k as T,g as ke,n as N,J as E,aB as ye,aC as Ie,aD as be}from"../../../../../../../chunks/vendor-b93e428e.js";import{r as S}from"../../../../../../../chunks/route-for-c019a53c.js";import{h as $e,b as K,r as se,a as ne}from"../../../../../../../chunks/route-for-api-897023e4.js";import{d as je,s as re,a as Ee}from"../../../../../../../chunks/data-converter-config-fb390bf1.js";import{r as Oe}from"../../../../../../../chunks/refreshable-9bcf1376.js";import{p as qe}from"../../../../../../../chunks/stores-668dfc14.js";import{a as oe}from"../../../../../../../chunks/append-query-parameters-b8619cc0.js";import{g as Pe}from"../../../../../../../chunks/get-context-97f7fcbb.js";import"../../../../../../../chunks/notifications-f504753b.js";const ae=(s={},e={})=>{const t=H({},s);for(const r of Object.keys(e)){const o=t[r];Array.isArray(o)?t[r]=t[r].concat(e[r]):typeof o=="object"&&!Array.isArray(o)?t[r]=ae(t[r],e[r]):t[r]=e[r]}return t},M=async(s,{onStart:e,onUpdate:t,onComplete:r,onError:o=$e,token:a,previousProps:c}={})=>{!c&&K(e)&&e();try{const n=await s(a),{nextPageToken:f}=n,h=X(n,["nextPageToken"]),g=ae(c,h);return K(t)&&t(g,h),f?M(s,{onStart:e,onUpdate:t,onComplete:r,token:f,previousProps:g}):(K(r)&&r(g),g)}catch(l){o(l)}},Re=s=>{if(!s)return{configured:!1,isOpened:()=>!1,open:()=>null,decode:n=>Promise.resolve(n)};const e=document.createElement("iframe");e.style.display="none",document.body.appendChild(e);const t=new Promise(n=>{e.src=s+"/js",e.addEventListener("load",()=>n(!0))});let r;window.addEventListener("message",n=>{if(n.origin==s)switch(n.data.type){case"data_encoder_ready":r=n.source;break;case"encoded":case"decoded":a[n.data.requestId](n.data.payload),delete a[n.data.requestId];break}});let o=0;const a={},c=()=>o+=1;return{configured:!0,isOpened:()=>!!r,open:()=>t,decode:async n=>{const l=c();return new Promise(f=>{a[l]=f,r.postMessage({requestId:l,type:"decode",payload:n},{targetOrigin:s})})}}};var le;const De=(le=me(je))!=null?le:null,ce=Re(De);async function Se(s,e){if(!e.isOpened())try{await e.open()}catch{re()}return e.isOpened()?e.decode(s).then(r=>(Ee(),r)).catch(()=>(re(),s)):Promise.resolve(s)}function F(s){const e=window.atob(String(s.metadata.encoding));switch(s.metadata.encodingDecoded=e,e){case"json/plain":case"json/protobuf":try{return JSON.parse(window.atob(String(s.data)))}catch{}}return s}const Fe=async s=>{var r,o,a,c,n,l,f,h,g,k,m,u;const e=s,t=(c=(a=(r=e==null?void 0:e.input)==null?void 0:r.payloads)!=null?a:(o=e==null?void 0:e.result)==null?void 0:o.payloads)!=null?c:null;if(t){let i,d;ce.configured&&(d=ce),(d==null?void 0:d.configured)?i=(await Promise.all((t!=null?t:[]).map(async O=>await Se(O,d)))).map(F):i=t.map(F),((n=e==null?void 0:e.input)==null?void 0:n.payloads)&&(e.input.payloads=i),((l=e==null?void 0:e.result)==null?void 0:l.payloads)&&(e.result.payloads=i)}if((f=e==null?void 0:e.searchAttributes)==null?void 0:f.indexedFields){const i=(h=e==null?void 0:e.searchAttributes)==null?void 0:h.indexedFields;Object.entries(i).forEach(([d,p])=>{i[d]=F(p)})}if((g=e==null?void 0:e.memo)==null?void 0:g.fields){const i=(k=e==null?void 0:e.memo)==null?void 0:k.fields;Object.entries(i).forEach(([d,p])=>{i[d]=F(p)})}if((m=e==null?void 0:e.header)==null?void 0:m.fields){const i=(u=e==null?void 0:e.header)==null?void 0:u.fields;Object.entries(i).forEach(([d,p])=>{i[d]=F(p)})}if(e==null?void 0:e.queryResult){const i=e==null?void 0:e.queryResult;Object.entries(i).forEach(([d,p])=>{i[d]=F(p)})}return e};async function Le(s){const e=Object.keys(s).find(r=>r.includes("Attributes")),t=await Fe(s[e]);return H({type:e},t)}const Te=async s=>Promise.all(s.history.events.map(async e=>W(H({},e),{id:String(e.eventId),eventType:e.eventType,attributes:await Le(e)}))),fe=async({namespace:s,executionId:e,runId:t,onStart:r,onUpdate:o,onComplete:a},c=fetch)=>await M(async l=>se(ne("events",{namespace:s,executionId:e,runId:t}),{token:l,request:c}),{onStart:r,onUpdate:o,onComplete:a}).then(Te),Ne=async({namespace:s,executionId:e,runId:t,onStart:r,onUpdate:o,onComplete:a},c=fetch)=>(await M(async l=>se(ne("events",{namespace:s,executionId:e,runId:t}),{token:l,request:c}),{onStart:r,onUpdate:o,onComplete:a})).history.events;function Ce(s){let e,t,r,o,a,c;return t=new ge({props:{icon:s[0],scale:s[2]}}),{c(){e=q("a"),I(t.$$.fragment),this.h()},l(n){e=P(n,"A",{class:!0,href:!0});var l=R(e);b(t.$$.fragment,l),l.forEach(w),this.h()},h(){y(e,"class","border-2 py-2 px-4 hover:text-white hover:bg-gray-600 flex items-center justify-center svelte-1orl6nd"),y(e,"href",r=oe(s[3],s[4].query)),D(e,"rounded-lg",!s[1]),D(e,"active",s[4].path.includes(s[3])),D(e,"group",s[1])},m(n,l){L(n,e,l),$(t,e,null),o=!0,a||(c=pe(e,"click",s[5]),a=!0)},p(n,[l]){const f={};l&1&&(f.icon=n[0]),l&4&&(f.scale=n[2]),t.$set(f),(!o||l&24&&r!==(r=oe(n[3],n[4].query)))&&y(e,"href",r),l&2&&D(e,"rounded-lg",!n[1]),l&24&&D(e,"active",n[4].path.includes(n[3])),l&2&&D(e,"group",n[1])},i(n){o||(_(t.$$.fragment,n),o=!0)},o(n){v(t.$$.fragment,n),o=!1},d(n){n&&w(e),j(t),a=!1,c()}}}function He(s,e,t){let r;Y(s,qe,f=>t(4,r=f));let{icon:o}=e,{group:a=Pe("group")}=e,{scale:c=1}=e,{href:n="#"}=e;function l(f){he.call(this,s,f)}return s.$$set=f=>{"icon"in f&&t(0,o=f.icon),"group"in f&&t(1,a=f.group),"scale"in f&&t(2,c=f.scale),"href"in f&&t(3,n=f.href)},[o,a,c,n,r,l]}class G extends J{constructor(e){super();B(this,e,He,Ce,V,{icon:0,group:1,scale:2,href:3})}}function Je(s){let e,t;return e=new G({props:{icon:we}}),e.$on("click",s[0]),{c(){I(e.$$.fragment)},l(r){b(e.$$.fragment,r)},m(r,o){$(e,r,o),t=!0},p:_e,i(r){t||(_(e.$$.fragment,r),t=!0)},o(r){v(e.$$.fragment,r),t=!1},d(r){j(e,r)}}}function Be(s,e,t){const r=async()=>{const n=await Ne({namespace:o,executionId:a,runId:c}),l=JSON.stringify(n,null,2);f(l,`${c}/events.json`,"text/plain");function f(h,g,k){const m=document.createElement("a"),u=new Blob([h],{type:k});m.href=URL.createObjectURL(u),m.download=g,m.click()}};let{namespace:o}=e,{workflowId:a}=e,{runId:c}=e;return s.$$set=n=>{"namespace"in n&&t(1,o=n.namespace),"workflowId"in n&&t(2,a=n.workflowId),"runId"in n&&t(3,c=n.runId)},[r,o,a,c]}class Ve extends J{constructor(e){super();B(this,e,Be,Je,V,{namespace:1,workflowId:2,runId:3})}}function Ge(s){let e,t;const r=s[1].default,o=Z(r,s,s[0],null);return{c(){e=q("div"),o&&o.c(),this.h()},l(a){e=P(a,"DIV",{class:!0});var c=R(e);o&&o.l(c),c.forEach(w),this.h()},h(){y(e,"class","flex")},m(a,c){L(a,e,c),o&&o.m(e,null),t=!0},p(a,[c]){o&&o.p&&(!t||c&1)&&x(o,r,a,a[0],t?ee(r,a[0],c,null):A(a[0]),null)},i(a){t||(_(o,a),t=!0)},o(a){v(o,a),t=!1},d(a){a&&w(e),o&&o.d(a)}}}function Ke(s,e,t){let{$$slots:r={},$$scope:o}=e;return te("group",!0),s.$$set=a=>{"$$scope"in a&&t(0,o=a.$$scope)},[o,r]}class Me extends J{constructor(e){super();B(this,e,Ke,Ge,V,{})}}function Qe(s){let e,t,r,o,a,c;return e=new G({props:{icon:ye,href:S("workflow.events.full",s[0])}}),r=new G({props:{icon:Ie,href:S("workflow.events.compact",s[0])}}),a=new G({props:{icon:be,href:S("workflow.events.json",s[0])}}),{c(){I(e.$$.fragment),t=T(),I(r.$$.fragment),o=T(),I(a.$$.fragment)},l(n){b(e.$$.fragment,n),t=N(n),b(r.$$.fragment,n),o=N(n),b(a.$$.fragment,n)},m(n,l){$(e,n,l),L(n,t,l),$(r,n,l),L(n,o,l),$(a,n,l),c=!0},p(n,l){const f={};l&1&&(f.href=S("workflow.events.full",n[0])),e.$set(f);const h={};l&1&&(h.href=S("workflow.events.compact",n[0])),r.$set(h);const g={};l&1&&(g.href=S("workflow.events.json",n[0])),a.$set(g)},i(n){c||(_(e.$$.fragment,n),_(r.$$.fragment,n),_(a.$$.fragment,n),c=!0)},o(n){v(e.$$.fragment,n),v(r.$$.fragment,n),v(a.$$.fragment,n),c=!1},d(n){j(e,n),n&&w(t),j(r,n),n&&w(o),j(a,n)}}}function ze(s){let e,t,r,o,a,c,n,l,f,h,g;n=new Me({props:{$$slots:{default:[Qe]},$$scope:{ctx:s}}}),f=new Ve({props:{namespace:s[1].namespace,workflowId:s[1].executionId,runId:s[1].runId}});const k=s[4].default,m=Z(k,s,s[5],null);return{c(){e=q("section"),t=q("nav"),r=q("h3"),o=ve("Event History"),a=T(),c=q("div"),I(n.$$.fragment),l=T(),I(f.$$.fragment),h=T(),m&&m.c(),this.h()},l(u){e=P(u,"SECTION",{class:!0});var i=R(e);t=P(i,"NAV",{class:!0});var d=R(t);r=P(d,"H3",{class:!0});var p=R(r);o=ke(p,"Event History"),p.forEach(w),a=N(d),c=P(d,"DIV",{class:!0});var O=R(c);b(n.$$.fragment,O),l=N(O),b(f.$$.fragment,O),O.forEach(w),d.forEach(w),h=N(i),m&&m.l(i),i.forEach(w),this.h()},h(){y(r,"class","text-lg font-medium"),y(c,"class","flex gap-4"),y(t,"class","flex gap-4 justify-between items-end"),y(e,"class","flex flex-col gap-4")},m(u,i){L(u,e,i),E(e,t),E(t,r),E(r,o),E(t,a),E(t,c),$(n,c,null),E(c,l),$(f,c,null),E(e,h),m&&m.m(e,null),g=!0},p(u,[i]){const d={};i&33&&(d.$$scope={dirty:i,ctx:u}),n.$set(d);const p={};i&2&&(p.namespace=u[1].namespace),i&2&&(p.workflowId=u[1].executionId),i&2&&(p.runId=u[1].runId),f.$set(p),m&&m.p&&(!g||i&32)&&x(m,k,u,u[5],g?ee(k,u[5],i,null):A(u[5]),null)},i(u){g||(_(n.$$.fragment,u),_(f.$$.fragment,u),_(m,u),g=!0)},o(u){v(n.$$.fragment,u),v(f.$$.fragment,u),v(m,u),g=!1},d(u){u&&w(e),j(n),j(f),m&&m.d(u)}}}async function rt({page:s}){const{workflow:e,run:t,namespace:r}=s.params,o={namespace:r,executionId:e,runId:t};return await fe(o),{props:{workflow:{workflowId:e,runId:t,namespace:r},parameters:o}}}function Ue(s,e,t){let r,{$$slots:o={},$$scope:a}=e,{workflow:c}=e,{parameters:n}=e,l=Oe(()=>fe(n));return Y(s,l,f=>t(3,r=f)),s.$$set=f=>{"workflow"in f&&t(0,c=f.workflow),"parameters"in f&&t(1,n=f.parameters),"$$scope"in f&&t(5,a=f.$$scope)},s.$$.update=()=>{s.$$.dirty&8&&te("events",r)},[c,n,l,r,o,a]}class ot extends J{constructor(e){super();B(this,e,Ue,ze,V,{workflow:0,parameters:1})}}export{ot as default,rt as load};
