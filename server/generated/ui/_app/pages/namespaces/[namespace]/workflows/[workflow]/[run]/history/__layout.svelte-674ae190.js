var ce=Object.defineProperty,fe=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var U=(n,e,t)=>e in n?ce(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,H=(n,e)=>{for(var t in e||(e={}))z.call(e,t)&&U(n,t,e[t]);if(L)for(var t of L(e))M.call(e,t)&&U(n,t,e[t]);return n},W=(n,e)=>fe(n,le(e));var X=(n,e)=>{var t={};for(var s in n)z.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&L)for(var s of L(n))e.indexOf(s)<0&&M.call(n,s)&&(t[s]=n[s]);return t};import{az as ie,S as C,i as B,s as V,N as ue,e as S,j as y,c as P,a as D,m as $,d as w,b,R,f as T,o as j,U as me,x as _,u as v,v as I,G as Y,aa as de,aA as ge,Q as he,I as Z,K as x,L as A,M as ee,y as te,t as pe,k as N,g as we,n as J,J as E,aB as _e,aC as ve,aD as ke}from"../../../../../../../chunks/vendor-b93e428e.js";import{r as q}from"../../../../../../../chunks/route-for-c019a53c.js";import{h as be,b as K,r as ne,a as se}from"../../../../../../../chunks/route-for-api-897023e4.js";import{s as ye,a as $e,d as je}from"../../../../../../../chunks/data-encoder-config-4cc7ae8c.js";import{r as Ie}from"../../../../../../../chunks/refreshable-9bcf1376.js";import{p as Ee}from"../../../../../../../chunks/stores-668dfc14.js";import{a as oe}from"../../../../../../../chunks/append-query-parameters-b8619cc0.js";import{g as Oe}from"../../../../../../../chunks/get-context-97f7fcbb.js";import"../../../../../../../chunks/notifications-f504753b.js";const re=(n={},e={})=>{const t=H({},n);for(const s of Object.keys(e)){const r=t[s];Array.isArray(r)?t[s]=t[s].concat(e[s]):typeof r=="object"&&!Array.isArray(r)?t[s]=re(t[s],e[s]):t[s]=e[s]}return t},Q=async(n,{onStart:e,onUpdate:t,onComplete:s,onError:r=be,token:a,previousProps:c}={})=>{!c&&K(e)&&e();try{const o=await n(a),{nextPageToken:f}=o,p=X(o,["nextPageToken"]),d=re(c,p);return K(t)&&t(d,p),f?Q(n,{onStart:e,onUpdate:t,onComplete:s,token:f,previousProps:d}):(K(s)&&s(d),d)}catch(l){r(l)}};async function Se(n,e){return fetch(e+"/decode",{method:"POST",body:JSON.stringify(n)}).then(s=>s.json()).then(s=>(ye(),s)).catch(()=>($e(),n))}function F(n){const e=window.atob(String(n.metadata.encoding));switch(n.metadata.encodingDecoded=e,e){case"json/plain":case"json/protobuf":try{return JSON.parse(window.atob(String(n.data)))}catch{}}return n}const Pe=async n=>{var s,r,a,c,o,l,f,p,d,k,m,u;const e=n,t=(c=(a=(s=e==null?void 0:e.input)==null?void 0:s.payloads)!=null?a:(r=e==null?void 0:e.result)==null?void 0:r.payloads)!=null?c:null;if(t){let i;const g=ie(je);g?i=(await Promise.all((t!=null?t:[]).map(async O=>await Se(O,g)))).map(F):i=t.map(F),((o=e==null?void 0:e.input)==null?void 0:o.payloads)&&(e.input.payloads=i),((l=e==null?void 0:e.result)==null?void 0:l.payloads)&&(e.result.payloads=i)}if((f=e==null?void 0:e.searchAttributes)==null?void 0:f.indexedFields){const i=(p=e==null?void 0:e.searchAttributes)==null?void 0:p.indexedFields;Object.entries(i).forEach(([g,h])=>{i[g]=F(h)})}if((d=e==null?void 0:e.memo)==null?void 0:d.fields){const i=(k=e==null?void 0:e.memo)==null?void 0:k.fields;Object.entries(i).forEach(([g,h])=>{i[g]=F(h)})}if((m=e==null?void 0:e.header)==null?void 0:m.fields){const i=(u=e==null?void 0:e.header)==null?void 0:u.fields;Object.entries(i).forEach(([g,h])=>{i[g]=F(h)})}if(e==null?void 0:e.queryResult){const i=e==null?void 0:e.queryResult;Object.entries(i).forEach(([g,h])=>{i[g]=F(h)})}return e};async function De(n){const e=Object.keys(n).find(s=>s.includes("Attributes")),t=await Pe(n[e]);return H({type:e},t)}const Re=async n=>Promise.all(n.history.events.map(async e=>W(H({},e),{id:String(e.eventId),eventType:e.eventType,attributes:await De(e)}))),ae=async({namespace:n,executionId:e,runId:t,onStart:s,onUpdate:r,onComplete:a},c=fetch)=>await Q(async l=>ne(se("events",{namespace:n,executionId:e,runId:t}),{token:l,request:c}),{onStart:s,onUpdate:r,onComplete:a}).then(Re),qe=async({namespace:n,executionId:e,runId:t,onStart:s,onUpdate:r,onComplete:a},c=fetch)=>(await Q(async l=>ne(se("events",{namespace:n,executionId:e,runId:t}),{token:l,request:c}),{onStart:s,onUpdate:r,onComplete:a})).history.events;function Fe(n){let e,t,s,r,a,c;return t=new ue({props:{icon:n[0],scale:n[2]}}),{c(){e=S("a"),y(t.$$.fragment),this.h()},l(o){e=P(o,"A",{class:!0,href:!0});var l=D(e);$(t.$$.fragment,l),l.forEach(w),this.h()},h(){b(e,"class","border-2 py-2 px-4 hover:text-white hover:bg-gray-600 flex items-center justify-center svelte-1orl6nd"),b(e,"href",s=oe(n[3],n[4].query)),R(e,"rounded-lg",!n[1]),R(e,"active",n[4].path.includes(n[3])),R(e,"group",n[1])},m(o,l){T(o,e,l),j(t,e,null),r=!0,a||(c=me(e,"click",n[5]),a=!0)},p(o,[l]){const f={};l&1&&(f.icon=o[0]),l&4&&(f.scale=o[2]),t.$set(f),(!r||l&24&&s!==(s=oe(o[3],o[4].query)))&&b(e,"href",s),l&2&&R(e,"rounded-lg",!o[1]),l&24&&R(e,"active",o[4].path.includes(o[3])),l&2&&R(e,"group",o[1])},i(o){r||(_(t.$$.fragment,o),r=!0)},o(o){v(t.$$.fragment,o),r=!1},d(o){o&&w(e),I(t),a=!1,c()}}}function Te(n,e,t){let s;Y(n,Ee,f=>t(4,s=f));let{icon:r}=e,{group:a=Oe("group")}=e,{scale:c=1}=e,{href:o="#"}=e;function l(f){de.call(this,n,f)}return n.$$set=f=>{"icon"in f&&t(0,r=f.icon),"group"in f&&t(1,a=f.group),"scale"in f&&t(2,c=f.scale),"href"in f&&t(3,o=f.href)},[r,a,c,o,s,l]}class G extends C{constructor(e){super();B(this,e,Te,Fe,V,{icon:0,group:1,scale:2,href:3})}}function Ne(n){let e,t;return e=new G({props:{icon:ge}}),e.$on("click",n[0]),{c(){y(e.$$.fragment)},l(s){$(e.$$.fragment,s)},m(s,r){j(e,s,r),t=!0},p:he,i(s){t||(_(e.$$.fragment,s),t=!0)},o(s){v(e.$$.fragment,s),t=!1},d(s){I(e,s)}}}function Je(n,e,t){const s=async()=>{const o=await qe({namespace:r,executionId:a,runId:c}),l=JSON.stringify(o,null,2);f(l,`${c}/events.json`,"text/plain");function f(p,d,k){const m=document.createElement("a"),u=new Blob([p],{type:k});m.href=URL.createObjectURL(u),m.download=d,m.click()}};let{namespace:r}=e,{workflowId:a}=e,{runId:c}=e;return n.$$set=o=>{"namespace"in o&&t(1,r=o.namespace),"workflowId"in o&&t(2,a=o.workflowId),"runId"in o&&t(3,c=o.runId)},[s,r,a,c]}class Le extends C{constructor(e){super();B(this,e,Je,Ne,V,{namespace:1,workflowId:2,runId:3})}}function He(n){let e,t;const s=n[1].default,r=Z(s,n,n[0],null);return{c(){e=S("div"),r&&r.c(),this.h()},l(a){e=P(a,"DIV",{class:!0});var c=D(e);r&&r.l(c),c.forEach(w),this.h()},h(){b(e,"class","flex")},m(a,c){T(a,e,c),r&&r.m(e,null),t=!0},p(a,[c]){r&&r.p&&(!t||c&1)&&x(r,s,a,a[0],t?ee(s,a[0],c,null):A(a[0]),null)},i(a){t||(_(r,a),t=!0)},o(a){v(r,a),t=!1},d(a){a&&w(e),r&&r.d(a)}}}function Ce(n,e,t){let{$$slots:s={},$$scope:r}=e;return te("group",!0),n.$$set=a=>{"$$scope"in a&&t(0,r=a.$$scope)},[r,s]}class Be extends C{constructor(e){super();B(this,e,Ce,He,V,{})}}function Ve(n){let e,t,s,r,a,c;return e=new G({props:{icon:_e,href:q("workflow.events.full",n[0])}}),s=new G({props:{icon:ve,href:q("workflow.events.compact",n[0])}}),a=new G({props:{icon:ke,href:q("workflow.events.json",n[0])}}),{c(){y(e.$$.fragment),t=N(),y(s.$$.fragment),r=N(),y(a.$$.fragment)},l(o){$(e.$$.fragment,o),t=J(o),$(s.$$.fragment,o),r=J(o),$(a.$$.fragment,o)},m(o,l){j(e,o,l),T(o,t,l),j(s,o,l),T(o,r,l),j(a,o,l),c=!0},p(o,l){const f={};l&1&&(f.href=q("workflow.events.full",o[0])),e.$set(f);const p={};l&1&&(p.href=q("workflow.events.compact",o[0])),s.$set(p);const d={};l&1&&(d.href=q("workflow.events.json",o[0])),a.$set(d)},i(o){c||(_(e.$$.fragment,o),_(s.$$.fragment,o),_(a.$$.fragment,o),c=!0)},o(o){v(e.$$.fragment,o),v(s.$$.fragment,o),v(a.$$.fragment,o),c=!1},d(o){I(e,o),o&&w(t),I(s,o),o&&w(r),I(a,o)}}}function Ge(n){let e,t,s,r,a,c,o,l,f,p,d;o=new Be({props:{$$slots:{default:[Ve]},$$scope:{ctx:n}}}),f=new Le({props:{namespace:n[1].namespace,workflowId:n[1].executionId,runId:n[1].runId}});const k=n[4].default,m=Z(k,n,n[5],null);return{c(){e=S("section"),t=S("nav"),s=S("h3"),r=pe("Event History"),a=N(),c=S("div"),y(o.$$.fragment),l=N(),y(f.$$.fragment),p=N(),m&&m.c(),this.h()},l(u){e=P(u,"SECTION",{class:!0});var i=D(e);t=P(i,"NAV",{class:!0});var g=D(t);s=P(g,"H3",{class:!0});var h=D(s);r=we(h,"Event History"),h.forEach(w),a=J(g),c=P(g,"DIV",{class:!0});var O=D(c);$(o.$$.fragment,O),l=J(O),$(f.$$.fragment,O),O.forEach(w),g.forEach(w),p=J(i),m&&m.l(i),i.forEach(w),this.h()},h(){b(s,"class","text-lg font-medium"),b(c,"class","flex gap-4"),b(t,"class","flex gap-4 justify-between items-end"),b(e,"class","flex flex-col gap-4")},m(u,i){T(u,e,i),E(e,t),E(t,s),E(s,r),E(t,a),E(t,c),j(o,c,null),E(c,l),j(f,c,null),E(e,p),m&&m.m(e,null),d=!0},p(u,[i]){const g={};i&33&&(g.$$scope={dirty:i,ctx:u}),o.$set(g);const h={};i&2&&(h.namespace=u[1].namespace),i&2&&(h.workflowId=u[1].executionId),i&2&&(h.runId=u[1].runId),f.$set(h),m&&m.p&&(!d||i&32)&&x(m,k,u,u[5],d?ee(k,u[5],i,null):A(u[5]),null)},i(u){d||(_(o.$$.fragment,u),_(f.$$.fragment,u),_(m,u),d=!0)},o(u){v(o.$$.fragment,u),v(f.$$.fragment,u),v(m,u),d=!1},d(u){u&&w(e),I(o),I(f),m&&m.d(u)}}}async function et({page:n}){const{workflow:e,run:t,namespace:s}=n.params,r={namespace:s,executionId:e,runId:t};return await ae(r),{props:{workflow:{workflowId:e,runId:t,namespace:s},parameters:r}}}function Ke(n,e,t){let s,{$$slots:r={},$$scope:a}=e,{workflow:c}=e,{parameters:o}=e,l=Ie(()=>ae(o));return Y(n,l,f=>t(3,s=f)),n.$$set=f=>{"workflow"in f&&t(0,c=f.workflow),"parameters"in f&&t(1,o=f.parameters),"$$scope"in f&&t(5,a=f.$$scope)},n.$$.update=()=>{n.$$.dirty&8&&te("events",s)},[c,o,l,s,r,a]}class tt extends C{constructor(e){super();B(this,e,Ke,Ge,V,{workflow:0,parameters:1})}}export{tt as default,et as load};
