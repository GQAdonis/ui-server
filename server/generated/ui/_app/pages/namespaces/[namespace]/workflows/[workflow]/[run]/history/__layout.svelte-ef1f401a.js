var me=Object.defineProperty,pe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var X=(s,t,e)=>t in s?me(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,J=(s,t)=>{for(var e in t||(t={}))U.call(t,e)&&X(s,e,t[e]);if(H)for(var e of H(t))W.call(t,e)&&X(s,e,t[e]);return s},Y=(s,t)=>pe(s,ge(t));var Z=(s,t)=>{var e={};for(var n in s)U.call(s,n)&&t.indexOf(n)<0&&(e[n]=s[n]);if(s!=null&&H)for(var n of H(s))t.indexOf(n)<0&&W.call(s,n)&&(e[n]=s[n]);return e};import{az as x,aA as he,S as M,i as B,s as V,N as we,e as q,j as b,c as R,a as P,m as $,d as _,b as I,R as S,f as L,o as j,U as _e,x as k,u as v,v as E,G as A,aa as ke,aB as ve,Q as ye,I as ee,K as te,L as se,M as ne,y as re,t as Ie,k as T,g as be,n as C,J as O,aC as $e,aD as je,aE as Ee}from"../../../../../../../chunks/vendor-aac54a92.js";import{r as D}from"../../../../../../../chunks/route-for-c019a53c.js";import{h as Oe,b as K,r as ae,a as oe}from"../../../../../../../chunks/route-for-api-31cf896b.js";import{s as Q,d as qe,a as Re,b as Pe}from"../../../../../../../chunks/data-converter-config-5c053163.js";import{r as Se}from"../../../../../../../chunks/refreshable-32910785.js";import{p as De}from"../../../../../../../chunks/stores-68dc7257.js";import{a as ce}from"../../../../../../../chunks/append-query-parameters-b8619cc0.js";import{g as Ne}from"../../../../../../../chunks/get-context-e8546704.js";import"../../../../../../../chunks/notifications-389b12bb.js";const le=(s={},t={})=>{const e=J({},s);for(const n of Object.keys(t)){const a=e[n];Array.isArray(a)?e[n]=e[n].concat(t[n]):typeof a=="object"&&!Array.isArray(a)?e[n]=le(e[n],t[n]):e[n]=t[n]}return e},z=async(s,{onStart:t,onUpdate:e,onComplete:n,onError:a=Oe,token:o,previousProps:c}={})=>{!c&&K(t)&&t();try{const r=await s(o),{nextPageToken:l}=r,h=Z(r,["nextPageToken"]),p=le(c,h);return K(e)&&e(p,h),l?z(s,{onStart:t,onUpdate:e,onComplete:n,token:l,previousProps:p}):(K(n)&&n(p),p)}catch(f){a(f)}},Fe=(s,t)=>{if(!s)return{configured:!1,isOpened:()=>!1,open:()=>null,sendRequest:()=>null};try{N=new he(`ws://localhost:${s}/`,J({packMessage:e=>JSON.stringify(e),unpackMessage:e=>JSON.parse(e),attachRequestId:(e,n)=>Object.assign({requestId:n},e),extractRequestId:e=>e&&e.requestId},t)),N.onError(()=>{console.log("oh snap")})}catch{Q()}return N.open(),{configured:!0,isOpened:()=>N.isOpened,open:N.open,sendRequest:e=>N.sendRequest(JSON.stringify(e)).then(n=>n.content)}};let N=null;var ie;const Je=(ie=x(qe))!=null?ie:null;Fe(Je);const Le=s=>{if(!s)return{configured:!1,isOpened:()=>!1,open:()=>null,sendRequest:()=>null};let t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t);let e=new Promise(c=>{t.src=s+"/js",t.addEventListener("load",()=>c(!0))}),n;window.addEventListener("message",c=>{if(c.origin==s)switch(c.data.type){case"data_encoder_ready":n=c.source;break;case"encoded":case"decoded":let r=c.data.requestId;o[r](c.data.payload),delete o[r];break}});let a=0,o={};return{configured:!0,isOpened:()=>!!n,open:()=>e,sendRequest:async c=>{let r=a++;return new Promise(f=>{o[r]=f,n.postMessage({requestId:r,type:"decode",payload:c.payload},{targetOrigin:s})})}}};var ue;const Te=(ue=x(Re))!=null?ue:null,Ce=Le(Te);async function He(s,t){if(!t.isOpened())try{await t.open()}catch{Q()}return t.isOpened()?t.sendRequest({payload:s}).then(n=>(Pe(),n)).catch(()=>{Q()}):Promise.resolve(s)}function F(s){const t=window.atob(String(s.metadata.encoding));switch(s.metadata.encodingDecoded=t,t){case"json/plain":case"json/protobuf":try{return JSON.parse(window.atob(String(s.data)))}catch{}}return s}const Me=async(s,t)=>{var a,o,c,r,f,l,h,p,y,d,i,g;const e=s,n=(r=(c=(a=e==null?void 0:e.input)==null?void 0:a.payloads)!=null?c:(o=e==null?void 0:e.result)==null?void 0:o.payloads)!=null?r:null;if(n){let u;const m=t!=null?t:Ce;(m==null?void 0:m.configured)?u=(await Promise.all((n!=null?n:[]).map(async de=>await He(de,m)))).map(F):u=n.map(F),console.log("payload",u),((f=e==null?void 0:e.input)==null?void 0:f.payloads)&&(e.input.payloads=u),((l=e==null?void 0:e.result)==null?void 0:l.payloads)&&(e.result.payloads=u)}if((h=e==null?void 0:e.searchAttributes)==null?void 0:h.indexedFields){const u=(p=e==null?void 0:e.searchAttributes)==null?void 0:p.indexedFields;Object.entries(u).forEach(([m,w])=>{u[m]=F(w)})}if((y=e==null?void 0:e.memo)==null?void 0:y.fields){const u=(d=e==null?void 0:e.memo)==null?void 0:d.fields;Object.entries(u).forEach(([m,w])=>{u[m]=F(w)})}if((i=e==null?void 0:e.header)==null?void 0:i.fields){const u=(g=e==null?void 0:e.header)==null?void 0:g.fields;Object.entries(u).forEach(([m,w])=>{u[m]=F(w)})}if(e==null?void 0:e.queryResult){const u=e==null?void 0:e.queryResult;Object.entries(u).forEach(([m,w])=>{u[m]=F(w)})}return e};async function Be(s){const t=Object.keys(s).find(n=>n.includes("Attributes")),e=await Me(s[t]);return J({type:t},e)}const Ve=async s=>Promise.all(s.history.events.map(async t=>Y(J({},t),{id:String(t.eventId),eventType:t.eventType,attributes:await Be(t)}))),fe=async({namespace:s,executionId:t,runId:e,onStart:n,onUpdate:a,onComplete:o},c=fetch)=>await z(async f=>ae(oe("events",{namespace:s,executionId:t,runId:e}),{token:f,request:c}),{onStart:n,onUpdate:a,onComplete:o}).then(Ve),Ge=async({namespace:s,executionId:t,runId:e,onStart:n,onUpdate:a,onComplete:o},c=fetch)=>(await z(async f=>ae(oe("events",{namespace:s,executionId:t,runId:e}),{token:f,request:c}),{onStart:n,onUpdate:a,onComplete:o})).history.events;function Ke(s){let t,e,n,a,o,c;return e=new we({props:{icon:s[0],scale:s[2]}}),{c(){t=q("a"),b(e.$$.fragment),this.h()},l(r){t=R(r,"A",{class:!0,href:!0});var f=P(t);$(e.$$.fragment,f),f.forEach(_),this.h()},h(){I(t,"class","border-2 py-2 px-4 hover:text-white hover:bg-gray-600 flex items-center justify-center svelte-1orl6nd"),I(t,"href",n=ce(s[3],s[4].query)),S(t,"rounded-lg",!s[1]),S(t,"active",s[4].path.includes(s[3])),S(t,"group",s[1])},m(r,f){L(r,t,f),j(e,t,null),a=!0,o||(c=_e(t,"click",s[5]),o=!0)},p(r,[f]){const l={};f&1&&(l.icon=r[0]),f&4&&(l.scale=r[2]),e.$set(l),(!a||f&24&&n!==(n=ce(r[3],r[4].query)))&&I(t,"href",n),f&2&&S(t,"rounded-lg",!r[1]),f&24&&S(t,"active",r[4].path.includes(r[3])),f&2&&S(t,"group",r[1])},i(r){a||(k(e.$$.fragment,r),a=!0)},o(r){v(e.$$.fragment,r),a=!1},d(r){r&&_(t),E(e),o=!1,c()}}}function Qe(s,t,e){let n;A(s,De,l=>e(4,n=l));let{icon:a}=t,{group:o=Ne("group")}=t,{scale:c=1}=t,{href:r="#"}=t;function f(l){ke.call(this,s,l)}return s.$$set=l=>{"icon"in l&&e(0,a=l.icon),"group"in l&&e(1,o=l.group),"scale"in l&&e(2,c=l.scale),"href"in l&&e(3,r=l.href)},[a,o,c,r,n,f]}class G extends M{constructor(t){super();B(this,t,Qe,Ke,V,{icon:0,group:1,scale:2,href:3})}}function ze(s){let t,e;return t=new G({props:{icon:ve}}),t.$on("click",s[0]),{c(){b(t.$$.fragment)},l(n){$(t.$$.fragment,n)},m(n,a){j(t,n,a),e=!0},p:ye,i(n){e||(k(t.$$.fragment,n),e=!0)},o(n){v(t.$$.fragment,n),e=!1},d(n){E(t,n)}}}function Ue(s,t,e){const n=async()=>{const r=await Ge({namespace:a,executionId:o,runId:c}),f=JSON.stringify(r,null,2);l(f,`${c}/events.json`,"text/plain");function l(h,p,y){const d=document.createElement("a"),i=new Blob([h],{type:y});d.href=URL.createObjectURL(i),d.download=p,d.click()}};let{namespace:a}=t,{workflowId:o}=t,{runId:c}=t;return s.$$set=r=>{"namespace"in r&&e(1,a=r.namespace),"workflowId"in r&&e(2,o=r.workflowId),"runId"in r&&e(3,c=r.runId)},[n,a,o,c]}class We extends M{constructor(t){super();B(this,t,Ue,ze,V,{namespace:1,workflowId:2,runId:3})}}function Xe(s){let t,e;const n=s[1].default,a=ee(n,s,s[0],null);return{c(){t=q("div"),a&&a.c(),this.h()},l(o){t=R(o,"DIV",{class:!0});var c=P(t);a&&a.l(c),c.forEach(_),this.h()},h(){I(t,"class","flex")},m(o,c){L(o,t,c),a&&a.m(t,null),e=!0},p(o,[c]){a&&a.p&&(!e||c&1)&&te(a,n,o,o[0],e?ne(n,o[0],c,null):se(o[0]),null)},i(o){e||(k(a,o),e=!0)},o(o){v(a,o),e=!1},d(o){o&&_(t),a&&a.d(o)}}}function Ye(s,t,e){let{$$slots:n={},$$scope:a}=t;return re("group",!0),s.$$set=o=>{"$$scope"in o&&e(0,a=o.$$scope)},[a,n]}class Ze extends M{constructor(t){super();B(this,t,Ye,Xe,V,{})}}function xe(s){let t,e,n,a,o,c;return t=new G({props:{icon:$e,href:D("workflow.events.full",s[0])}}),n=new G({props:{icon:je,href:D("workflow.events.compact",s[0])}}),o=new G({props:{icon:Ee,href:D("workflow.events.json",s[0])}}),{c(){b(t.$$.fragment),e=T(),b(n.$$.fragment),a=T(),b(o.$$.fragment)},l(r){$(t.$$.fragment,r),e=C(r),$(n.$$.fragment,r),a=C(r),$(o.$$.fragment,r)},m(r,f){j(t,r,f),L(r,e,f),j(n,r,f),L(r,a,f),j(o,r,f),c=!0},p(r,f){const l={};f&1&&(l.href=D("workflow.events.full",r[0])),t.$set(l);const h={};f&1&&(h.href=D("workflow.events.compact",r[0])),n.$set(h);const p={};f&1&&(p.href=D("workflow.events.json",r[0])),o.$set(p)},i(r){c||(k(t.$$.fragment,r),k(n.$$.fragment,r),k(o.$$.fragment,r),c=!0)},o(r){v(t.$$.fragment,r),v(n.$$.fragment,r),v(o.$$.fragment,r),c=!1},d(r){E(t,r),r&&_(e),E(n,r),r&&_(a),E(o,r)}}}function Ae(s){let t,e,n,a,o,c,r,f,l,h,p;r=new Ze({props:{$$slots:{default:[xe]},$$scope:{ctx:s}}}),l=new We({props:{namespace:s[1].namespace,workflowId:s[1].executionId,runId:s[1].runId}});const y=s[4].default,d=ee(y,s,s[5],null);return{c(){t=q("section"),e=q("nav"),n=q("h3"),a=Ie("Event History"),o=T(),c=q("div"),b(r.$$.fragment),f=T(),b(l.$$.fragment),h=T(),d&&d.c(),this.h()},l(i){t=R(i,"SECTION",{class:!0});var g=P(t);e=R(g,"NAV",{class:!0});var u=P(e);n=R(u,"H3",{class:!0});var m=P(n);a=be(m,"Event History"),m.forEach(_),o=C(u),c=R(u,"DIV",{class:!0});var w=P(c);$(r.$$.fragment,w),f=C(w),$(l.$$.fragment,w),w.forEach(_),u.forEach(_),h=C(g),d&&d.l(g),g.forEach(_),this.h()},h(){I(n,"class","text-lg font-medium"),I(c,"class","flex gap-4"),I(e,"class","flex gap-4 justify-between items-end"),I(t,"class","flex flex-col gap-4")},m(i,g){L(i,t,g),O(t,e),O(e,n),O(n,a),O(e,o),O(e,c),j(r,c,null),O(c,f),j(l,c,null),O(t,h),d&&d.m(t,null),p=!0},p(i,[g]){const u={};g&33&&(u.$$scope={dirty:g,ctx:i}),r.$set(u);const m={};g&2&&(m.namespace=i[1].namespace),g&2&&(m.workflowId=i[1].executionId),g&2&&(m.runId=i[1].runId),l.$set(m),d&&d.p&&(!p||g&32)&&te(d,y,i,i[5],p?ne(y,i[5],g,null):se(i[5]),null)},i(i){p||(k(r.$$.fragment,i),k(l.$$.fragment,i),k(d,i),p=!0)},o(i){v(r.$$.fragment,i),v(l.$$.fragment,i),v(d,i),p=!1},d(i){i&&_(t),E(r),E(l),d&&d.d(i)}}}async function ut({page:s}){const{workflow:t,run:e,namespace:n}=s.params,a={namespace:n,executionId:t,runId:e};return await fe(a),{props:{workflow:{workflowId:t,runId:e,namespace:n},parameters:a}}}function et(s,t,e){let n,{$$slots:a={},$$scope:o}=t,{workflow:c}=t,{parameters:r}=t,f=Se(()=>fe(r));return A(s,f,l=>e(3,n=l)),s.$$set=l=>{"workflow"in l&&e(0,c=l.workflow),"parameters"in l&&e(1,r=l.parameters),"$$scope"in l&&e(5,o=l.$$scope)},s.$$.update=()=>{s.$$.dirty&8&&re("events",n)},[c,r,f,n,a,o]}class dt extends M{constructor(t){super();B(this,t,et,Ae,V,{workflow:0,parameters:1})}}export{dt as default,ut as load};
