var ie=Object.defineProperty,ue=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var U=(n,e,t)=>e in n?ie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,H=(n,e)=>{for(var t in e||(e={}))z.call(e,t)&&U(n,t,e[t]);if(L)for(var t of L(e))M.call(e,t)&&U(n,t,e[t]);return n},W=(n,e)=>ue(n,me(e));var X=(n,e)=>{var t={};for(var s in n)z.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&L)for(var s of L(n))e.indexOf(s)<0&&M.call(n,s)&&(t[s]=n[s]);return t};import{az as de,S as C,i as B,s as V,N as ge,e as P,j as y,c as S,a as D,m as I,d as w,b,R,f as T,o as $,U as pe,x as _,u as v,v as j,G as Y,aa as he,aA as we,Q as _e,I as Z,K as x,L as A,M as ee,y as te,t as ve,k as N,g as ke,n as J,J as E,aB as be,aC as ye,aD as Ie}from"../../../../../../../chunks/vendor-b93e428e.js";import{r as q}from"../../../../../../../chunks/route-for-c019a53c.js";import{h as $e,b as K,r as ne,a as se}from"../../../../../../../chunks/route-for-api-897023e4.js";import{d as je,s as re,a as Ee}from"../../../../../../../chunks/data-converter-config-fb390bf1.js";import{r as Oe}from"../../../../../../../chunks/refreshable-9bcf1376.js";import{p as Pe}from"../../../../../../../chunks/stores-668dfc14.js";import{a as oe}from"../../../../../../../chunks/append-query-parameters-b8619cc0.js";import{g as Se}from"../../../../../../../chunks/get-context-97f7fcbb.js";import"../../../../../../../chunks/notifications-f504753b.js";const ae=(n={},e={})=>{const t=H({},n);for(const s of Object.keys(e)){const o=t[s];Array.isArray(o)?t[s]=t[s].concat(e[s]):typeof o=="object"&&!Array.isArray(o)?t[s]=ae(t[s],e[s]):t[s]=e[s]}return t},Q=async(n,{onStart:e,onUpdate:t,onComplete:s,onError:o=$e,token:a,previousProps:c}={})=>{!c&&K(e)&&e();try{const r=await n(a),{nextPageToken:f}=r,h=X(r,["nextPageToken"]),g=ae(c,h);return K(t)&&t(g,h),f?Q(n,{onStart:e,onUpdate:t,onComplete:s,token:f,previousProps:g}):(K(s)&&s(g),g)}catch(l){o(l)}},De=n=>n?{configured:!0,isOpened:()=>!0,open:()=>Promise.resolve(!0),decode:async e=>(await fetch(n+"/decode",{method:"POST",body:JSON.stringify(e)})).json()}:{configured:!1,isOpened:()=>!1,open:()=>null,decode:e=>Promise.resolve(e)};var le;const Re=(le=de(je))!=null?le:null,ce=De(Re);async function qe(n,e){if(!e.isOpened())try{await e.open()}catch{re()}return e.isOpened()?e.decode(n).then(s=>(Ee(),s)).catch(()=>(re(),n)):Promise.resolve(n)}function F(n){const e=window.atob(String(n.metadata.encoding));switch(n.metadata.encodingDecoded=e,e){case"json/plain":case"json/protobuf":try{return JSON.parse(window.atob(String(n.data)))}catch{}}return n}const Fe=async n=>{var s,o,a,c,r,l,f,h,g,k,d,u;const e=n,t=(c=(a=(s=e==null?void 0:e.input)==null?void 0:s.payloads)!=null?a:(o=e==null?void 0:e.result)==null?void 0:o.payloads)!=null?c:null;if(t){let i,m;ce.configured&&(m=ce),(m==null?void 0:m.configured)?i=(await Promise.all((t!=null?t:[]).map(async O=>await qe(O,m)))).map(F):i=t.map(F),((r=e==null?void 0:e.input)==null?void 0:r.payloads)&&(e.input.payloads=i),((l=e==null?void 0:e.result)==null?void 0:l.payloads)&&(e.result.payloads=i)}if((f=e==null?void 0:e.searchAttributes)==null?void 0:f.indexedFields){const i=(h=e==null?void 0:e.searchAttributes)==null?void 0:h.indexedFields;Object.entries(i).forEach(([m,p])=>{i[m]=F(p)})}if((g=e==null?void 0:e.memo)==null?void 0:g.fields){const i=(k=e==null?void 0:e.memo)==null?void 0:k.fields;Object.entries(i).forEach(([m,p])=>{i[m]=F(p)})}if((d=e==null?void 0:e.header)==null?void 0:d.fields){const i=(u=e==null?void 0:e.header)==null?void 0:u.fields;Object.entries(i).forEach(([m,p])=>{i[m]=F(p)})}if(e==null?void 0:e.queryResult){const i=e==null?void 0:e.queryResult;Object.entries(i).forEach(([m,p])=>{i[m]=F(p)})}return e};async function Te(n){const e=Object.keys(n).find(s=>s.includes("Attributes")),t=await Fe(n[e]);return H({type:e},t)}const Ne=async n=>Promise.all(n.history.events.map(async e=>W(H({},e),{id:String(e.eventId),eventType:e.eventType,attributes:await Te(e)}))),fe=async({namespace:n,executionId:e,runId:t,onStart:s,onUpdate:o,onComplete:a},c=fetch)=>await Q(async l=>ne(se("events",{namespace:n,executionId:e,runId:t}),{token:l,request:c}),{onStart:s,onUpdate:o,onComplete:a}).then(Ne),Je=async({namespace:n,executionId:e,runId:t,onStart:s,onUpdate:o,onComplete:a},c=fetch)=>(await Q(async l=>ne(se("events",{namespace:n,executionId:e,runId:t}),{token:l,request:c}),{onStart:s,onUpdate:o,onComplete:a})).history.events;function Le(n){let e,t,s,o,a,c;return t=new ge({props:{icon:n[0],scale:n[2]}}),{c(){e=P("a"),y(t.$$.fragment),this.h()},l(r){e=S(r,"A",{class:!0,href:!0});var l=D(e);I(t.$$.fragment,l),l.forEach(w),this.h()},h(){b(e,"class","border-2 py-2 px-4 hover:text-white hover:bg-gray-600 flex items-center justify-center svelte-1orl6nd"),b(e,"href",s=oe(n[3],n[4].query)),R(e,"rounded-lg",!n[1]),R(e,"active",n[4].path.includes(n[3])),R(e,"group",n[1])},m(r,l){T(r,e,l),$(t,e,null),o=!0,a||(c=pe(e,"click",n[5]),a=!0)},p(r,[l]){const f={};l&1&&(f.icon=r[0]),l&4&&(f.scale=r[2]),t.$set(f),(!o||l&24&&s!==(s=oe(r[3],r[4].query)))&&b(e,"href",s),l&2&&R(e,"rounded-lg",!r[1]),l&24&&R(e,"active",r[4].path.includes(r[3])),l&2&&R(e,"group",r[1])},i(r){o||(_(t.$$.fragment,r),o=!0)},o(r){v(t.$$.fragment,r),o=!1},d(r){r&&w(e),j(t),a=!1,c()}}}function He(n,e,t){let s;Y(n,Pe,f=>t(4,s=f));let{icon:o}=e,{group:a=Se("group")}=e,{scale:c=1}=e,{href:r="#"}=e;function l(f){he.call(this,n,f)}return n.$$set=f=>{"icon"in f&&t(0,o=f.icon),"group"in f&&t(1,a=f.group),"scale"in f&&t(2,c=f.scale),"href"in f&&t(3,r=f.href)},[o,a,c,r,s,l]}class G extends C{constructor(e){super();B(this,e,He,Le,V,{icon:0,group:1,scale:2,href:3})}}function Ce(n){let e,t;return e=new G({props:{icon:we}}),e.$on("click",n[0]),{c(){y(e.$$.fragment)},l(s){I(e.$$.fragment,s)},m(s,o){$(e,s,o),t=!0},p:_e,i(s){t||(_(e.$$.fragment,s),t=!0)},o(s){v(e.$$.fragment,s),t=!1},d(s){j(e,s)}}}function Be(n,e,t){const s=async()=>{const r=await Je({namespace:o,executionId:a,runId:c}),l=JSON.stringify(r,null,2);f(l,`${c}/events.json`,"text/plain");function f(h,g,k){const d=document.createElement("a"),u=new Blob([h],{type:k});d.href=URL.createObjectURL(u),d.download=g,d.click()}};let{namespace:o}=e,{workflowId:a}=e,{runId:c}=e;return n.$$set=r=>{"namespace"in r&&t(1,o=r.namespace),"workflowId"in r&&t(2,a=r.workflowId),"runId"in r&&t(3,c=r.runId)},[s,o,a,c]}class Ve extends C{constructor(e){super();B(this,e,Be,Ce,V,{namespace:1,workflowId:2,runId:3})}}function Ge(n){let e,t;const s=n[1].default,o=Z(s,n,n[0],null);return{c(){e=P("div"),o&&o.c(),this.h()},l(a){e=S(a,"DIV",{class:!0});var c=D(e);o&&o.l(c),c.forEach(w),this.h()},h(){b(e,"class","flex")},m(a,c){T(a,e,c),o&&o.m(e,null),t=!0},p(a,[c]){o&&o.p&&(!t||c&1)&&x(o,s,a,a[0],t?ee(s,a[0],c,null):A(a[0]),null)},i(a){t||(_(o,a),t=!0)},o(a){v(o,a),t=!1},d(a){a&&w(e),o&&o.d(a)}}}function Ke(n,e,t){let{$$slots:s={},$$scope:o}=e;return te("group",!0),n.$$set=a=>{"$$scope"in a&&t(0,o=a.$$scope)},[o,s]}class Qe extends C{constructor(e){super();B(this,e,Ke,Ge,V,{})}}function ze(n){let e,t,s,o,a,c;return e=new G({props:{icon:be,href:q("workflow.events.full",n[0])}}),s=new G({props:{icon:ye,href:q("workflow.events.compact",n[0])}}),a=new G({props:{icon:Ie,href:q("workflow.events.json",n[0])}}),{c(){y(e.$$.fragment),t=N(),y(s.$$.fragment),o=N(),y(a.$$.fragment)},l(r){I(e.$$.fragment,r),t=J(r),I(s.$$.fragment,r),o=J(r),I(a.$$.fragment,r)},m(r,l){$(e,r,l),T(r,t,l),$(s,r,l),T(r,o,l),$(a,r,l),c=!0},p(r,l){const f={};l&1&&(f.href=q("workflow.events.full",r[0])),e.$set(f);const h={};l&1&&(h.href=q("workflow.events.compact",r[0])),s.$set(h);const g={};l&1&&(g.href=q("workflow.events.json",r[0])),a.$set(g)},i(r){c||(_(e.$$.fragment,r),_(s.$$.fragment,r),_(a.$$.fragment,r),c=!0)},o(r){v(e.$$.fragment,r),v(s.$$.fragment,r),v(a.$$.fragment,r),c=!1},d(r){j(e,r),r&&w(t),j(s,r),r&&w(o),j(a,r)}}}function Me(n){let e,t,s,o,a,c,r,l,f,h,g;r=new Qe({props:{$$slots:{default:[ze]},$$scope:{ctx:n}}}),f=new Ve({props:{namespace:n[1].namespace,workflowId:n[1].executionId,runId:n[1].runId}});const k=n[4].default,d=Z(k,n,n[5],null);return{c(){e=P("section"),t=P("nav"),s=P("h3"),o=ve("Event History"),a=N(),c=P("div"),y(r.$$.fragment),l=N(),y(f.$$.fragment),h=N(),d&&d.c(),this.h()},l(u){e=S(u,"SECTION",{class:!0});var i=D(e);t=S(i,"NAV",{class:!0});var m=D(t);s=S(m,"H3",{class:!0});var p=D(s);o=ke(p,"Event History"),p.forEach(w),a=J(m),c=S(m,"DIV",{class:!0});var O=D(c);I(r.$$.fragment,O),l=J(O),I(f.$$.fragment,O),O.forEach(w),m.forEach(w),h=J(i),d&&d.l(i),i.forEach(w),this.h()},h(){b(s,"class","text-lg font-medium"),b(c,"class","flex gap-4"),b(t,"class","flex gap-4 justify-between items-end"),b(e,"class","flex flex-col gap-4")},m(u,i){T(u,e,i),E(e,t),E(t,s),E(s,o),E(t,a),E(t,c),$(r,c,null),E(c,l),$(f,c,null),E(e,h),d&&d.m(e,null),g=!0},p(u,[i]){const m={};i&33&&(m.$$scope={dirty:i,ctx:u}),r.$set(m);const p={};i&2&&(p.namespace=u[1].namespace),i&2&&(p.workflowId=u[1].executionId),i&2&&(p.runId=u[1].runId),f.$set(p),d&&d.p&&(!g||i&32)&&x(d,k,u,u[5],g?ee(k,u[5],i,null):A(u[5]),null)},i(u){g||(_(r.$$.fragment,u),_(f.$$.fragment,u),_(d,u),g=!0)},o(u){v(r.$$.fragment,u),v(f.$$.fragment,u),v(d,u),g=!1},d(u){u&&w(e),j(r),j(f),d&&d.d(u)}}}async function rt({page:n}){const{workflow:e,run:t,namespace:s}=n.params,o={namespace:s,executionId:e,runId:t};return await fe(o),{props:{workflow:{workflowId:e,runId:t,namespace:s},parameters:o}}}function Ue(n,e,t){let s,{$$slots:o={},$$scope:a}=e,{workflow:c}=e,{parameters:r}=e,l=Oe(()=>fe(r));return Y(n,l,f=>t(3,s=f)),n.$$set=f=>{"workflow"in f&&t(0,c=f.workflow),"parameters"in f&&t(1,r=f.parameters),"$$scope"in f&&t(5,a=f.$$scope)},n.$$.update=()=>{n.$$.dirty&8&&te("events",s)},[c,r,l,s,o,a]}class ot extends C{constructor(e){super();B(this,e,Ue,Me,V,{workflow:0,parameters:1})}}export{ot as default,rt as load};
