import{B as e}from"./prod-browser.CoG0geaG.js";import{g as $}from"./auth-user.CZ_SxeY3.js";import{w as C}from"./entry.KnDkSfj0.js";import{t as N}from"./toaster.CyHyu9oh.js";import{h as b}from"./has.BWrERxPV.js";import{i as R}from"./is-network-error.Dq2Kfkkh.js";import{o as k,t as F}from"./route-for.qyPdvGjv.js";import{i as O}from"./persist-store.C12peZUI.js";import{C as v}from"./scheduler.DZa-jdu7.js";import{b as P}from"./paths.BABCuNpK.js";import{p as I}from"./stores.YNXuWUoI.js";const W=C(null),S=(i,n=N,s=W,c=e)=>{if(!(i instanceof DOMException&&i.name==="AbortError"))throw typeof i=="string"?n.push({variant:"error",message:i}):i.report=!1,i instanceof Error&&n.push({variant:"error",message:i.message}),T(i)&&c&&window.location.assign(k(i==null?void 0:i.message)),x(i)&&c&&window.location.assign(k(i==null?void 0:i.message)),R(i)&&(n.push({variant:"error",message:`${i.statusCode} ${i.statusText}`}),s.set(i)),i},on=(i,n=e)=>{var c;const s=`${i==null?void 0:i.status} ${(c=i==null?void 0:i.body)==null?void 0:c.message}`;if(T(i)&&n){window.location.assign(k(s));return}if(x(i)&&n){window.location.assign(k(s));return}},T=i=>U(i,401),x=i=>U(i,403),U=(i,n)=>b(i,"statusCode")?i.statusCode===n:b(i,"status")?i.status===n:!1,un=i=>(i==null?void 0:i.message)!==void 0&&typeof(i==null?void 0:i.message)=="string",tn=async(i,n={})=>{const{params:s={},request:c=fetch,token:t,notifyOnError:o=!0,handleError:u=S,onError:f,isBrowser:g=e}=n;let{options:w}=n,h=new URLSearchParams;if(s!=null&&s.entries)h=s,t&&h.set("nextPageToken",t);else{const l=t?{next_page_token:t}:{};h=new URLSearchParams({...s,...l})}const q=F(i,h);try{w=_(w,g),i.endsWith("api/v1/settings")||(w=await z(w,g));const l=await c(q,w),d=await l.json(),{status:E,statusText:A}=l;if(!l.ok)if(f&&O(f))f({status:E,statusText:A,body:d});else throw{statusCode:l.status,statusText:l.statusText,response:l,message:(d==null?void 0:d.message)??l.statusText};return d}catch(l){if(o)u(l);else throw l}},_=(i,n=e)=>{const s={credentials:"include",...i};return s.headers=B(i==null?void 0:i.headers,n),s},z=async(i,n=e)=>(globalThis!=null&&globalThis.AccessToken?i.headers=await y(i==null?void 0:i.headers,globalThis.AccessToken,n):$().accessToken&&(i.headers=await y(i==null?void 0:i.headers,async()=>$().accessToken,n),i.headers=L(i==null?void 0:i.headers,$().idToken,n)),i),y=async(i,n,s=e)=>{if(i||(i={}),!s)return i;try{const c=await n();c&&(i.Authorization=`Bearer ${c}`)}catch(c){console.error(c)}return i},L=(i={},n,s=e)=>(s&&n&&(i["Authorization-Extras"]=n),i),B=(i,n=e)=>{if(i||(i={}),i["Caller-Type"]="operator",!n)return i;const s="_csrf=",c="X-CSRF-TOKEN";try{let o=document.cookie.split(";").find(u=>u.includes(s));o&&!i[c]&&(o=o.trim().slice(s.length),i[c]=o)}catch(t){console.error(t)}return i};function J(i=e){const n="",s=!n.startsWith("http");let c="";return s?c=i?window.location.origin+n:"":c=n,c.endsWith("/")&&(c=c.slice(0,-1)),c}const ln=(i,n)=>{if(!i||!n)return!1;const[s,c,t]=i.split(".").map(Number),[o,u,f]=n.split(".").map(Number);return s!==o?s>o:c!==u?c>u:t>f},D=(i,n)=>{if(!i||!n)return!1;const[s,c,t]=i.split(".").map(Number),[o,u,f]=n.split(".").map(Number);return s!==o?o>s:c!==u?c===void 0&&u||c===void 0&&u===void 0?!0:u>c:t===void 0&&f||t===void 0&&(f===void 0||isNaN(f))?!0:f>=t},H=(i,n)=>i?i.replace("%namespace%",n):"",K=i=>{var o,u;let n="";const s=(o=v(I).data)==null?void 0:o.webUrl,c=s&&i,t=((u=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:u.apiUrl)&&i;return c?n=s:t?(console.warn("Using fallback api url, web url not found"),n=H(globalThis.AppConfig.apiUrl,i)):n=J(),n.endsWith("/")&&(n=n.slice(0,-1)),n=`${n}${P}`,n},M=i=>(i.startsWith("/")&&(i=i.slice(1)),`/api/v1/${i}`),X=(i,n)=>`${K(n)}${i}`,G=i=>{var s,c,t;const n=(t=(c=(s=v(I))==null?void 0:s.data)==null?void 0:c.settings)==null?void 0:t.version;return Object.keys(i??{}).reduce((o,u)=>(n&&D("2.23.0",n)?o[u]=encodeURIComponent(i[u]):o[u]=encodeURIComponent(encodeURIComponent(i[u])),o),{namespace:"",workflowId:"",scheduleId:"",queue:"",queryType:"",signalName:"",batchJobId:"",activityId:"",endpointId:""})};function Q(i,n,s=!0){s&&(n=G(n));const c={systemInfo:"/system-info",cluster:"/cluster-info",namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,"search-attributes":`/namespaces/${n.namespace}/search-attributes`,"events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history-reverse`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/query/${n.queryType}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,"schedule.patch":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/patch`,"schedule.edit":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/update`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,"task-queue.compatibility":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-build-id-compatibility`,"task-queue.rules":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-versioning-rules`,user:"/me","worker-task-reachability":`/namespaces/${n==null?void 0:n.namespace}/worker-task-reachability`,"workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/terminate`,"workflow.cancel":`/namespaces/${n.namespace}/workflows/${n.workflowId}/cancel`,"workflow.signal":`/namespaces/${n.namespace}/workflows/${n.workflowId}/signal/${n.signalName}`,"workflow.reset":`/namespaces/${n.namespace}/workflows/${n.workflowId}/reset`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/archived-workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflow-count`,"activity.complete":`/namespaces/${n.namespace}/activities/complete-by-id`,"activity.fail":`/namespaces/${n.namespace}/activities/fail-by-id`,"batch-operations.list":`/namespaces/${n.namespace}/batch-operations`,"batch-operations":`/namespaces/${n.namespace}/batch-operations/${n==null?void 0:n.batchJobId}`,"nexus-endpoints":"/nexus/endpoints","nexus-endpoint":`/nexus/endpoints/${n.endpointId}`,"nexus-endpoint.update":`/nexus/endpoints/${n.endpointId}/update`};return M(c[i])}function fn(i,n,s=!0){const c=Q(i,n,s);return X(c,n==null?void 0:n.namespace)}export{tn as a,un as b,K as c,on as d,T as e,x as f,J as g,S as h,ln as i,D as m,W as n,Q as p,fn as r};
