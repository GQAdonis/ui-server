import{w as v,g as P}from"./entry.rhoat64I.js";import{t as $}from"./translate.HrioCK44.js";import"./i18next.dQ3wfJvm.js";import{s as w}from"./parse-with-big-int.e3oI4SEy.js";import{r as h,a as p}from"./route-for-api.HvO1FF3L.js";import{v as S}from"./toaster.iZqwbcp2.js";import{e as O}from"./encode-payload.Cf1Y7aTn.js";import{l as E,m as b}from"./route-for.tARO9nMD.js";const R=async(e,o=fetch)=>(t=100,s="")=>{const n=h("schedules",{namespace:e});return p(n,{params:{maximumPageSize:String(t),nextPageToken:s},request:o}).then(({schedules:r,nextPageToken:a})=>({items:r,nextPageToken:a?String(a):""}))};async function L(e,o=fetch){const t=h("schedule",e);return p(t,{request:o})}async function G(e,o=fetch){const t=h("schedule",e);return p(t,{request:o,options:{method:"DELETE"}})}async function _({namespace:e,scheduleId:o,body:t}){let s="";const n=c=>{var u;return s=((u=c==null?void 0:c.body)==null?void 0:u.message)??`Error creating schedule: ${c.status}: ${c.statusText}`},r=h("schedule",{namespace:e,scheduleId:o}),{conflictToken:a}=await p(r,{options:{method:"POST",body:w({request_id:S(),...t})},onError:n});return{conflictToken:a,error:s}}async function x({namespace:e,scheduleId:o,body:t}){let s="";const n=a=>{var c;return s=((c=a==null?void 0:a.body)==null?void 0:c.message)??`Error editing schedule: ${a.status}: ${a.statusText}`},r=h("schedule.edit",{namespace:e,scheduleId:o});return await p(r,{options:{method:"POST",body:w({request_id:S(),...t})},onError:n}),{error:s}}async function H({namespace:e,scheduleId:o,reason:t}){const s={patch:{pause:t}},n=h("schedule.patch",{namespace:e,scheduleId:o});return await p(n,{options:{method:"POST",body:w({...s,request_id:S()})},onError:r=>console.error(r)})}async function J({namespace:e,scheduleId:o,reason:t}){const s={patch:{unpause:t}},n=h("schedule.patch",{namespace:e,scheduleId:o});return await p(n,{options:{method:"POST",body:w({...s,request_id:S()})}})}async function K({namespace:e,scheduleId:o,overlapPolicy:t}){const s={patch:{triggerImmediately:{overlapPolicy:t}}},n=h("schedule.patch",{namespace:e,scheduleId:o});return await p(n,{options:{method:"POST",body:w({...s,request_id:S()})}})}async function N({namespace:e,scheduleId:o,overlapPolicy:t,startTime:s,endTime:n}){const r={patch:{backfillRequest:[{overlapPolicy:t,startTime:s,endTime:n}]}},a=h("schedule.patch",{namespace:e,scheduleId:o});return await p(a,{options:{method:"POST",body:w({...r,request_id:S()})}})}const I=e=>e?parseInt(e):0,M=(e,o,t,s)=>`${I(e)*60*60*24+I(o)*60*60+I(t)*60+I(s)}s`,W=({months:e=[],daysOfMonth:o=[],daysOfWeek:t=[]})=>{var c,u;const s=e.sort((i,l)=>parseInt(i)-parseInt(l)).join(","),n=o.sort((i,l)=>i-l).join(","),a=(((u=(c=t==null?void 0:t[0])==null?void 0:c.split(","))==null?void 0:u.length)>1?t[0].split(","):t).sort((i,l)=>parseInt(i)-parseInt(l)).join(",");return{month:s,dayOfMonth:n,dayOfWeek:a}},q=(e,o,t)=>{const{hour:s,minute:n,second:r,phase:a,cronString:c}=o,{preset:u,months:i,days:l,daysOfMonth:m,daysOfWeek:f}=t;if(u==="string"){const d=`${c}#${c}`;e.schedule.spec.cronString=[d],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(u==="interval"){const d=M(l,s,n,r);e.schedule.spec.interval=[{interval:d,phase:a||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:d,dayOfMonth:k,dayOfWeek:T}=W({months:i,daysOfMonth:m,daysOfWeek:f});e.schedule.spec.calendar=[{year:"*",month:u==="month"?d:"",dayOfMonth:u==="month"?k:"",dayOfWeek:u==="week"?T:"",hour:s,minute:n,second:r}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}},U=async({action:e,spec:o,presets:t})=>{const{namespace:s,name:n,workflowId:r,workflowType:a,taskQueue:c,input:u}=e;let i;if(u)try{i=await O(u)}catch(f){g.set(`${$("data-encoder.encode-error")}: ${f==null?void 0:f.message}`);return}const l={schedule_id:n.trim(),schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:r,workflowType:{name:a},taskQueue:{name:c},input:i?{payloads:i}:null}}}};q(l,o,t),y.set(!0);const{error:m}=await _({scheduleId:n,namespace:s,body:l});m?(g.set(m),y.set(!1)):setTimeout(()=>{g.set(""),y.set(!1),P(E({namespace:s}))},2e3)},V=async({action:e,spec:o,presets:t},s,n)=>{const{namespace:r,name:a,workflowId:c,workflowType:u,taskQueue:i,input:l}=e;let m;if(l)try{m=await O(l)}catch(T){g.set(`${$("data-encoder.encode-error")}: ${T==null?void 0:T.message}`);return}const{preset:f}=t,d={schedule_id:n,schedule:{...s,action:{startWorkflow:{...s.action.startWorkflow,workflowId:c,workflowType:{name:u},taskQueue:{name:i},input:m?{payloads:m}:null}}}};f==="existing"?d.schedule.spec=s.spec:(q(d,o,t),d.schedule.spec.structuredCalendar=[]),y.set(!0);const{error:k}=await x({namespace:r,scheduleId:n,body:d});k?(g.set(k),y.set(!1)):setTimeout(()=>{P(b({namespace:r,scheduleId:a})),g.set(""),y.set(!1)},2e3)},y=v(!1),g=v(""),X=v("0");export{U as a,X as b,R as c,G as d,g as e,L as f,N as g,y as l,H as p,V as s,K as t,J as u};
