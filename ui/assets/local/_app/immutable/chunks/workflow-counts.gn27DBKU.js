import{s as V,h as Y,j as Z,k as x,f as g,m as tt,i as I,c as b,a5 as et,w as M,x as C,v as nt,b as ot,d as st}from"./scheduler.OdTyv_h4.js";import{S as j,i as z,c as v,a as W,m as q,t as p,b as h,d as E,g as H,e as J}from"./index.oB682ev8.js";import{e as G,u as rt,o as at}from"./each.QcvZsK_H.js";import{p as ut}from"./stores.cPqFqHG7.js";import{L as lt}from"./link.G-0-3KfU.js";import{S as ct}from"./index.JdCO7qfN.js";import{w as N}from"./translate.zYlm6who.js";import{r as ft,w as S,q as it,c as O}from"./workflows.wK1YhU-a.js";import{b as mt}from"./decode-payload.AlFIRdhI.js";import{W as _t}from"./workflow-status.wdArcqN0.js";const P=(o,e,n)=>{const s=Math.pow(3600/o,1/n),l=o*Math.pow(s,e);return Math.min(3600,Math.round(l))};function wt(o){let e,n;return e=new _t({props:{count:o[1],newCount:o[2],status:o[0],"test-id":"workflow-status-"+o[0]}}),{c(){v(e.$$.fragment)},l(t){W(e.$$.fragment,t)},m(t,s){q(e,t,s),n=!0},p(t,[s]){const l={};s&2&&(l.count=t[1]),s&4&&(l.newCount=t[2]),s&1&&(l.status=t[0]),s&1&&(l["test-id"]="workflow-status-"+t[0]),e.$set(l)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function pt(o,e,n){let{status:t}=e,{count:s=0}=e,{newCount:l=0}=e;return o.$$set=r=>{"status"in r&&n(0,t=r.status),"count"in r&&n(1,s=r.count),"newCount"in r&&n(2,l=r.newCount)},[t,s,l]}class ht extends j{constructor(e){super(),z(this,e,pt,wt,V,{status:0,count:1,newCount:2})}}function $(o,e,n){const t=o.slice();return t[19]=e[n].count,t[20]=e[n].status,t}function kt(o){let e,n;return e=new ct({props:{class:"h-6 w-24 rounded"}}),{c(){v(e.$$.fragment)},l(t){W(e.$$.fragment,t)},m(t,s){q(e,t,s),n=!0},p:nt,i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function dt(o){let e,n;return e=new lt({props:{href:`/namespaces/${o[0]}/workflows?query=%60ExecutionStatus%60%3D"${o[20]}"`,role:"button",$$slots:{default:[gt]},$$scope:{ctx:o}}}),{c(){v(e.$$.fragment)},l(t){W(e.$$.fragment,t)},m(t,s){q(e,t,s),n=!0},p(t,s){const l={};s&3&&(l.href=`/namespaces/${t[0]}/workflows?query=%60ExecutionStatus%60%3D"${t[20]}"`),s&8388614&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function gt(o){let e,n,t;function s(...r){return o[9](o[20],...r)}function l(...r){return o[10](o[20],...r)}return e=new ht({props:{status:o[20],count:o[19],newCount:o[2].find(s)?o[2].find(l).count-o[19]:0}}),{c(){v(e.$$.fragment),n=ot()},l(r){W(e.$$.fragment,r),n=st(r)},m(r,u){q(e,r,u),I(r,n,u),t=!0},p(r,u){o=r;const a={};u&2&&(a.status=o[20]),u&2&&(a.count=o[19]),u&6&&(a.newCount=o[2].find(s)?o[2].find(l).count-o[19]:0),e.$set(a)},i(r){t||(p(e.$$.fragment,r),t=!0)},o(r){h(e.$$.fragment,r),t=!1},d(r){r&&g(n),E(e,r)}}}function A(o,e){let n,t,s,l,r;const u=[dt,kt],a=[];function f(m,_){return m[3]?1:0}return t=f(e),s=a[t]=u[t](e),{key:o,first:null,c(){n=C(),s.c(),l=C(),this.h()},l(m){n=C(),s.l(m),l=C(),this.h()},h(){this.first=n},m(m,_){I(m,n,_),a[t].m(m,_),I(m,l,_),r=!0},p(m,_){e=m;let w=t;t=f(e),t===w?a[t].p(e,_):(H(),h(a[w],1,1,()=>{a[w]=null}),J(),s=a[t],s?s.p(e,_):(s=a[t]=u[t](e),s.c()),p(s,1),s.m(l.parentNode,l))},i(m){r||(p(s),r=!0)},o(m){h(s),r=!1},d(m){m&&(g(n),g(l)),a[t].d(m)}}}function yt(o){let e,n=[],t=new Map,s,l=G(o[1]);const r=u=>u[20];for(let u=0;u<l.length;u+=1){let a=$(o,l,u),f=r(a);t.set(f,n[u]=A(f,a))}return{c(){e=Y("div");for(let u=0;u<n.length;u+=1)n[u].c();this.h()},l(u){e=Z(u,"DIV",{class:!0});var a=x(e);for(let f=0;f<n.length;f+=1)n[f].l(a);a.forEach(g),this.h()},h(){tt(e,"class","flex min-h-[24px] flex-wrap items-center gap-2")},m(u,a){I(u,e,a);for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(e,null);s=!0},p(u,[a]){a&15&&(l=G(u[1]),H(),n=rt(n,a,r,1,u,l,t,e,at,A,null,$),J())},i(u){if(!s){for(let a=0;a<l.length;a+=1)p(n[a]);s=!0}},o(u){for(let a=0;a<n.length;a+=1)h(n[a]);s=!1},d(u){u&&g(e);for(let a=0;a<n.length;a+=1)n[a].d()}}}const L=5,B=100;function bt(o,e,n){let t,s,l,r,u,a;b(o,ft,c=>n(6,l=c)),b(o,S,c=>n(13,r=c)),b(o,it,c=>n(7,u=c)),b(o,ut,c=>n(8,a=c));let{staticQuery:f=""}=e,m=[],_=[],w,k=1,y=!1;et(()=>{D()});const K=()=>{if(k+=1,clearInterval(w),k<=B){const c=P(L,k,B)*1e3;w=setInterval(()=>F(),c)}},D=()=>{clearInterval(w),n(2,_=[]),M(S,r.newCount=0,r),k=1,n(3,y=!0)},Q=(c=[])=>c.map(i=>{const d=mt(i==null?void 0:i.groupValues[0]),X=parseInt(i.count);return{status:d,count:X}}).sort((i,d)=>N.indexOf(i.status)-N.indexOf(d.status)),F=async()=>{K();try{const{count:c,groups:i}=await O({namespace:t,query:s});M(S,r.newCount=parseInt(c)-r.count,r),n(2,_=Q(i))}catch(c){console.error("Fetching workflow counts failed: ",c==null?void 0:c.message)}finally{n(3,y=!1)}},R=async()=>{D();const c=P(L,k,B)*1e3;w=setInterval(()=>F(),c);try{const{count:i,groups:d}=await O({namespace:t,query:s});M(S,r.count=parseInt(i),r),n(1,m=Q(d))}catch(i){console.error("Fetching workflow counts failed: ",i==null?void 0:i.message)}finally{n(3,y=!1)}},T=(c,i)=>i.status===c,U=(c,i)=>i.status===c;return o.$$set=c=>{"staticQuery"in c&&n(4,f=c.staticQuery)},o.$$.update=()=>{o.$$.dirty&256&&n(0,t=a.params.namespace),o.$$.dirty&144&&n(5,s=f||u),o.$$.dirty&97&&R()},[t,m,_,y,f,s,l,u,a,T,U]}class Qt extends j{constructor(e){super(),z(this,e,bt,yt,V,{staticQuery:4})}}export{Qt as W};
