import{s as Y,h as j,j as H,k as L,f as h,m as rt,i as W,c as y,a5 as st,w as S,x as v,v as at,b as ut,d as lt,n as ct,p as ft}from"./scheduler.H4VsQ-sj.js";import{S as z,i as J,c as F,a as P,m as Q,t as d,b as k,d as q,g as X,e as Z}from"./index.u1vXzj6H.js";import{e as A,u as it,o as mt}from"./each.QPTTFOf3.js";import{p as _t}from"./stores.Hoj_DiFp.js";import{S as pt}from"./index.icENWwm2.js";import{t as wt,c as ht,w as N}from"./translate.WekT8qli.js";import{r as dt,w as I,q as kt,c as D}from"./workflows.AV7UEYGs.js";import{w as G}from"./events.ChYJNTuQ.js";import{c as gt}from"./pagination.-An0BrIN.js";import{S as yt}from"./time-picker.iO35-tl7.js";import{b as bt}from"./decode-payload.1wUPeFiU.js";import{u as Ct}from"./update-query-parameters.MpBd_xdV.js";import{W as St}from"./workflow-status.rwI5gFef.js";const R=(o,e,t)=>{const s=Math.pow(3600/o,1/t),c=o*Math.pow(s,e);return Math.min(3600,Math.round(c))};function vt(o){let e,t;return e=new St({props:{count:o[1],newCount:o[2],status:o[0],"test-id":"workflow-status-"+o[0]}}),{c(){F(e.$$.fragment)},l(n){P(e.$$.fragment,n)},m(n,s){Q(e,n,s),t=!0},p(n,[s]){const c={};s&2&&(c.count=n[1]),s&4&&(c.newCount=n[2]),s&1&&(c.status=n[0]),s&1&&(c["test-id"]="workflow-status-"+n[0]),e.$set(c)},i(n){t||(d(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){q(e,n)}}}function It(o,e,t){let{status:n}=e,{count:s=0}=e,{newCount:c=0}=e;return o.$$set=f=>{"status"in f&&t(0,n=f.status),"count"in f&&t(1,s=f.count),"newCount"in f&&t(2,c=f.newCount)},[n,s,c]}class Wt extends z{constructor(e){super(),J(this,e,It,vt,Y,{status:0,count:1,newCount:2})}}function K(o,e,t){const n=o.slice();return n[22]=e[t].count,n[23]=e[t].status,n}function Et(o){let e,t;return e=new pt({props:{class:"h-6 w-24 rounded"}}),{c(){F(e.$$.fragment)},l(n){P(e.$$.fragment,n)},m(n,s){Q(e,n,s),t=!0},p:at,i(n){t||(d(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){q(e,n)}}}function Ft(o){let e,t,n,s,c,f;function u(...a){return o[10](o[23],...a)}function r(...a){return o[11](o[23],...a)}t=new Wt({props:{status:o[23],count:o[22],newCount:o[1].find(u)?o[1].find(r).count-o[22]:0}});function i(){return o[12](o[23])}return{c(){e=j("button"),F(t.$$.fragment),n=ut()},l(a){e=H(a,"BUTTON",{});var m=L(e);P(t.$$.fragment,m),n=lt(m),m.forEach(h)},m(a,m){W(a,e,m),Q(t,e,null),ct(e,n),s=!0,c||(f=ft(e,"click",i),c=!0)},p(a,m){o=a;const p={};m&1&&(p.status=o[23]),m&1&&(p.count=o[22]),m&3&&(p.newCount=o[1].find(u)?o[1].find(r).count-o[22]:0),t.$set(p)},i(a){s||(d(t.$$.fragment,a),s=!0)},o(a){k(t.$$.fragment,a),s=!1},d(a){a&&h(e),q(t),c=!1,f()}}}function U(o,e){let t,n,s,c,f;const u=[Ft,Et],r=[];function i(a,m){return a[2]?1:0}return n=i(e),s=r[n]=u[n](e),{key:o,first:null,c(){t=v(),s.c(),c=v(),this.h()},l(a){t=v(),s.l(a),c=v(),this.h()},h(){this.first=t},m(a,m){W(a,t,m),r[n].m(a,m),W(a,c,m),f=!0},p(a,m){e=a;let p=n;n=i(e),n===p?r[n].p(e,m):(X(),k(r[p],1,1,()=>{r[p]=null}),Z(),s=r[n],s?s.p(e,m):(s=r[n]=u[n](e),s.c()),d(s,1),s.m(c.parentNode,c))},i(a){f||(d(s),f=!0)},o(a){k(s),f=!1},d(a){a&&(h(t),h(c)),r[n].d(a)}}}function Pt(o){let e,t=[],n=new Map,s,c=A(o[0]);const f=u=>u[23];for(let u=0;u<c.length;u+=1){let r=K(o,c,u),i=f(r);n.set(i,t[u]=U(i,r))}return{c(){e=j("div");for(let u=0;u<t.length;u+=1)t[u].c();this.h()},l(u){e=H(u,"DIV",{class:!0});var r=L(e);for(let i=0;i<t.length;i+=1)t[i].l(r);r.forEach(h),this.h()},h(){rt(e,"class","flex min-h-[24px] flex-wrap items-center gap-2")},m(u,r){W(u,e,r);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null);s=!0},p(u,[r]){r&15&&(c=A(u[0]),X(),t=it(t,r,f,1,u,c,n,e,mt,U,null,K),Z())},i(u){if(!s){for(let r=0;r<c.length;r+=1)d(t[r]);s=!0}},o(u){for(let r=0;r<t.length;r+=1)k(t[r]);s=!1},d(u){u&&h(e);for(let r=0;r<t.length;r+=1)t[r].d()}}}const V=5,E=100;function Qt(o,e,t){let n,s,c,f,u,r,i;y(o,dt,l=>t(7,c=l)),y(o,_t,l=>t(8,f=l)),y(o,G,l=>t(15,u=l)),y(o,I,l=>t(16,r=l)),y(o,kt,l=>t(9,i=l));let{staticQuery:a=""}=e,m=[],p=[],b,g=1,C=!1;st(()=>{B()});const x=()=>{if(g+=1,clearInterval(b),g<=E){const l=R(V,g,E)*1e3;b=setInterval(()=>M(),l)}},B=()=>{clearInterval(b),t(1,p=[]),S(I,r.newCount=0,r),g=1,t(2,C=!0)},T=(l=[])=>l.map(_=>{const w=bt(_==null?void 0:_.groupValues[0]),ot=parseInt(_.count);return{status:w,count:ot}}).sort((_,w)=>N.indexOf(_.status)-N.indexOf(w.status)),M=async()=>{x();try{const{count:l,groups:_}=await D({namespace:n,query:s});S(I,r.newCount=parseInt(l)-r.count,r),t(1,p=T(_))}catch(l){console.error("Fetching workflow counts failed: ",l==null?void 0:l.message)}finally{t(2,C=!1)}},$=async()=>{B();const l=R(V,g,E)*1e3;b=setInterval(()=>M(),l);try{const{count:_,groups:w}=await D({namespace:n,query:s});S(I,r.count=parseInt(_),r),t(0,m=T(w))}catch(_){console.error("Fetching workflow counts failed: ",_==null?void 0:_.message)}finally{t(2,C=!1)}},O=l=>{const _={attribute:"ExecutionStatus",type:yt.KEYWORD,value:l,operator:"",conditional:"=",parenthesis:""};S(G,u=[...u,_],u);const w=wt(ht(u));Ct({url:f.url,parameter:"query",value:w,allowEmpty:!0,clearParameters:[gt]})},tt=(l,_)=>_.status===l,et=(l,_)=>_.status===l,nt=l=>O(l);return o.$$set=l=>{"staticQuery"in l&&t(4,a=l.staticQuery)},o.$$.update=()=>{o.$$.dirty&256&&t(5,n=f.params.namespace),o.$$.dirty&528&&t(6,s=a||i),o.$$.dirty&224&&$()},[m,p,C,O,a,n,s,c,f,i,tt,et,nt]}class Yt extends z{constructor(e){super(),J(this,e,Qt,Pt,Y,{staticQuery:4})}}export{Yt as W};
