import{w as v,g as $}from"./entry.B-CYNvs9.js";import{t as O}from"./translate.BBe5dcco.js";import"./i18next.DhwiOCyc.js";import{s as T}from"./parse-with-big-int.BKSBwM2t.js";import{r as h,a as p}from"./route-for-api.Br1NH32y.js";import{v as k}from"./toaster.C-BAE4pG.js";import{s as E}from"./workflows.Dj8DHY5m.js";import{e as q}from"./encode-payload.BQdTwHvO.js";import{l as A,m as _}from"./route-for.B4ZaK-ym.js";const J=async(e,o,t,s=fetch)=>(n=100,i="")=>{const a=h("schedules",{namespace:e});return p(a,{params:{maximumPageSize:String(n),nextPageToken:i,...o?{query:o}:{}},request:s,onError:t}).then(({schedules:r,nextPageToken:c})=>({items:r,nextPageToken:c?String(c):""}))};async function K(e,o=fetch){const t=h("schedule",e);return p(t,{request:o})}async function N(e,o=fetch){const t=h("schedule",e);return p(t,{request:o,options:{method:"DELETE"}})}async function F({namespace:e,scheduleId:o,body:t}){let s="";const n=r=>{var c;return s=((c=r==null?void 0:r.body)==null?void 0:c.message)??`Error creating schedule: ${r.status}: ${r.statusText}`},i=h("schedule",{namespace:e,scheduleId:o}),{conflictToken:a}=await p(i,{options:{method:"POST",body:T({request_id:k(),...t})},onError:n});return{conflictToken:a,error:s}}async function M({namespace:e,scheduleId:o,body:t}){let s="";const n=a=>{var r;return s=((r=a==null?void 0:a.body)==null?void 0:r.message)??`Error editing schedule: ${a.status}: ${a.statusText}`},i=h("schedule.edit",{namespace:e,scheduleId:o});return await p(i,{options:{method:"POST",body:T({request_id:k(),...t})},onError:n}),{error:s}}async function U({namespace:e,scheduleId:o,reason:t}){const s={patch:{pause:t}},n=h("schedule.patch",{namespace:e,scheduleId:o});return await p(n,{options:{method:"POST",body:T({...s,request_id:k()})},onError:i=>console.error(i)})}async function V({namespace:e,scheduleId:o,reason:t}){const s={patch:{unpause:t}},n=h("schedule.patch",{namespace:e,scheduleId:o});return await p(n,{options:{method:"POST",body:T({...s,request_id:k()})}})}async function X({namespace:e,scheduleId:o,overlapPolicy:t}){const s={patch:{triggerImmediately:{overlapPolicy:t}}},n=h("schedule.patch",{namespace:e,scheduleId:o});return await p(n,{options:{method:"POST",body:T({...s,request_id:k()})}})}async function Y({namespace:e,scheduleId:o,overlapPolicy:t,startTime:s,endTime:n}){const i={patch:{backfillRequest:[{overlapPolicy:t,startTime:s,endTime:n}]}},a=h("schedule.patch",{namespace:e,scheduleId:o});return await p(a,{options:{method:"POST",body:T({...i,request_id:k()})}})}const b=e=>e?parseInt(e):0,W=(e,o,t,s)=>`${b(e)*60*60*24+b(o)*60*60+b(t)*60+b(s)}s`,C=({months:e=[],daysOfMonth:o=[],daysOfWeek:t=[]})=>{var r,c;const s=e.sort((d,u)=>parseInt(d)-parseInt(u)).join(","),n=o.sort((d,u)=>d-u).join(","),a=(((c=(r=t==null?void 0:t[0])==null?void 0:r.split(","))==null?void 0:c.length)>1?t[0].split(","):t).sort((d,u)=>parseInt(d)-parseInt(u)).join(",");return{month:s,dayOfMonth:n,dayOfWeek:a}},x=(e,o,t)=>{const{hour:s,minute:n,second:i,phase:a,cronString:r}=o,{preset:c,months:d,days:u,daysOfMonth:m,daysOfWeek:f}=t;if(c==="string"){const l=`${r}#${r}`;e.schedule.spec.cronString=[l],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(c==="interval"){const l=W(u,s,n,i);e.schedule.spec.interval=[{interval:l,phase:a||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:l,dayOfMonth:g,dayOfWeek:y}=C({months:d,daysOfMonth:m,daysOfWeek:f});e.schedule.spec.calendar=[{year:"*",month:c==="month"?l:"",dayOfMonth:c==="month"?g:"",dayOfWeek:c==="week"?y:"",hour:s,minute:n,second:i}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}},Z=async({action:e,spec:o,presets:t})=>{const{namespace:s,name:n,workflowId:i,workflowType:a,taskQueue:r,input:c,encoding:d,searchAttributes:u}=e;let m;if(c)try{m=await q(c,d)}catch(g){S.set(`${O("data-encoder.encode-error")}: ${g==null?void 0:g.message}`);return}const f={schedule_id:n.trim(),searchAttributes:u.length===0?null:{indexedFields:{...E(u)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:a},taskQueue:{name:r},input:m?{payloads:m}:null}}}};x(f,o,t),w.set(!0);const{error:l}=await F({scheduleId:n,namespace:s,body:f});l?(S.set(l),w.set(!1)):setTimeout(()=>{S.set(""),w.set(!1),$(A({namespace:s}))},2e3)},ee=async({action:e,spec:o,presets:t},s,n)=>{const{namespace:i,name:a,workflowId:r,workflowType:c,taskQueue:d,input:u,encoding:m,searchAttributes:f}=e;let l;if(u)try{l=await q(u,m)}catch(I){S.set(`${O("data-encoder.encode-error")}: ${I==null?void 0:I.message}`);return}const{preset:g}=t,y={schedule_id:n,searchAttributes:f.length===0?null:{indexedFields:{...E(f)}},schedule:{...s,action:{startWorkflow:{...s.action.startWorkflow,workflowId:r,workflowType:{name:c},taskQueue:{name:d},input:l?{payloads:l}:null}}}};g==="existing"?y.schedule.spec=s.spec:(x(y,o,t),y.schedule.spec.structuredCalendar=[]),w.set(!0);const{error:P}=await M({namespace:i,scheduleId:n,body:y});P?(S.set(P),w.set(!1)):setTimeout(()=>{$(_({namespace:i,scheduleId:a})),S.set(""),w.set(!1)},2e3)},w=v(!1),S=v(""),te=v("0");export{Z as a,te as b,J as c,N as d,S as e,K as f,Y as g,w as l,U as p,ee as s,X as t,V as u};
