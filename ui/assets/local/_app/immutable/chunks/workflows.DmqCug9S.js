import{d as m,r as it,w as I}from"./entry.BILRi0hW.js";import{p as h}from"./stores.BOIcJUei.js";import{t as T}from"./translate.BBe5dcco.js";import{v as q,C as k}from"./scheduler.DugrFyli.js";import{r as E,a as w,i as G,c as ct,p as ut,d as ft,e as lt,f as dt,m as W}from"./route-for-api.BCy27JUV.js";import{A as _}from"./workflow-actions.TBME1SPK.js";import{b as wt,c as Et}from"./decode-payload.CevN8AR4.js";import{f as mt,g as kt,h as ht}from"./screaming-enums.w0zEi9dM.js";import{s as Pt,c as z,t as x}from"./versions.BMj2gRDL.js";import{s as yt}from"./index.BjtycQwR.js";import{a as C}from"./auth-user.BjDNQGC4.js";import{c as It}from"./events.BPZkPpVg.js";import{e as X,s as Tt}from"./encode-payload.DmPMCqWh.js";import{s as A}from"./parse-with-big-int.BKSBwM2t.js";import{i as _t,c as At,d as Q,e as St}from"./format-time.6TuExJAg.js";import{a as gt}from"./events-service.CQ22gfLT.js";import{v as xt}from"./toaster.W1dTMglN.js";const bt=async(t,o,n=fetch)=>{let r=0;try{const e=E("workflows.count",{namespace:t}),s=await w(e,{params:o?{query:o}:{},onError:q,handleError:q,request:n});r=parseInt((s==null?void 0:s.count)||"0")}catch{}return{count:r}},Ao=async({namespace:t,query:o})=>{const n="GROUP BY ExecutionStatus",r=E("workflows.count",{namespace:t}),{count:e,groups:s}=await w(r,{params:{query:o?`${o} ${n}`:`${n}`},notifyOnError:!1});return{count:e??"0",groups:s}},So=async({namespace:t})=>{const o='TemporalNamespaceDivision="TemporalScheduler" AND ExecutionStatus="Running"',n=E("workflows.count",{namespace:t}),{count:r}=await w(n,{params:{query:o},notifyOnError:!1});return r??"0"},Lt=(t=Pt)=>!k(t).disableWriteActions,Wt=(t=[])=>t.map(o=>{const n=yt(o,!0),r=o.activityId;return{...n,id:r}}),Ct=t=>t?t.map(o=>({...o,state:kt(o.state)})):[],Rt=t=>t?t.map(o=>({...o,state:ht(o.state)})):[],Yt=t=>!t||!t.indexedFields?{}:{indexedFields:Object.entries(t.indexedFields).reduce((n,[r,e])=>({...n,[r]:wt(e)}),{})},R=t=>{var D,O,U,F,v,B,$,V;const o=Yt(t.workflowExecutionInfo.searchAttributes),n=t.workflowExecutionInfo.memo,r=t.workflowExecutionInfo.type.name,e=t.workflowExecutionInfo.execution.workflowId,s=t.workflowExecutionInfo.execution.runId,i=t.workflowExecutionInfo.startTime,a=t.workflowExecutionInfo.closeTime,u=t.workflowExecutionInfo.executionTime,l=mt(t.workflowExecutionInfo.status),f=l==="Running",d=t.workflowExecutionInfo.historyLength,c=t.workflowExecutionInfo.historySizeBytes,P=`/workflows/${e}/${s}`,y=((O=(D=t==null?void 0:t.executionConfig)==null?void 0:D.taskQueue)==null?void 0:O.name)||((U=t==null?void 0:t.workflowExecutionInfo)==null?void 0:U.taskQueue),p=(F=t==null?void 0:t.workflowExecutionInfo)==null?void 0:F.mostRecentWorkerVersionStamp,J=(v=t==null?void 0:t.workflowExecutionInfo)==null?void 0:v.assignedBuildId,M=(B=t==null?void 0:t.workflowExecutionInfo)==null?void 0:B.parentNamespaceId,Z=($=t==null?void 0:t.workflowExecutionInfo)==null?void 0:$.parentExecution,tt=t.workflowExecutionInfo.stateTransitionCount,ot=(V=t.executionConfig)==null?void 0:V.defaultWorkflowTaskTimeout,nt=Wt(t.pendingActivities),rt=(t==null?void 0:t.pendingChildren)??[],et=Ct(t==null?void 0:t.pendingNexusOperations),st=t==null?void 0:t.pendingWorkflowTask,at=Rt(t==null?void 0:t.callbacks);return{name:r,id:e,runId:s,startTime:i,endTime:a,executionTime:u,status:l,historyEvents:d,historySizeBytes:c,searchAttributes:o,memo:n,url:P,taskQueue:y,assignedBuildId:J,mostRecentWorkerVersionStamp:p,pendingActivities:nt,pendingChildren:rt,pendingNexusOperations:et,pendingWorkflowTask:st,callbacks:at,parentNamespaceId:M,parent:Z,stateTransitionCount:tt,isRunning:f,defaultWorkflowTaskTimeout:ot,get canBeTerminated(){return f&&Lt()}}},Y=t=>(t.executions||[]).map(o=>R({workflowExecutionInfo:o})),Nt=(t,o)=>{var n;return((n=t==null?void 0:t.visibilityStore)==null?void 0:n.includes("elasticsearch"))||G(o,"1.19")},pt=t=>{var o;return(o=t==null?void 0:t.visibilityStore)==null?void 0:o.includes("elasticsearch")},b=m([h],([t])=>{var o,n,r;return(r=(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.runtimeEnvironment)==null?void 0:r.isCloud}),j=m([z,x,b],([t,o,n])=>Nt(t,o)||n);m([z,b],([t,o])=>pt(t)||o);var S=(t=>(t[t.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL=1]="RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL",t[t.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE=2]="RESET_REAPPLY_EXCLUDE_TYPE_UPDATE",t))(S||{}),g=(t=>(t[t.RESET_REAPPLY_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_TYPE_SIGNAL=1]="RESET_REAPPLY_TYPE_SIGNAL",t[t.RESET_REAPPLY_TYPE_NONE=2]="RESET_REAPPLY_TYPE_NONE",t[t.RESET_REAPPLY_TYPE_ALL_ELIGIBLE=3]="RESET_REAPPLY_TYPE_ALL_ELIGIBLE",t))(g||{});const Dt={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},Ot=["workflowId","workflowType","timeRange","executionStatus","closeTime"],Ut=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),Ft=t=>{if(typeof t!="string")return!1;for(const o of Ot)if(o===t)return!0;return!1},vt=(t,o,n)=>{const r=Dt[t];return o==="All"?"":_t(o)||At(o)?n||k(j)?`${r} > "${Q(o)}"`:`${r} BETWEEN "${Q(o)}" AND "${St()}"`:`${r}="${o}"`},Bt=(t,o)=>Object.entries(t).map(([n,r])=>{if(Ft(n)&&Ut(r))return vt(n,r,o)}).filter(Boolean),$t=(t,o=!1)=>Bt(t,o).join(" and ");function Vt(t){console.error("Unhandled action:",t)}const qt=(t,o)=>{let n;switch(t){case _.Cancel:n=T("workflows.canceled");break;case _.Reset:n=T("workflows.reset");break;case _.Terminate:n=T("workflows.terminated");break;default:Vt(t)}return o?T("workflows.workflow-action-reason-placeholder-with-email",{action:n,email:o}):T("workflows.workflow-action-reason-placeholder",{action:n})},K=({action:t,reason:o,email:n})=>{const r=qt(t,n);return o?[o.trim(),r].join(" "):r},N=async(t,o,n=fetch,r=!1)=>{const e=o.query||$t(o,r);let s;try{s=decodeURIComponent(e)}catch{s=e}const i=r?"workflows.archived":"workflows";let a="";const u=c=>{var P,y;ft(c),(P=c==null?void 0:c.body)!=null&&P.message||c!=null&&c.status?a=((y=c==null?void 0:c.body)==null?void 0:y.message)??`Error fetching workflows: ${c.status}: ${c.statusText}`:a="Error fetching workflows: Server failed to respond"},l=E(i,{namespace:t}),{executions:f,nextPageToken:d}=await w(l,{params:{query:s},onError:u,handleError:u,request:n})??{executions:[],nextPageToken:""};return{workflows:Y({executions:f}),nextPageToken:String(d),error:a}},go=async({namespace:t,workflowId:o,url:n},r=fetch)=>{var f;const e="workflows",s=n??ct(t),i=ut(e,{namespace:t}),a=s+i,{executions:u}=await w(a,{params:{query:`WorkflowId="${o}"`,pageSize:"1"},request:r})??{executions:[]},l=(f=Y({executions:u}))==null?void 0:f[0];return{runId:l==null?void 0:l.runId}},xo=async(t,o=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const s=a=>{(lt(a)||dt(a))&&(e=!1)},i=E(r,{namespace:t});return await w(i,{params:{pageSize:"1"},onError:s,handleError:s,request:o}),{authorized:e}},bo=async(t,o,n=fetch)=>N(t,o,n,!0);async function Lo(t,o=fetch){const n=E("workflow",{namespace:t.namespace,workflowId:t.workflowId});return w(n,{request:o,notifyOnError:!1,params:{"execution.runId":t.runId}}).then(r=>({workflow:R(r)})).catch(r=>({error:r}))}async function Wo({workflow:t,namespace:o,reason:n}){const r=E("workflow.terminate",{namespace:o,workflowId:t.id}),e=k(C).email,s=K({reason:n,action:_.Terminate,email:e});return await w(r,{options:{method:"POST",body:A({reason:s,...e&&{identity:e}})},notifyOnError:!1,params:{"execution.runId":t.runId}})}async function Co({namespace:t,workflow:{id:o,runId:n}},r=fetch){const e=E("workflow.cancel",{namespace:t,workflowId:o});return w(e,{request:r,notifyOnError:!1,options:{method:"POST"},params:{"execution.runId":n}})}async function Ro({namespace:t,workflow:{id:o,runId:n},name:r,input:e}){const s=E("workflow.signal",{namespace:t,workflowId:o,signalName:r}),i=await X(e),a=k(h).data.settings,u=(a==null?void 0:a.version)??"",f=G(u,"2.22")?{signalName:r,workflowExecution:{workflowId:o,runId:n},input:{payloads:i}}:{signalName:r,input:{payloads:i},params:{"execution.runId":n}};return w(s,{notifyOnError:!1,options:{method:"POST",body:A(f)}})}async function Yo({namespace:t,workflow:{id:o,runId:n},eventId:r,reason:e,includeSignals:s,excludeSignals:i,excludeUpdates:a}){const u=E("workflow.reset",{namespace:t,workflowId:o}),l=k(C).email,f=K({action:_.Reset,reason:e,email:l}),d={workflowExecution:{workflowId:o,runId:n},workflowTaskFinishEventId:r,requestId:xt(),reason:f};if(k(b)||W("1.24.0",k(x))){const c=[];!i&&!a&&c.push(S.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED),i&&c.push(S.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL),a&&c.push(S.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE),d.resetReapplyExcludeTypes=c,d.resetReapplyType=g.RESET_REAPPLY_TYPE_ALL_ELIGIBLE}else{let c;s?c=g.RESET_REAPPLY_TYPE_SIGNAL:c=g.RESET_REAPPLY_TYPE_NONE,d.resetReapplyType=c}return w(u,{notifyOnError:!1,options:{method:"POST",body:A(d)},params:{"execution.runId":n}})}async function No(t,o=fetch){const n=e=>{console.error(e)},r=E("workflow",t);return w(r,{request:o,onError:n,handleError:n}).then(R)}async function po(t,o,n){if(!k(H))return[];try{let r=`ParentWorkflowId = "${o}"`;n&&(r+=` AND ParentRunId = "${n}"`);const{workflows:e}=await N(t,{query:r});return e}catch{return[]}}const Qt=t=>{if(!t.length)return{};const o={};return t.forEach(n=>{o[n.attribute]=Tt(n.value)}),o};async function Do({namespace:t,workflowId:o,taskQueue:n,workflowType:r,input:e,searchAttributes:s}){const i=E("workflow",{namespace:t,workflowId:o});let a;if(e)try{a=await X(e)}catch{console.error("Could not decode input for starting workflow")}const u=A({workflowId:o,taskQueue:{name:n},workflowType:{name:r},input:a?{payloads:a}:null,searchAttributes:s.length===0?null:{indexedFields:{...Qt(s)}}});return w(i,{notifyOnError:!1,options:{method:"POST",body:u}})}const Oo=async({namespace:t,workflowType:o,workflowId:n})=>{var s,i,a;const r=u=>{console.error(u)},e={input:"",searchAttributes:void 0};try{let u="";o&&n?u=`WorkflowType = "${o}" AND WorkflowId = "${n}"`:o?u=`WorkflowType = "${o}"`:n&&(u=`WorkflowId = "${n}"`);const l=E("workflows",{namespace:t}),f=await w(l,{params:{query:u,pageSize:"1"},handleError:r});if(!((s=f==null?void 0:f.executions)!=null&&s[0]))return e;const d=Y(f)[0],P=await gt({namespace:t,workflowId:d.id,runId:d.runId}),y=await Et((i=P==null?void 0:P.attributes)==null?void 0:i.input,t,k(h).data.settings,k(C).accessToken);return{input:A(y==null?void 0:y.payloads[0]),searchAttributes:(a=d==null?void 0:d.searchAttributes)==null?void 0:a.indexedFields}}catch{return e}},Gt=300,zt=async(t,o,n)=>{o.set(!0);try{await n()}catch(r){console.error(r)}t.set(!1),setTimeout(()=>{o.set(!1)},Gt)},Xt=m([h],([t])=>{var o,n,r;return!!((r=(n=(o=t.data)==null?void 0:o.systemInfo)==null?void 0:n.capabilities)!=null&&r.countGroupByExecutionStatus)}),Uo=m([h,x],([t,o])=>{var e,s,i;const n=W("1.23.0",o),r=!!((i=(s=(e=t.data)==null?void 0:e.systemInfo)==null?void 0:s.capabilities)!=null&&i.prefixSearch);return n||r}),jt=I(0),Kt=m([h],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.hideWorkflowQueryErrors}),Fo=m([h],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.refreshWorkflowCountsDisabled}),H=m([b,x],([t,o])=>t||W("1.23.0",o)),Ht=m([h],([t])=>t.url.searchParams.get("query")),Jt=m([Ht,H,It],([t,o,n])=>o&&!n?t?`ParentWorkflowId is NULL AND ${t}`:"ParentWorkflowId is NULL":t),Mt=m([h],([t])=>t.params.namespace),Zt=m([Mt,Jt,jt,j,Kt],([t,o,n,r,e])=>({namespace:t,query:o,refresh:n,supportsAdvancedVisibility:r,hideWorkflowQueryErrors:e})),to=t=>{eo.set({...t,newCount:0})},oo=t=>Zt.subscribe(({namespace:o,query:n,supportsAdvancedVisibility:r,hideWorkflowQueryErrors:e})=>{zt(ro,no,async()=>{const{workflows:s,error:i}=await N(o,{query:n});if(t(s),r&&!k(Xt)){const a=await bt(o,n);to(a)}i?e?L.set(T("workflows.workflows-error-querying")):L.set(i):L.set("")})}),vo=I(""),no=I(!0),ro=I(!0),eo=I({count:0,newCount:0}),L=I(""),Bo=it([],oo),$o=I("");export{$o as A,qt as B,H as C,Bo as D,ro as E,no as F,L as G,xo as a,Ao as b,Co as c,Fo as d,vo as e,go as f,Oo as g,Do as h,j as i,po as j,So as k,b as l,Lt as m,bo as n,$t as o,Yo as p,Jt as q,jt as r,Qt as s,Wo as t,Ro as u,Lo as v,eo as w,No as x,Xt as y,Uo as z};
