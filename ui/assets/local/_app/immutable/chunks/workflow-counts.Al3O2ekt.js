import{s as j,h as H,j as L,k as z,f as h,m as st,i as E,c as y,a5 as rt,w as S,x as v,v as at,b as ut,d as lt,n as ct,p as it}from"./scheduler.H4VsQ-sj.js";import{S as J,i as X,c as P,a as Q,m as q,t as d,b as k,d as B,g as Z,e as x}from"./index.sfP9ULII.js";import{e as N,u as ft,o as mt}from"./each.xexp1xaz.js";import{p as _t}from"./stores.SM7k4qxi.js";import{S as pt}from"./index._WzZxiIO.js";import{t as wt,c as ht,w as D}from"./translate.o85F2SOm.js";import{r as dt,w as I,q as kt,b as G}from"./workflows.KFOkrMfS.js";import{w as R}from"./events.NVJonSpA.js";import{c as gt}from"./pagination.MDnVFsNk.js";import{S as yt}from"./time-picker.QvJGL6pk.js";import{b as bt}from"./decode-payload.K9xXbpD4.js";import{u as Ct}from"./update-query-parameters.Z_7DywZ-.js";import{W as St}from"./workflow-status.3kPrGuQW.js";const K=(o,e,t)=>{const r=Math.pow(3600/o,1/t),c=o*Math.pow(r,e);return Math.min(3600,Math.round(c))};function vt(o){let e,t;return e=new St({props:{count:o[1],newCount:o[2],status:o[0],"test-id":"workflow-status-"+o[0]}}),{c(){P(e.$$.fragment)},l(n){Q(e.$$.fragment,n)},m(n,r){q(e,n,r),t=!0},p(n,[r]){const c={};r&2&&(c.count=n[1]),r&4&&(c.newCount=n[2]),r&1&&(c.status=n[0]),r&1&&(c["test-id"]="workflow-status-"+n[0]),e.$set(c)},i(n){t||(d(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function It(o,e,t){let{status:n}=e,{count:r=0}=e,{newCount:c=0}=e;return o.$$set=i=>{"status"in i&&t(0,n=i.status),"count"in i&&t(1,r=i.count),"newCount"in i&&t(2,c=i.newCount)},[n,r,c]}class Et extends J{constructor(e){super(),X(this,e,It,vt,j,{status:0,count:1,newCount:2})}}function U(o,e,t){const n=o.slice();return n[22]=e[t].count,n[23]=e[t].status,n}function Wt(o){let e,t;return e=new pt({props:{class:"h-6 w-24 rounded"}}),{c(){P(e.$$.fragment)},l(n){Q(e.$$.fragment,n)},m(n,r){q(e,n,r),t=!0},p:at,i(n){t||(d(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Ft(o){let e,t,n,r,c,i;function a(...u){return o[10](o[23],...u)}function s(...u){return o[11](o[23],...u)}t=new Et({props:{status:o[23],count:o[22],newCount:o[1].find(a)?o[1].find(s).count-o[22]:0}});function f(){return o[12](o[23])}return{c(){e=H("button"),P(t.$$.fragment),n=ut()},l(u){e=L(u,"BUTTON",{});var m=z(e);Q(t.$$.fragment,m),n=lt(m),m.forEach(h)},m(u,m){E(u,e,m),q(t,e,null),ct(e,n),r=!0,c||(i=it(e,"click",f),c=!0)},p(u,m){o=u;const p={};m&1&&(p.status=o[23]),m&1&&(p.count=o[22]),m&3&&(p.newCount=o[1].find(a)?o[1].find(s).count-o[22]:0),t.$set(p)},i(u){r||(d(t.$$.fragment,u),r=!0)},o(u){k(t.$$.fragment,u),r=!1},d(u){u&&h(e),B(t),c=!1,i()}}}function V(o,e){let t,n,r,c,i;const a=[Ft,Wt],s=[];function f(u,m){return u[2]?1:0}return n=f(e),r=s[n]=a[n](e),{key:o,first:null,c(){t=v(),r.c(),c=v(),this.h()},l(u){t=v(),r.l(u),c=v(),this.h()},h(){this.first=t},m(u,m){E(u,t,m),s[n].m(u,m),E(u,c,m),i=!0},p(u,m){e=u;let p=n;n=f(e),n===p?s[n].p(e,m):(Z(),k(s[p],1,1,()=>{s[p]=null}),x(),r=s[n],r?r.p(e,m):(r=s[n]=a[n](e),r.c()),d(r,1),r.m(c.parentNode,c))},i(u){i||(d(r),i=!0)},o(u){k(r),i=!1},d(u){u&&(h(t),h(c)),s[n].d(u)}}}function Pt(o){let e,t=[],n=new Map,r,c=N(o[0]);const i=a=>a[23];for(let a=0;a<c.length;a+=1){let s=U(o,c,a),f=i(s);n.set(f,t[a]=V(f,s))}return{c(){e=H("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=L(a,"DIV",{class:!0});var s=z(e);for(let f=0;f<t.length;f+=1)t[f].l(s);s.forEach(h),this.h()},h(){st(e,"class","flex min-h-[24px] flex-wrap items-center gap-2")},m(a,s){E(a,e,s);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);r=!0},p(a,[s]){s&15&&(c=N(a[0]),Z(),t=ft(t,s,i,1,a,c,n,e,mt,V,null,U),x())},i(a){if(!r){for(let s=0;s<c.length;s+=1)d(t[s]);r=!0}},o(a){for(let s=0;s<t.length;s+=1)k(t[s]);r=!1},d(a){a&&h(e);for(let s=0;s<t.length;s+=1)t[s].d()}}}const Y=5,F=100;function Qt(o,e,t){let n,r,c,i,a,s,f;y(o,dt,l=>t(7,c=l)),y(o,_t,l=>t(8,i=l)),y(o,R,l=>t(15,a=l)),y(o,I,l=>t(16,s=l)),y(o,kt,l=>t(9,f=l));let{staticQuery:u=""}=e,m=[],p=[],b,g=1,C=!1;rt(()=>{T()});const $=()=>{if(g+=1,clearInterval(b),g<=F){const l=K(Y,g,F)*1e3;b=setInterval(()=>O(),l)}},T=()=>{clearInterval(b),t(1,p=[]),S(I,s.newCount=0,s),g=1,t(2,C=!0)},M=(l=[])=>l.map(_=>{const w=bt(_==null?void 0:_.groupValues[0]),W=parseInt(_.count);return{status:w,count:W}}).sort((_,w)=>D.indexOf(_.status)-D.indexOf(w.status)),O=async()=>{$();try{const{count:l,groups:_}=await G({namespace:n,query:r});S(I,s.newCount=parseInt(l)-s.count,s),t(1,p=M(_))}catch(l){console.error("Fetching workflow counts failed: ",l==null?void 0:l.message)}finally{t(2,C=!1)}},tt=async()=>{T();const l=K(Y,g,F)*1e3;b=setInterval(()=>O(),l);try{const{count:_,groups:w}=await G({namespace:n,query:r});S(I,s.count=parseInt(_),s),t(0,m=M(w))}catch(_){console.error("Fetching workflow counts failed: ",_==null?void 0:_.message)}finally{t(2,C=!1)}},A=l=>{if(!a.some(w=>w.attribute==="ExecutionStatus"&&w.value===l)){const w={attribute:"ExecutionStatus",type:yt.KEYWORD,value:l,operator:"",conditional:"=",parenthesis:""};S(R,a=[...a,w],a);const W=wt(ht(a));Ct({url:i.url,parameter:"query",value:W,clearParameters:[gt]})}},et=(l,_)=>_.status===l,nt=(l,_)=>_.status===l,ot=l=>A(l);return o.$$set=l=>{"staticQuery"in l&&t(4,u=l.staticQuery)},o.$$.update=()=>{o.$$.dirty&256&&t(5,n=i.params.namespace),o.$$.dirty&528&&t(6,r=u||f),o.$$.dirty&224&&tt()},[m,p,C,A,u,n,r,c,i,f,et,nt,ot]}class Yt extends J{constructor(e){super(),X(this,e,Qt,Pt,j,{staticQuery:4})}}export{Yt as W};
