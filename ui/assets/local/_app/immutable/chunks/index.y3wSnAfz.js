import{h as z}from"./has.jAlz8LEJ.js";import{l as k,m,n as y,o as O,p as H,q as J,r as C,s as Q,a as W,c as v,t as _,u as V,v as N,w as F,x as X,b as G,y as Y,d as L,z as Z,A as tt,B as it,C as rt,i as et,D as nt,E as st,F as at,G as dt,H as ot,I as ut,J as P,K as R,L as U,M as q,N as A,O as w,P as S,Q as T,f as p,R as h,S as g,T as lt}from"./get-event-categorization.FG0XopMQ.js";import{i as ct}from"./index.DdSVX28I.js";import{i as Et,d as ft,g as pt}from"./get-single-attribute-for-event.xEIXwsaj.js";import{h as gt}from"./format-time.mO7HgO6k.js";const kt=(t,i)=>{let r;return k(t)&&(r=i.find(n=>n.activityId===t.attributes.activityId)),r},mt=(t,i)=>{let r;return m(t)&&(r=i.find(n=>n.scheduledEventId===t.id)),r},Ct=(t,i)=>t.find(r=>{var n,e;if(ct(i))return r.eventIds.has(i.id);if(Et(i))return((n=r.pendingActivity)==null?void 0:n.id)===i.id;if(ft(i))return((e=r==null?void 0:r.pendingNexusOperation)==null?void 0:e.scheduledEventId)===(i==null?void 0:i.scheduledEventId)}),M=t=>y(t)||O(t)||H(t)||J(t)||C(t)||Q(t)||W(t)||v(t)||_(t)||V(t),Wt=t=>I(t)?t.isFailureOrTimedOut:M(t),j=t=>N(t)||F(t)||X(t)||G(t),vt=t=>I(t)?t.isCanceled:j(t),B=t=>Y(t)||L(t),Nt=t=>I(t)?t.isTerminated:B(t),b=t=>Z(t)?String(t.activityTaskStartedEventAttributes.scheduledEventId):N(t)?String(t.activityTaskCanceledEventAttributes.scheduledEventId):tt(t)?String(t.activityTaskCancelRequestedEventAttributes.scheduledEventId):O(t)?String(t.activityTaskFailedEventAttributes.scheduledEventId):y(t)?String(t.activityTaskTimedOutEventAttributes.scheduledEventId):it(t)?String(t.activityTaskCompletedEventAttributes.scheduledEventId):rt(t)?String(t.childWorkflowExecutionStartedEventAttributes.initiatedEventId):L(t)?String(t.childWorkflowExecutionTerminatedEventAttributes.initiatedEventId):et(t)?String(t.childWorkflowExecutionCompletedEventAttributes.initiatedEventId):G(t)?String(t.childWorkflowExecutionCanceledEventAttributes.initiatedEventId):W(t)?String(t.childWorkflowExecutionFailedEventAttributes.initiatedEventId):v(t)?String(t.childWorkflowExecutionTimedOutEventAttributes.initiatedEventId):nt(t)?String(t.timerFiredEventAttributes.startedEventId):F(t)?String(t.timerCanceledEventAttributes.startedEventId):st(t)?String(t.workflowExecutionUpdateCompletedEventAttributes.acceptedEventId):at(t)?String(t.externalWorkflowExecutionSignaledEventAttributes.initiatedEventId):dt(t)?String(t.workflowTaskStartedEventAttributes.scheduledEventId):ot(t)?String(t.workflowTaskCompletedEventAttributes.scheduledEventId):ut(t)?String(t.workflowTaskFailedEventAttributes.scheduledEventId):C(t)?String(t.workflowTaskTimedOutEventAttributes.scheduledEventId):P(t)?String(t.nexusOperationStartedEventAttributes.scheduledEventId):R(t)?String(t.nexusOperationCompletedEventAttributes.scheduledEventId):U(t)?String(t.nexusOperationFailedEventAttributes.scheduledEventId):q(t)?String(t.nexusOperationCanceledEventAttributes.scheduledEventId):t.id,$=t=>{var i,r,n,e,l,s,f,o,a,d,E,c;if(!t)return"";if(k(t))return(r=(i=t.activityTaskScheduledEventAttributes)==null?void 0:i.activityType)==null?void 0:r.name;if(A(t))return`${(n=t.timerStartedEventAttributes)==null?void 0:n.timerId} (${gt((e=t.timerStartedEventAttributes)==null?void 0:e.startToFireTimeout)})`;if(w(t))return(l=t.signalExternalWorkflowExecutionInitiatedEventAttributes)==null?void 0:l.signalName;if(S(t))return(s=t.workflowExecutionSignaledEventAttributes)==null?void 0:s.signalName;if(T(t))return p(t)?"Local Activity":(f=t.markerRecordedEventAttributes)==null?void 0:f.markerName;if(h(t))return(a=(o=t.startChildWorkflowExecutionInitiatedEventAttributes)==null?void 0:o.workflowType)==null?void 0:a.name;if(g(t))return(c=(E=(d=t.workflowExecutionUpdateAcceptedEventAttributes)==null?void 0:d.acceptedRequest)==null?void 0:E.input)==null?void 0:c.name;if(m(t))return`${t.nexusOperationScheduledEventAttributes.service}.${t.nexusOperationScheduledEventAttributes.operation}`},At=t=>{if(!t)return"";if(k(t))return"Activity";if(A(t))return"Timer";if(w(t))return"Signal";if(S(t))return"Signal received";if(p(t))return"Local Activity";if(T(t))return"Marker";if(h(t))return"Child Workflow";if(g(t))return"Workflow Update";if(m(t)||P(t))return"Nexus Operation"},ht=t=>{var i,r;return t?p(t)?((r=(i=pt(t))==null?void 0:i.value)==null?void 0:r.toString())??"Local Activity":$(t):""},x=({events:t})=>{let i=0,r;for(const n of t.values()){const e=Number(n.id);e>=i&&(i=e,r=n)}return r},xt=(t,i)=>i!=null&&i.length&&g(t)?i.find(r=>{var n;return r.id===((n=t.workflowExecutionUpdateAcceptedEventAttributes)==null?void 0:n.acceptedRequestSequencingEventId.toString())}):t,u=(t,i)=>{const r=b(t),n=$(t),e=At(t),l=ht(t),{timestamp:s,category:f,classification:o}=t,a=xt(t,i),d=new Map,E=new Set;return a&&g(t)?(d.set(a.id,a),d.set(t.id,t),E.add(a.id),E.add(t.id)):(d.set(t.id,t),E.add(t.id)),{id:r,name:n,label:e,displayName:l,events:d,eventIds:E,initialEvent:a,timestamp:s,category:p(t)?"local-activity":f,classification:o,level:void 0,pendingActivity:void 0,pendingNexusOperation:void 0,get eventTime(){var c;return(c=this.lastEvent)==null?void 0:c.eventTime},get attributes(){var c;return(c=x(this))==null?void 0:c.attributes},get eventList(){return Array.from(this.events,([c,K])=>K)},get lastEvent(){return x(this)},get finalClassification(){return x(this).classification},get isPending(){return!!this.pendingActivity||!!this.pendingNexusOperation||A(this.initialEvent)&&this.eventList.length===1||h(this.initialEvent)&&this.eventList.length===2},get isFailureOrTimedOut(){return!!this.eventList.find(M)},get isCanceled(){return!!this.eventList.find(j)},get isTerminated(){return!!this.eventList.find(B)}}},wt=(t,i)=>{if(k(t)||h(t)||A(t)||w(t)||S(t))return u(t);if(T(t))return p(t),u(t);if(g(t)||m(t))return u(t,i)},St=(t,i)=>{if(lt(t))return u(t,i)},D=(t,i,r=void 0,n=void 0)=>{if(!t)return;t.events.set(i.id,i),t.eventIds.add(i.id),t.timestamp=i.timestamp,r&&(t.pendingActivity=r),t.pendingActivity&&t.eventList.length===3&&delete t.pendingActivity,n&&(t.pendingNexusOperation=n);const e=R(i)||U(i)||q(i);t.pendingNexusOperation&&e&&delete t.pendingNexusOperation},Ft=(t,i="ascending",r=[],n=[])=>{const e={},l=s=>{const f=b(s),o=wt(s,t),a=kt(s,r),d=mt(s,n);o?(e[o.id]=o,a&&(o.pendingActivity=a),d&&(o.pendingNexusOperation=d)):D(e[f],s,a,d)};if(i==="ascending")for(const s of t)l(s);else for(let s=t.length-1;s>=0;s--)l(t[s]);return i==="descending"?Object.values(e).reverse():Object.values(e)},I=t=>t==null?!1:z(t,"events"),Gt=(t,i="ascending")=>{const r={},n=e=>{const l=b(e),s=St(e,t);s?r[s.id]=s:D(r[l],e)};if(i==="ascending")for(const e of t)n(e);else for(let e=t.length-1;e>=0;e--)n(t[e]);return i==="descending"?Object.values(r).reverse():Object.values(r)};export{Ct as a,Gt as b,vt as c,Nt as d,Wt as e,Ft as g,I as i};
