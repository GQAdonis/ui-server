import{h as Q}from"./has.BWrERxPV.js";import{l as m,m as A,n as v,o as N,p as _,q as V,r as F,s as X,a as G,c as L,t as Y,u as Z,v as U,w as P,x as tt,b as q,y as it,d as R,z as et,A as rt,B as nt,C as st,i as at,D as dt,E as ot,F as ut,G as lt,H as ct,I as Et,J as M,K as j,L as B,M as $,N as x,O as S,P as T,Q as b,f as p,R as h,S as g,T as ft,U as pt}from"./get-event-categorization.gIZuMAOV.js";import{i as gt}from"./index.qT4p9uNp.js";import{i as kt,d as mt,g as At}from"./get-single-attribute-for-event.B-RIM1XV.js";import{h as xt}from"./format-time.6TuExJAg.js";const ht=(t,i)=>{let e;return m(t)&&(e=i.find(r=>r.activityId===t.attributes.activityId)),e},wt=(t,i)=>{let e;return A(t)&&(e=i.find(r=>r.scheduledEventId===t.id)),e},Ft=(t,i)=>t.find(e=>{var r,n;if(gt(i))return e.eventIds.has(i.id);if(kt(i))return((r=e.pendingActivity)==null?void 0:r.id)===i.id;if(mt(i))return((n=e==null?void 0:e.pendingNexusOperation)==null?void 0:n.scheduledEventId)===(i==null?void 0:i.scheduledEventId)}),D=t=>v(t)||N(t)||_(t)||V(t)||F(t)||X(t)||G(t)||L(t)||Y(t)||Z(t),Gt=t=>y(t)?t.isFailureOrTimedOut:D(t),K=t=>U(t)||P(t)||tt(t)||q(t),Lt=t=>y(t)?t.isCanceled:K(t),z=t=>it(t)||R(t),Ut=t=>y(t)?t.isTerminated:z(t),I=t=>et(t)?String(t.activityTaskStartedEventAttributes.scheduledEventId):U(t)?String(t.activityTaskCanceledEventAttributes.scheduledEventId):rt(t)?String(t.activityTaskCancelRequestedEventAttributes.scheduledEventId):N(t)?String(t.activityTaskFailedEventAttributes.scheduledEventId):v(t)?String(t.activityTaskTimedOutEventAttributes.scheduledEventId):nt(t)?String(t.activityTaskCompletedEventAttributes.scheduledEventId):st(t)?String(t.childWorkflowExecutionStartedEventAttributes.initiatedEventId):R(t)?String(t.childWorkflowExecutionTerminatedEventAttributes.initiatedEventId):at(t)?String(t.childWorkflowExecutionCompletedEventAttributes.initiatedEventId):q(t)?String(t.childWorkflowExecutionCanceledEventAttributes.initiatedEventId):G(t)?String(t.childWorkflowExecutionFailedEventAttributes.initiatedEventId):L(t)?String(t.childWorkflowExecutionTimedOutEventAttributes.initiatedEventId):dt(t)?String(t.timerFiredEventAttributes.startedEventId):P(t)?String(t.timerCanceledEventAttributes.startedEventId):ot(t)?String(t.workflowExecutionUpdateCompletedEventAttributes.acceptedEventId):ut(t)?String(t.externalWorkflowExecutionSignaledEventAttributes.initiatedEventId):lt(t)?String(t.workflowTaskStartedEventAttributes.scheduledEventId):ct(t)?String(t.workflowTaskCompletedEventAttributes.scheduledEventId):Et(t)?String(t.workflowTaskFailedEventAttributes.scheduledEventId):F(t)?String(t.workflowTaskTimedOutEventAttributes.scheduledEventId):M(t)?String(t.nexusOperationStartedEventAttributes.scheduledEventId):j(t)?String(t.nexusOperationCompletedEventAttributes.scheduledEventId):B(t)?String(t.nexusOperationFailedEventAttributes.scheduledEventId):$(t)?String(t.nexusOperationCanceledEventAttributes.scheduledEventId):t.id,H=(t,i)=>{var e,r,n,u,s,f,d,c,a,E,l,k,O,W,C;if(!t)return"";if(m(t))return(r=(e=t.activityTaskScheduledEventAttributes)==null?void 0:e.activityType)==null?void 0:r.name;if(x(t))return`${(n=t.timerStartedEventAttributes)==null?void 0:n.timerId} (${xt((u=t.timerStartedEventAttributes)==null?void 0:u.startToFireTimeout)})`;if(S(t))return(s=t.signalExternalWorkflowExecutionInitiatedEventAttributes)==null?void 0:s.signalName;if(T(t))return(f=t.workflowExecutionSignaledEventAttributes)==null?void 0:f.signalName;if(b(t))return p(t)?"Local Activity":(d=t.markerRecordedEventAttributes)==null?void 0:d.markerName;if(h(t))return(a=(c=t.startChildWorkflowExecutionInitiatedEventAttributes)==null?void 0:c.workflowType)==null?void 0:a.name;if(g(t))return ft(i)?(k=(l=(E=i.workflowExecutionUpdateAdmittedEventAttributes)==null?void 0:E.request)==null?void 0:l.input)==null?void 0:k.name:(C=(W=(O=t.workflowExecutionUpdateAcceptedEventAttributes)==null?void 0:O.acceptedRequest)==null?void 0:W.input)==null?void 0:C.name;if(A(t))return`${t.nexusOperationScheduledEventAttributes.service}.${t.nexusOperationScheduledEventAttributes.operation}`},St=t=>{if(!t)return"";if(m(t))return"Activity";if(x(t))return"Timer";if(S(t))return"Signal";if(T(t))return"Signal received";if(p(t))return"Local Activity";if(b(t))return"Marker";if(h(t))return"Child Workflow";if(g(t))return"Workflow Update";if(A(t)||M(t))return"Nexus Operation"},Tt=(t,i)=>{var e,r;return t?p(t)?((r=(e=At(t))==null?void 0:e.value)==null?void 0:r.toString())??"Local Activity":H(t,i):""},w=({events:t})=>{let i=0,e;for(const r of t.values()){const n=Number(r.id);n>=i&&(i=n,e=r)}return e},bt=(t,i)=>i!=null&&i.length&&g(t)?i.find(e=>{var r;return e.id===((r=t.workflowExecutionUpdateAcceptedEventAttributes)==null?void 0:r.acceptedRequestSequencingEventId.toString())}):t,o=(t,i)=>{const e=I(t),r=bt(t,i),n=H(t,r),u=St(t),s=Tt(t,r),{timestamp:f,category:d,classification:c}=t,a=new Map,E=new Set;return r&&g(t)?(a.set(r.id,r),a.set(t.id,t),E.add(r.id),E.add(t.id)):(a.set(t.id,t),E.add(t.id)),{id:e,name:n,label:u,displayName:s,events:a,eventIds:E,initialEvent:r,timestamp:f,category:p(t)?"local-activity":d,classification:c,level:void 0,pendingActivity:void 0,pendingNexusOperation:void 0,get eventTime(){var l;return(l=this.lastEvent)==null?void 0:l.eventTime},get attributes(){var l;return(l=w(this))==null?void 0:l.attributes},get eventList(){return Array.from(this.events,([l,k])=>k)},get lastEvent(){return w(this)},get finalClassification(){return w(this).classification},get isPending(){return!!this.pendingActivity||!!this.pendingNexusOperation||x(this.initialEvent)&&this.eventList.length===1||h(this.initialEvent)&&this.eventList.length===2},get isFailureOrTimedOut(){return!!this.eventList.find(D)},get isCanceled(){return!!this.eventList.find(K)},get isTerminated(){return!!this.eventList.find(z)}}},It=(t,i)=>{if(m(t)||h(t)||x(t)||S(t)||T(t))return o(t);if(b(t))return p(t),o(t);if(g(t)||A(t))return o(t,i)},yt=(t,i)=>{if(pt(t))return o(t,i)},J=(t,i,e=void 0,r=void 0)=>{if(!t)return;t.events.set(i.id,i),t.eventIds.add(i.id),t.timestamp=i.timestamp,e&&(t.pendingActivity=e),t.pendingActivity&&t.eventList.length===3&&delete t.pendingActivity,r&&(t.pendingNexusOperation=r);const n=j(i)||B(i)||$(i);t.pendingNexusOperation&&n&&delete t.pendingNexusOperation},Pt=(t,i="ascending",e=[],r=[])=>{const n={},u=s=>{const f=I(s),d=It(s,t),c=ht(s,e),a=wt(s,r);d?(n[d.id]=d,c&&(d.pendingActivity=c),a&&(d.pendingNexusOperation=a)):J(n[f],s,c,a)};if(i==="ascending")for(const s of t)u(s);else for(let s=t.length-1;s>=0;s--)u(t[s]);return i==="descending"?Object.values(n).reverse():Object.values(n)},y=t=>t==null?!1:Q(t,"events"),qt=(t,i="ascending")=>{const e={},r=n=>{const u=I(n),s=yt(n,t);s?e[s.id]=s:J(e[u],n)};if(i==="ascending")for(const n of t)r(n);else for(let n=t.length-1;n>=0;n--)r(t[n]);return i==="descending"?Object.values(e).reverse():Object.values(e)};export{Ft as a,qt as b,Lt as c,Ut as d,Gt as e,Pt as g,y as i};
