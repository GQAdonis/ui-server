import{B as f}from"./prod-browser.6V4A_NcJ.js";import{g as $}from"./auth-user.lHjyADY6.js";import{w as C}from"./entry.93_AU1mA.js";import{t as R}from"./toaster.5JA9aSMR.js";import{h as y}from"./has.qoQc8P9o.js";import{i as F}from"./is-network-error.TmI-ex3-.js";import{n as h,t as O}from"./route-for.3BYodP69.js";import{i as P}from"./persist-store.e2nDJpAi.js";import{C as I}from"./scheduler.tl3rb73C.js";import{b as W}from"./paths._YfuT1Fc.js";import{p as T}from"./stores.p0Go4W31.js";import{m as N}from"./version-check.HLZIw2tw.js";const S=C(null),_=(c,n=R,i=S,s=f)=>{if(!(c instanceof DOMException&&c.name==="AbortError"))throw typeof c=="string"?n.push({variant:"error",message:c}):c.report=!1,c instanceof Error&&n.push({variant:"error",message:c.message}),v(c)&&s&&window.location.assign(h(c==null?void 0:c.message)),x(c)&&s&&window.location.assign(h(c==null?void 0:c.message)),F(c)&&(n.push({variant:"error",message:`${c.statusCode} ${c.statusText}`}),i.set(c)),c},un=(c,n=f)=>{var s;const i=`${c==null?void 0:c.status} ${(s=c==null?void 0:c.body)==null?void 0:s.message}`;if(v(c)&&n){window.location.assign(h(i));return}if(x(c)&&n){window.location.assign(h(i));return}},v=c=>U(c,401),x=c=>U(c,403),U=(c,n)=>y(c,"statusCode")?c.statusCode===n:y(c,"status")?c.status===n:!1,ln=c=>(c==null?void 0:c.message)!==void 0&&typeof(c==null?void 0:c.message)=="string",tn=async(c,n={})=>{const{params:i={},request:s=fetch,token:u,notifyOnError:o=!0,handleError:t=_,onError:k,isBrowser:g=f}=n;let{options:w}=n,e=new URLSearchParams;if(i!=null&&i.entries)e=i,u&&e.set("nextPageToken",u);else{const l=u?{next_page_token:u}:{};e=new URLSearchParams({...i,...l})}const q=O(c,e);try{w=z(w,g),c.endsWith("api/v1/settings")||(w=await L(w,g));const l=await s(q,w),d=await l.json(),{status:E,statusText:A}=l;if(!l.ok)if(k&&P(k))k({status:E,statusText:A,body:d});else throw{statusCode:l.status,statusText:l.statusText,response:l,message:(d==null?void 0:d.message)??l.statusText};return d}catch(l){if(o)t(l);else throw l}},z=(c,n=f)=>{const i={credentials:"include",...c};return i.headers=J(c==null?void 0:c.headers,n),i},L=async(c,n=f)=>(globalThis!=null&&globalThis.AccessToken?c.headers=await b(c==null?void 0:c.headers,globalThis.AccessToken,n):$().accessToken&&(c.headers=await b(c==null?void 0:c.headers,async()=>$().accessToken,n),c.headers=B(c==null?void 0:c.headers,$().idToken,n)),c),b=async(c,n,i=f)=>{if(c||(c={}),!i)return c;try{const s=await n();s&&(c.Authorization=`Bearer ${s}`)}catch(s){console.error(s)}return c},B=(c={},n,i=f)=>(i&&n&&(c["Authorization-Extras"]=n),c),J=(c,n=f)=>{if(c||(c={}),c["Caller-Type"]="operator",!n)return c;const i="_csrf=",s="X-CSRF-TOKEN";try{let o=document.cookie.split(";").find(t=>t.includes(i));o&&!c[s]&&(o=o.trim().slice(i.length),c[s]=o)}catch(u){console.error(u)}return c};function D(c=f){const n="",i=!n.startsWith("http");let s="";return i?s=c?window.location.origin+n:"":s=n,s.endsWith("/")&&(s=s.slice(0,-1)),s}const H=(c,n)=>c?c.replace("%namespace%",n):"",K=c=>{var o,t;let n="";const i=(o=I(T).data)==null?void 0:o.webUrl,s=i&&c,u=((t=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:t.apiUrl)&&c;return s?n=i:u?(console.warn("Using fallback api url, web url not found"),n=H(globalThis.AppConfig.apiUrl,c)):n=D(),n.endsWith("/")&&(n=n.slice(0,-1)),n=`${n}${W}`,n},M=c=>(c.startsWith("/")&&(c=c.slice(1)),`/api/v1/${c}`),V=(c,n)=>`${K(n)}${c}`,X=c=>{var i,s,u;const n=(u=(s=(i=I(T))==null?void 0:i.data)==null?void 0:s.settings)==null?void 0:u.version;return Object.keys(c??{}).reduce((o,t)=>(n&&N("2.23.0",n)?o[t]=encodeURIComponent(c[t]):o[t]=encodeURIComponent(encodeURIComponent(c[t])),o),{namespace:"",workflowId:"",scheduleId:"",queue:"",queryType:"",signalName:"",batchJobId:"",activityId:"",endpointId:""})};function G(c,n,i=!0){i&&(n=X(n));const s={systemInfo:"/system-info",cluster:"/cluster-info",namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,"search-attributes":`/namespaces/${n.namespace}/search-attributes`,"events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history-reverse`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/query/${n.queryType}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,"schedule.patch":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/patch`,"schedule.edit":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/update`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,"task-queue.compatibility":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-build-id-compatibility`,"task-queue.rules":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-versioning-rules`,user:"/me","worker-task-reachability":`/namespaces/${n==null?void 0:n.namespace}/worker-task-reachability`,"workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/terminate`,"workflow.cancel":`/namespaces/${n.namespace}/workflows/${n.workflowId}/cancel`,"workflow.signal":`/namespaces/${n.namespace}/workflows/${n.workflowId}/signal/${n.signalName}`,"workflow.reset":`/namespaces/${n.namespace}/workflows/${n.workflowId}/reset`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/archived-workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflow-count`,"activity.complete":`/namespaces/${n.namespace}/activities/complete-by-id`,"activity.fail":`/namespaces/${n.namespace}/activities/fail-by-id`,"batch-operations.list":`/namespaces/${n.namespace}/batch-operations`,"batch-operations":`/namespaces/${n.namespace}/batch-operations/${n==null?void 0:n.batchJobId}`,"nexus-endpoints":"/nexus/endpoints","nexus-endpoint":`/nexus/endpoints/${n.endpointId}`,"nexus-endpoint.update":`/nexus/endpoints/${n.endpointId}/update`};return M(s[c])}function fn(c,n,i=!0){const s=G(c,n,i);return V(s,n==null?void 0:n.namespace)}export{tn as a,K as b,un as c,v as d,x as e,D as g,_ as h,ln as i,S as n,G as p,fn as r};
