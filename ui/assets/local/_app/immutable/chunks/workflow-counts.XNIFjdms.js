import{s as z,h as Z,j as x,k as $,f as I,m as tt,i as W,c as y,a5 as et,w as v,x as C,v as nt}from"./scheduler.OdTyv_h4.js";import{S as H,i as J,c as q,a as M,m as B,t as h,b as p,d as Q,g as K,e as L}from"./index.oB682ev8.js";import{e as N,u as ot,o as st}from"./each.QcvZsK_H.js";import{p as rt}from"./stores.hmp8xZHl.js";import{S as at}from"./index.JdCO7qfN.js";import{w as O}from"./translate.zYlm6who.js";import{r as ut,w as b,q as ct,c as P}from"./workflows.-tluN5X_.js";import{b as lt}from"./decode-payload.ciCnHnI-.js";import{W as ft}from"./workflow-status.wdArcqN0.js";const A=(o,e,t)=>{const r=Math.pow(3600/o,1/t),s=o*Math.pow(r,e);return Math.min(3600,Math.round(s))};function it(o){let e,t;return e=new ft({props:{count:o[1],newCount:o[2],status:o[0],"test-id":"workflow-status-"+o[0]}}),{c(){q(e.$$.fragment)},l(n){M(e.$$.fragment,n)},m(n,r){B(e,n,r),t=!0},p(n,[r]){const s={};r&2&&(s.count=n[1]),r&4&&(s.newCount=n[2]),r&1&&(s.status=n[0]),r&1&&(s["test-id"]="workflow-status-"+n[0]),e.$set(s)},i(n){t||(h(e.$$.fragment,n),t=!0)},o(n){p(e.$$.fragment,n),t=!1},d(n){Q(e,n)}}}function mt(o,e,t){let{status:n}=e,{count:r=0}=e,{newCount:s=0}=e;return o.$$set=c=>{"status"in c&&t(0,n=c.status),"count"in c&&t(1,r=c.count),"newCount"in c&&t(2,s=c.newCount)},[n,r,s]}class _t extends H{constructor(e){super(),J(this,e,mt,it,z,{status:0,count:1,newCount:2})}}function D(o,e,t){const n=o.slice();return n[19]=e[t].count,n[20]=e[t].status,n}function wt(o){let e,t;return e=new at({props:{class:"h-6 w-24 rounded"}}),{c(){q(e.$$.fragment)},l(n){M(e.$$.fragment,n)},m(n,r){B(e,n,r),t=!0},p:nt,i(n){t||(h(e.$$.fragment,n),t=!0)},o(n){p(e.$$.fragment,n),t=!1},d(n){Q(e,n)}}}function ht(o){let e,t;function n(...s){return o[9](o[20],...s)}function r(...s){return o[10](o[20],...s)}return e=new _t({props:{status:o[20],count:o[19],newCount:o[1].find(n)?o[1].find(r).count-o[19]:0}}),{c(){q(e.$$.fragment)},l(s){M(e.$$.fragment,s)},m(s,c){B(e,s,c),t=!0},p(s,c){o=s;const u={};c&1&&(u.status=o[20]),c&1&&(u.count=o[19]),c&3&&(u.newCount=o[1].find(n)?o[1].find(r).count-o[19]:0),e.$set(u)},i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){p(e.$$.fragment,s),t=!1},d(s){Q(e,s)}}}function V(o,e){let t,n,r,s,c;const u=[ht,wt],a=[];function f(m,_){return m[2]?1:0}return n=f(e),r=a[n]=u[n](e),{key:o,first:null,c(){t=C(),r.c(),s=C(),this.h()},l(m){t=C(),r.l(m),s=C(),this.h()},h(){this.first=t},m(m,_){W(m,t,_),a[n].m(m,_),W(m,s,_),c=!0},p(m,_){e=m;let w=n;n=f(e),n===w?a[n].p(e,_):(K(),p(a[w],1,1,()=>{a[w]=null}),L(),r=a[n],r?r.p(e,_):(r=a[n]=u[n](e),r.c()),h(r,1),r.m(s.parentNode,s))},i(m){c||(h(r),c=!0)},o(m){p(r),c=!1},d(m){m&&(I(t),I(s)),a[n].d(m)}}}function pt(o){let e,t=[],n=new Map,r,s=N(o[0]);const c=u=>u[20];for(let u=0;u<s.length;u+=1){let a=D(o,s,u),f=c(a);n.set(f,t[u]=V(f,a))}return{c(){e=Z("div");for(let u=0;u<t.length;u+=1)t[u].c();this.h()},l(u){e=x(u,"DIV",{class:!0});var a=$(e);for(let f=0;f<t.length;f+=1)t[f].l(a);a.forEach(I),this.h()},h(){tt(e,"class","flex min-h-[24px] flex-wrap items-center gap-2")},m(u,a){W(u,e,a);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);r=!0},p(u,[a]){a&7&&(s=N(u[0]),K(),t=ot(t,a,c,1,u,s,n,e,st,V,null,D),L())},i(u){if(!r){for(let a=0;a<s.length;a+=1)h(t[a]);r=!0}},o(u){for(let a=0;a<t.length;a+=1)p(t[a]);r=!1},d(u){u&&I(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}const j=5,S=100;function dt(o,e,t){let n,r,s,c,u,a;y(o,ut,l=>t(6,s=l)),y(o,b,l=>t(13,c=l)),y(o,ct,l=>t(7,u=l)),y(o,rt,l=>t(8,a=l));let{staticQuery:f=""}=e,m=[],_=[],w,d=1,g=!1;et(()=>{E()});const R=()=>{if(d+=1,clearInterval(w),d<=S){const l=A(j,d,S)*1e3;w=setInterval(()=>G(),l)}},E=()=>{clearInterval(w),t(1,_=[]),v(b,c.newCount=0,c),d=1,t(2,g=!0)},F=(l=[])=>l.map(i=>{const k=lt(i==null?void 0:i.groupValues[0]),Y=parseInt(i.count);return{status:k,count:Y}}).sort((i,k)=>O.indexOf(i.status)-O.indexOf(k.status)),G=async()=>{R();try{const{count:l,groups:i}=await P({namespace:n,query:r});v(b,c.newCount=parseInt(l)-c.count,c),t(1,_=F(i))}catch(l){console.error("Fetching workflow counts failed: ",l==null?void 0:l.message)}finally{t(2,g=!1)}},T=async()=>{E();const l=A(j,d,S)*1e3;w=setInterval(()=>G(),l);try{const{count:i,groups:k}=await P({namespace:n,query:r});v(b,c.count=parseInt(i),c),t(0,m=F(k))}catch(i){console.error("Fetching workflow counts failed: ",i==null?void 0:i.message)}finally{t(2,g=!1)}},U=(l,i)=>i.status===l,X=(l,i)=>i.status===l;return o.$$set=l=>{"staticQuery"in l&&t(3,f=l.staticQuery)},o.$$.update=()=>{o.$$.dirty&256&&t(4,n=a.params.namespace),o.$$.dirty&136&&t(5,r=f||u),o.$$.dirty&112&&T()},[m,_,g,f,n,r,s,u,a,U,X]}class qt extends H{constructor(e){super(),J(this,e,dt,pt,z,{staticQuery:3})}}export{qt as W};
