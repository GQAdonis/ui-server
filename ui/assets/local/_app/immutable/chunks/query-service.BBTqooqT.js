import{e as y}from"./decode-payload.j1zQR9KS.js";import{h as d}from"./has.BWrERxPV.js";import{p as f,s as c}from"./parse-with-big-int.BKSBwM2t.js";import{r as l,a as p,b as m}from"./route-for-api.mE8MFNEO.js";const h=t=>{const e=t.indexOf("["),r=t.indexOf("]");return t.slice(e+1,r).split(" ").filter(a=>a!=="__stack_trace").map(a=>a.endsWith(",")?a.slice(0,a.length-1):a)},g=async(t,e,r)=>(e=await e,{namespace:t,workflowId:e.id,queryType:r});async function u({workflow:t,namespace:e,queryType:r,queryArgs:a},n=fetch,o){t=await t;const s=await g(e,t,r),i=l("query",s);return await p(i,{options:{method:"POST",body:c({execution:{workflowId:t.id,runId:t.runId},query:{queryType:r,queryArgs:a}})},request:n,onError:o,notifyOnError:!1})}async function x(t,e=fetch){return new Promise((r,a)=>{u({...t,queryType:"@@temporal-internal__list"},e,n=>{m(n.body)&&n.body.message.includes("@@temporal-internal__list")?r(h(n.body.message)):a(n)})})}async function _(t,e,r,a=fetch){return u(t,a).then(async n=>{const{queryResult:o}=n??{queryResult:{payloads:[]}};let s=o.payloads;try{if(s[0]){const i=await y({attributes:o,namespace:t.namespace,settings:e,accessToken:r});d(i,"payloads")&&Array.isArray(i.payloads)&&(s=i.payloads[0])}return f(s)}catch{return typeof s!="string"?c(s):s}})}async function A(t,e,r){return _({...t,queryType:"__stack_trace"},e,r)}export{x as a,_ as b,A as g};
