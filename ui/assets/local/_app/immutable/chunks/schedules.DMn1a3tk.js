import{w as v,g as P}from"./entry.Bg7PcWOf.js";import{t as $}from"./translate.BBe5dcco.js";import"./i18next.DhwiOCyc.js";import{s as S}from"./parse-with-big-int.BKSBwM2t.js";import{r as h,a as p}from"./route-for-api.uI4i8NLw.js";import{v as T}from"./toaster.Jycr_jGM.js";import{s as O}from"./workflows.CDC1Y6JJ.js";import{e as E}from"./encode-payload.C9pBgfDp.js";import{l as x,m as A}from"./route-for.BMvkHs3c.js";const H=async(e,o,t,s=fetch)=>(n=100,i="")=>{const a=h("schedules",{namespace:e});return p(a,{params:{maximumPageSize:String(n),nextPageToken:i,...o?{query:o}:{}},request:s,onError:t}).then(({schedules:r,nextPageToken:c})=>({items:r,nextPageToken:c?String(c):""}))};async function J(e,o=fetch){const t=h("schedule",e);return p(t,{request:o})}async function K(e,o=fetch){const t=h("schedule",e);return p(t,{request:o,options:{method:"DELETE"}})}async function _({namespace:e,scheduleId:o,body:t}){let s="";const n=r=>{var c;return s=((c=r==null?void 0:r.body)==null?void 0:c.message)??`Error creating schedule: ${r.status}: ${r.statusText}`},i=h("schedule",{namespace:e,scheduleId:o}),{conflictToken:a}=await p(i,{options:{method:"POST",body:S({request_id:T(),...t})},onError:n});return{conflictToken:a,error:s}}async function F({namespace:e,scheduleId:o,body:t}){let s="";const n=a=>{var r;return s=((r=a==null?void 0:a.body)==null?void 0:r.message)??`Error editing schedule: ${a.status}: ${a.statusText}`},i=h("schedule.edit",{namespace:e,scheduleId:o});return await p(i,{options:{method:"POST",body:S({request_id:T(),...t})},onError:n}),{error:s}}async function N({namespace:e,scheduleId:o,reason:t}){const s={patch:{pause:t}},n=h("schedule.patch",{namespace:e,scheduleId:o});return await p(n,{options:{method:"POST",body:S({...s,request_id:T()})},onError:i=>console.error(i)})}async function U({namespace:e,scheduleId:o,reason:t}){const s={patch:{unpause:t}},n=h("schedule.patch",{namespace:e,scheduleId:o});return await p(n,{options:{method:"POST",body:S({...s,request_id:T()})}})}async function V({namespace:e,scheduleId:o,overlapPolicy:t}){const s={patch:{triggerImmediately:{overlapPolicy:t}}},n=h("schedule.patch",{namespace:e,scheduleId:o});return await p(n,{options:{method:"POST",body:S({...s,request_id:T()})}})}async function X({namespace:e,scheduleId:o,overlapPolicy:t,startTime:s,endTime:n}){const i={patch:{backfillRequest:[{overlapPolicy:t,startTime:s,endTime:n}]}},a=h("schedule.patch",{namespace:e,scheduleId:o});return await p(a,{options:{method:"POST",body:S({...i,request_id:T()})}})}const b=e=>e?parseInt(e):0,M=(e,o,t,s)=>`${b(e)*60*60*24+b(o)*60*60+b(t)*60+b(s)}s`,W=({months:e=[],daysOfMonth:o=[],daysOfWeek:t=[]})=>{var r,c;const s=e.sort((l,u)=>parseInt(l)-parseInt(u)).join(","),n=o.sort((l,u)=>l-u).join(","),a=(((c=(r=t==null?void 0:t[0])==null?void 0:r.split(","))==null?void 0:c.length)>1?t[0].split(","):t).sort((l,u)=>parseInt(l)-parseInt(u)).join(",");return{month:s,dayOfMonth:n,dayOfWeek:a}},q=(e,o,t)=>{const{hour:s,minute:n,second:i,phase:a,cronString:r}=o,{preset:c,months:l,days:u,daysOfMonth:f,daysOfWeek:m}=t;if(c==="string"){const d=`${r}#${r}`;e.schedule.spec.cronString=[d],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(c==="interval"){const d=M(u,s,n,i);e.schedule.spec.interval=[{interval:d,phase:a||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:d,dayOfMonth:g,dayOfWeek:k}=W({months:l,daysOfMonth:f,daysOfWeek:m});e.schedule.spec.calendar=[{year:"*",month:c==="month"?d:"",dayOfMonth:c==="month"?g:"",dayOfWeek:c==="week"?k:"",hour:s,minute:n,second:i}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}},Y=async({action:e,spec:o,presets:t})=>{const{namespace:s,name:n,workflowId:i,workflowType:a,taskQueue:r,input:c,searchAttributes:l}=e;let u;if(c)try{u=await E(c)}catch(d){w.set(`${$("data-encoder.encode-error")}: ${d==null?void 0:d.message}`);return}const f={schedule_id:n.trim(),searchAttributes:l.length===0?null:{indexedFields:{...O(l)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:a},taskQueue:{name:r},input:u?{payloads:u}:null}}}};q(f,o,t),y.set(!0);const{error:m}=await _({scheduleId:n,namespace:s,body:f});m?(w.set(m),y.set(!1)):setTimeout(()=>{w.set(""),y.set(!1),P(x({namespace:s}))},2e3)},Z=async({action:e,spec:o,presets:t},s,n)=>{const{namespace:i,name:a,workflowId:r,workflowType:c,taskQueue:l,input:u,searchAttributes:f}=e;let m;if(u)try{m=await E(u)}catch(I){w.set(`${$("data-encoder.encode-error")}: ${I==null?void 0:I.message}`);return}const{preset:d}=t,g={schedule_id:n,searchAttributes:f.length===0?null:{indexedFields:{...O(f)}},schedule:{...s,action:{startWorkflow:{...s.action.startWorkflow,workflowId:r,workflowType:{name:c},taskQueue:{name:l},input:m?{payloads:m}:null}}}};d==="existing"?g.schedule.spec=s.spec:(q(g,o,t),g.schedule.spec.structuredCalendar=[]),y.set(!0);const{error:k}=await F({namespace:i,scheduleId:n,body:g});k?(w.set(k),y.set(!1)):setTimeout(()=>{P(A({namespace:i,scheduleId:a})),w.set(""),y.set(!1)},2e3)},y=v(!1),w=v(""),ee=v("0");export{Y as a,ee as b,H as c,K as d,w as e,J as f,X as g,y as l,N as p,Z as s,V as t,U as u};
