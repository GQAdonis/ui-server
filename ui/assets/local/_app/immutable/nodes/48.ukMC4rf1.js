import{s as ie,a1 as oe,M as fe,h as S,b as V,t as I,j as P,k as T,f as p,d as U,l as C,m as H,i as Q,n as u,q as le,T as me,c as ae,v as x}from"../chunks/scheduler.pPC3woXQ.js";import{S as ue,i as ce,f as pe,c as G,a as R,m as A,t as J,b as z,d as K}from"../chunks/index.Z3Qqxacm.js";import{g as re}from"../chunks/entry.6mxJxwSM.js";import{p as de}from"../chunks/stores.cW8AX6ex.js";import{P as ge}from"../chunks/page-title.cMwNI31f.js";import{t as w}from"../chunks/translate.HrioCK44.js";import{B as ne}from"../chunks/button.pYfDLC93.js";import{I as _e}from"../chunks/input.T-q3Sv8I.js";import{L as he}from"../chunks/link.k1D2UsV0.js";import{M as ve}from"../chunks/modal.TcRT4NOF.js";import{N as $e,e as be}from"../chunks/nexus-form.VbXYqMPc.js";import{j as se,h as Ne}from"../chunks/route-for.Gs4LHMCg.js";import{u as Ee,d as De}from"../chunks/nexus-service._nrvx1bI.js";import{n as Le}from"../chunks/namespaces.2VLJyoy1.js";import{e as we}from"../chunks/encode-payload.xDhwgfdU.js";function ke(e){let n=w("nexus.back-to-endpoint")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,i){Q(a,t,i)},p:x,d(a){a&&p(t)}}}function Ie(e){let n=w("nexus.delete-endpoint")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,i){Q(a,t,i)},p:x,d(a){a&&p(t)}}}function Ce(e){let n=w("common.save")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,i){Q(a,t,i)},p:x,d(a){a&&p(t)}}}function Me(e){let n=w("common.save")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,i){Q(a,t,i)},p:x,d(a){a&&p(t)}}}function Se(e){let n=w("common.cancel")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,i){Q(a,t,i)},p:x,d(a){a&&p(t)}}}function Ve(e){let n,t=w("nexus.delete-modal-title")+"",a;return{c(){n=S("h3"),a=I(t),this.h()},l(i){n=P(i,"H3",{slot:!0});var o=T(n);a=C(o,t),o.forEach(p),this.h()},h(){H(n,"slot","title")},m(i,o){Q(i,n,o),u(n,a)},p:x,d(i){i&&p(n)}}}function Pe(e){let n,t,a=w("nexus.delete-modal-confirmation-preface")+"",i,o,m,d=e[0].spec.name+"",c,h,E=w("nexus.delete-modal-confirmation-postface")+"",v,g,l,$=w("nexus.type-confirm-preface")+"",F,k,O,b=e[0].spec.name+"",r,Z,j=w("nexus.type-confirm-postface")+"",X,D,M,W,Y;function te(s){e[13](s)}let f={id:"delete-endpoint",labelHidden:!0,label:w("nexus.delete-endpoint")};return e[9]!==void 0&&(f.value=e[9]),M=new _e({props:f}),fe.push(()=>pe(M,"value",te)),{c(){n=S("div"),t=S("p"),i=I(a),o=V(),m=S("strong"),c=I(d),h=I(`?
      `),v=I(E),g=V(),l=S("p"),F=I($),k=V(),O=S("strong"),r=I(b),Z=V(),X=I(j),D=V(),G(M.$$.fragment),this.h()},l(s){n=P(s,"DIV",{slot:!0,class:!0});var _=T(n);t=P(_,"P",{});var L=T(t);i=C(L,a),o=U(L),m=P(L,"STRONG",{class:!0});var q=T(m);c=C(q,d),q.forEach(p),h=C(L,`?
      `),v=C(L,E),L.forEach(p),g=U(_),l=P(_,"P",{});var N=T(l);F=C(N,$),k=U(N),O=P(N,"STRONG",{class:!0});var B=T(O);r=C(B,b),B.forEach(p),Z=U(N),X=C(N,j),N.forEach(p),D=U(_),R(M.$$.fragment,_),_.forEach(p),this.h()},h(){H(m,"class","select-all"),H(O,"class","select-all"),H(n,"slot","content"),H(n,"class","flex flex-col gap-4")},m(s,_){Q(s,n,_),u(n,t),u(t,i),u(t,o),u(t,m),u(m,c),u(t,h),u(t,v),u(n,g),u(n,l),u(l,F),u(l,k),u(l,O),u(O,r),u(l,Z),u(l,X),u(n,D),A(M,n,null),Y=!0},p(s,_){(!Y||_&1)&&d!==(d=s[0].spec.name+"")&&le(c,d),(!Y||_&1)&&b!==(b=s[0].spec.name+"")&&le(r,b);const L={};!W&&_&512&&(W=!0,L.value=s[9],me(()=>W=!1)),M.$set(L)},i(s){Y||(J(M.$$.fragment,s),Y=!0)},o(s){z(M.$$.fragment,s),Y=!1},d(s){s&&p(n),K(M)}}}function Te(e){let n,t,a,i,o,m,d,c=e[0].spec.name+"",h,E,v,g,l,$,F,k,O,b,r,Z,j,X,D,M,W;a=new he({props:{href:se(e[10].params.id),icon:"chevron-left",$$slots:{default:[ke]},$$scope:{ctx:e}}}),g=new ne({props:{variant:"destructive",$$slots:{default:[Ie]},$$scope:{ctx:e}}}),g.$on("click",e[11]),$=new ne({props:{loading:e[6],$$slots:{default:[Ce]},$$scope:{ctx:e}}}),$.$on("click",function(){oe(e[3])&&e[3].apply(this,arguments)}),k=new $e({props:{endpoint:e[0],targetNamespaceList:e[1],callerNamespaceList:e[2],error:e[5],isCloud:e[7],nameDisabled:!0}}),r=new ne({props:{loading:e[6],$$slots:{default:[Me]},$$scope:{ctx:e}}}),r.$on("click",function(){oe(e[3])&&e[3].apply(this,arguments)}),j=new ne({props:{variant:"ghost",$$slots:{default:[Se]},$$scope:{ctx:e}}}),j.$on("click",e[12]);function Y(f){e[14](f)}let te={id:"delete-endpoint-modal",loading:e[6],confirmType:"destructive",confirmText:w("common.delete"),cancelText:w("common.cancel"),confirmDisabled:e[9]!==e[0].spec.name,$$slots:{content:[Pe],title:[Ve]},$$scope:{ctx:e}};return e[8]!==void 0&&(te.open=e[8]),D=new ve({props:te}),fe.push(()=>pe(D,"open",Y)),D.$on("confirmModal",function(){oe(e[4])&&e[4].apply(this,arguments)}),D.$on("cancelModal",e[15]),{c(){n=S("div"),t=S("div"),G(a.$$.fragment),i=V(),o=S("div"),m=S("div"),d=S("h1"),h=I(c),E=V(),v=S("div"),G(g.$$.fragment),l=V(),G($.$$.fragment),F=V(),G(k.$$.fragment),O=V(),b=S("div"),G(r.$$.fragment),Z=V(),G(j.$$.fragment),X=V(),G(D.$$.fragment),this.h()},l(f){n=P(f,"DIV",{class:!0});var s=T(n);t=P(s,"DIV",{class:!0});var _=T(t);R(a.$$.fragment,_),_.forEach(p),i=U(s),o=P(s,"DIV",{class:!0});var L=T(o);m=P(L,"DIV",{class:!0});var q=T(m);d=P(q,"H1",{"data-testid":!0});var N=T(d);h=C(N,c),N.forEach(p),E=U(q),v=P(q,"DIV",{class:!0});var B=T(v);R(g.$$.fragment,B),l=U(B),R($.$$.fragment,B),B.forEach(p),q.forEach(p),L.forEach(p),F=U(s),R(k.$$.fragment,s),O=U(s),b=P(s,"DIV",{class:!0});var y=T(b);R(r.$$.fragment,y),Z=U(y),R(j.$$.fragment,y),y.forEach(p),s.forEach(p),X=U(f),R(D.$$.fragment,f),this.h()},h(){H(t,"class","relative flex flex-col gap-4 text-sm"),H(d,"data-testid","namespace-selector-title"),H(v,"class","flex items-center gap-2"),H(m,"class","flex items-center justify-between"),H(o,"class","flex flex-col gap-1"),H(b,"class","flex items-center gap-4"),H(n,"class","flex flex-col gap-8")},m(f,s){Q(f,n,s),u(n,t),A(a,t,null),u(n,i),u(n,o),u(o,m),u(m,d),u(d,h),u(m,E),u(m,v),A(g,v,null),u(v,l),A($,v,null),u(n,F),A(k,n,null),u(n,O),u(n,b),A(r,b,null),u(b,Z),A(j,b,null),Q(f,X,s),A(D,f,s),W=!0},p(f,[s]){e=f;const _={};s&1024&&(_.href=se(e[10].params.id)),s&65536&&(_.$$scope={dirty:s,ctx:e}),a.$set(_),(!W||s&1)&&c!==(c=e[0].spec.name+"")&&le(h,c);const L={};s&65536&&(L.$$scope={dirty:s,ctx:e}),g.$set(L);const q={};s&64&&(q.loading=e[6]),s&65536&&(q.$$scope={dirty:s,ctx:e}),$.$set(q);const N={};s&1&&(N.endpoint=e[0]),s&2&&(N.targetNamespaceList=e[1]),s&4&&(N.callerNamespaceList=e[2]),s&32&&(N.error=e[5]),s&128&&(N.isCloud=e[7]),k.$set(N);const B={};s&64&&(B.loading=e[6]),s&65536&&(B.$$scope={dirty:s,ctx:e}),r.$set(B);const y={};s&65536&&(y.$$scope={dirty:s,ctx:e}),j.$set(y);const ee={};s&64&&(ee.loading=e[6]),s&513&&(ee.confirmDisabled=e[9]!==e[0].spec.name),s&66049&&(ee.$$scope={dirty:s,ctx:e}),!M&&s&256&&(M=!0,ee.open=e[8],me(()=>M=!1)),D.$set(ee)},i(f){W||(J(a.$$.fragment,f),J(g.$$.fragment,f),J($.$$.fragment,f),J(k.$$.fragment,f),J(r.$$.fragment,f),J(j.$$.fragment,f),J(D.$$.fragment,f),W=!0)},o(f){z(a.$$.fragment,f),z(g.$$.fragment,f),z($.$$.fragment,f),z(k.$$.fragment,f),z(r.$$.fragment,f),z(j.$$.fragment,f),z(D.$$.fragment,f),W=!1},d(f){f&&(p(n),p(X)),K(a),K(g),K($),K(k),K(r),K(j),K(D,f)}}}function Ue(e,n,t){let a;ae(e,de,r=>t(10,a=r));let{endpoint:i}=n,{targetNamespaceList:o=[]}=n,{callerNamespaceList:m=[]}=n,{onUpdate:d}=n,{onDelete:c}=n,{error:h=void 0}=n,{loading:E=!1}=n,{isCloud:v=!1}=n,g=!1,l="";const $=()=>t(8,g=!0),F=()=>re(se(a.params.id));function k(r){l=r,t(9,l)}function O(r){g=r,t(8,g)}const b=()=>t(8,g=!1);return e.$$set=r=>{"endpoint"in r&&t(0,i=r.endpoint),"targetNamespaceList"in r&&t(1,o=r.targetNamespaceList),"callerNamespaceList"in r&&t(2,m=r.callerNamespaceList),"onUpdate"in r&&t(3,d=r.onUpdate),"onDelete"in r&&t(4,c=r.onDelete),"error"in r&&t(5,h=r.error),"loading"in r&&t(6,E=r.loading),"isCloud"in r&&t(7,v=r.isCloud)},[i,o,m,d,c,h,E,v,g,l,a,$,F,k,O,b]}class Fe extends ue{constructor(n){super(),ce(this,n,Ue,Te,ie,{endpoint:0,targetNamespaceList:1,callerNamespaceList:2,onUpdate:3,onDelete:4,error:5,loading:6,isCloud:7})}}function Oe(e){let n,t,a,i;return n=new ge({props:{title:`Edit ${w("nexus.nexus-endpoint",{id:e[4].params.id})}`,url:e[4].url.href}}),a=new Fe({props:{endpoint:e[3],loading:e[1],targetNamespaceList:e[2],onUpdate:e[5],onDelete:e[6],error:e[0]}}),{c(){G(n.$$.fragment),t=V(),G(a.$$.fragment)},l(o){R(n.$$.fragment,o),t=U(o),R(a.$$.fragment,o)},m(o,m){A(n,o,m),Q(o,t,m),A(a,o,m),i=!0},p(o,[m]){const d={};m&16&&(d.title=`Edit ${w("nexus.nexus-endpoint",{id:o[4].params.id})}`),m&16&&(d.url=o[4].url.href),n.$set(d);const c={};m&8&&(c.endpoint=o[3]),m&2&&(c.loading=o[1]),m&4&&(c.targetNamespaceList=o[2]),m&1&&(c.error=o[0]),a.$set(c)},i(o){i||(J(n.$$.fragment,o),J(a.$$.fragment,o),i=!0)},o(o){z(n.$$.fragment,o),z(a.$$.fragment,o),i=!1},d(o){o&&p(t),K(n,o),K(a,o)}}}function je(e,n,t){let a,i,o,m,d;ae(e,Le,l=>t(8,o=l)),ae(e,be,l=>t(9,m=l)),ae(e,de,l=>t(4,d=l));let{data:c}=n,h,E=!1;const v=async()=>{t(0,h=void 0),t(1,E=!0);const l={...m};l.id=a.id,l.version=a.version;const $=await we(JSON.stringify(l.spec.descriptionString));l.spec.description=$[0],delete l.spec.allowedCallerNamespaces,delete l.spec.descriptionString;try{await Ee(a.id,l),re(se(a.id),{invalidateAll:!0})}catch(F){t(0,h=F),console.error("Error updating endpoint",F)}finally{t(1,E=!1)}},g=async()=>{t(0,h=void 0),t(1,E=!0);try{await De(a.id,a.version),re(Ne())}catch(l){t(0,h=l),console.error("Error deleting endpoint",l)}finally{t(1,E=!1)}};return e.$$set=l=>{"data"in l&&t(7,c=l.data)},e.$$.update=()=>{e.$$.dirty&128&&t(3,{endpoint:a}=c,a),e.$$.dirty&256&&t(2,i=o.map(l=>({namespace:l.namespaceInfo.name})))},[h,E,i,a,d,v,g,c,o]}class xe extends ue{constructor(n){super(),ce(this,n,je,Oe,ie,{data:7})}}export{xe as component};
