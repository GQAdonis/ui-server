import{s as ie,a1 as oe,M as fe,h as M,b as S,t as I,j as V,k as T,f as d,d as U,l as C,m as A,i as Q,n as u,q as le,T as me,c as ae,v as x}from"../chunks/scheduler.pPC3woXQ.js";import{S as ue,i as ce,f as de,c as z,a as B,m as G,t as Z,b as J,d as K}from"../chunks/index.Z3Qqxacm.js";import{g as re}from"../chunks/entry.HQBLYeUO.js";import{p as pe}from"../chunks/stores.3diGBG_X.js";import{P as ge}from"../chunks/page-title.cMwNI31f.js";import{t as k}from"../chunks/translate.HrioCK44.js";import{B as ne}from"../chunks/button.565fa2mv.js";import{I as _e}from"../chunks/input.q3-b_suw.js";import{L as he}from"../chunks/link.xs8Rl6pq.js";import{M as ve}from"../chunks/modal.GfaekHbx.js";import{N as $e,e as be}from"../chunks/nexus-form.K6wtonYK.js";import{j as se,h as Ne}from"../chunks/route-for.XkRJon6W.js";import{u as Ee,d as De}from"../chunks/nexus-service.UR1eg50e.js";import{n as Le}from"../chunks/namespaces._YswftEZ.js";import{e as we}from"../chunks/encode-payload.5pzk6i80.js";function ke(e){let n=k("nexus.back-to-endpoint")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,r){Q(a,t,r)},p:x,d(a){a&&d(t)}}}function Pe(e){let n=k("nexus.delete-endpoint")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,r){Q(a,t,r)},p:x,d(a){a&&d(t)}}}function Ie(e){let n=k("common.save")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,r){Q(a,t,r)},p:x,d(a){a&&d(t)}}}function Ce(e){let n=k("common.save")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,r){Q(a,t,r)},p:x,d(a){a&&d(t)}}}function Re(e){let n=k("common.cancel")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,r){Q(a,t,r)},p:x,d(a){a&&d(t)}}}function Me(e){let n,t=k("nexus.delete-modal-title")+"",a;return{c(){n=M("h3"),a=I(t),this.h()},l(r){n=V(r,"H3",{slot:!0});var o=T(n);a=C(o,t),o.forEach(d),this.h()},h(){A(n,"slot","title")},m(r,o){Q(r,n,o),u(n,a)},p:x,d(r){r&&d(n)}}}function Se(e){let n,t,a=k("nexus.delete-modal-confirmation-preface")+"",r,o,f,p=e[0].spec.name+"",c,v,D=k("nexus.delete-modal-confirmation-postface")+"",$,_,l,h=k("nexus.type-confirm-preface")+"",F,P,O,N=e[0].spec.name+"",E,m,j=k("nexus.type-confirm-postface")+"",X,L,R,W,Y;function te(s){e[14](s)}let i={id:"delete-endpoint",labelHidden:!0,label:k("nexus.delete-endpoint")};return e[10]!==void 0&&(i.value=e[10]),R=new _e({props:i}),fe.push(()=>de(R,"value",te)),{c(){n=M("div"),t=M("p"),r=I(a),o=S(),f=M("strong"),c=I(p),v=I(`?
      `),$=I(D),_=S(),l=M("p"),F=I(h),P=S(),O=M("strong"),E=I(N),m=S(),X=I(j),L=S(),z(R.$$.fragment),this.h()},l(s){n=V(s,"DIV",{slot:!0,class:!0});var g=T(n);t=V(g,"P",{});var w=T(t);r=C(w,a),o=U(w),f=V(w,"STRONG",{class:!0});var H=T(f);c=C(H,p),H.forEach(d),v=C(w,`?
      `),$=C(w,D),w.forEach(d),_=U(g),l=V(g,"P",{});var b=T(l);F=C(b,h),P=U(b),O=V(b,"STRONG",{class:!0});var q=T(O);E=C(q,N),q.forEach(d),m=U(b),X=C(b,j),b.forEach(d),L=U(g),B(R.$$.fragment,g),g.forEach(d),this.h()},h(){A(f,"class","select-all"),A(O,"class","select-all"),A(n,"slot","content"),A(n,"class","flex flex-col gap-4")},m(s,g){Q(s,n,g),u(n,t),u(t,r),u(t,o),u(t,f),u(f,c),u(t,v),u(t,$),u(n,_),u(n,l),u(l,F),u(l,P),u(l,O),u(O,E),u(l,m),u(l,X),u(n,L),G(R,n,null),Y=!0},p(s,g){(!Y||g&1)&&p!==(p=s[0].spec.name+"")&&le(c,p),(!Y||g&1)&&N!==(N=s[0].spec.name+"")&&le(E,N);const w={};!W&&g&1024&&(W=!0,w.value=s[10],me(()=>W=!1)),R.$set(w)},i(s){Y||(Z(R.$$.fragment,s),Y=!0)},o(s){J(R.$$.fragment,s),Y=!1},d(s){s&&d(n),K(R)}}}function Ve(e){let n,t,a,r,o,f,p,c=e[0].spec.name+"",v,D,$,_,l,h,F,P,O,N,E,m,j,X,L,R,W;a=new he({props:{href:se(e[11].params.id),icon:"chevron-left",$$slots:{default:[ke]},$$scope:{ctx:e}}}),_=new ne({props:{variant:"destructive",$$slots:{default:[Pe]},$$scope:{ctx:e}}}),_.$on("click",e[12]),h=new ne({props:{loading:e[6],$$slots:{default:[Ie]},$$scope:{ctx:e}}}),h.$on("click",function(){oe(e[3])&&e[3].apply(this,arguments)}),P=new $e({props:{endpoint:e[0],nameRegexPattern:e[8],targetNamespaceList:e[1],callerNamespaceList:e[2],error:e[5],isCloud:e[7],nameDisabled:!0}}),E=new ne({props:{loading:e[6],$$slots:{default:[Ce]},$$scope:{ctx:e}}}),E.$on("click",function(){oe(e[3])&&e[3].apply(this,arguments)}),j=new ne({props:{variant:"ghost",$$slots:{default:[Re]},$$scope:{ctx:e}}}),j.$on("click",e[13]);function Y(i){e[15](i)}let te={id:"delete-endpoint-modal",loading:e[6],confirmType:"destructive",confirmText:k("common.delete"),cancelText:k("common.cancel"),confirmDisabled:e[10]!==e[0].spec.name,$$slots:{content:[Se],title:[Me]},$$scope:{ctx:e}};return e[9]!==void 0&&(te.open=e[9]),L=new ve({props:te}),fe.push(()=>de(L,"open",Y)),L.$on("confirmModal",function(){oe(e[4])&&e[4].apply(this,arguments)}),L.$on("cancelModal",e[16]),{c(){n=M("div"),t=M("div"),z(a.$$.fragment),r=S(),o=M("div"),f=M("div"),p=M("h1"),v=I(c),D=S(),$=M("div"),z(_.$$.fragment),l=S(),z(h.$$.fragment),F=S(),z(P.$$.fragment),O=S(),N=M("div"),z(E.$$.fragment),m=S(),z(j.$$.fragment),X=S(),z(L.$$.fragment),this.h()},l(i){n=V(i,"DIV",{class:!0});var s=T(n);t=V(s,"DIV",{class:!0});var g=T(t);B(a.$$.fragment,g),g.forEach(d),r=U(s),o=V(s,"DIV",{class:!0});var w=T(o);f=V(w,"DIV",{class:!0});var H=T(f);p=V(H,"H1",{"data-testid":!0});var b=T(p);v=C(b,c),b.forEach(d),D=U(H),$=V(H,"DIV",{class:!0});var q=T($);B(_.$$.fragment,q),l=U(q),B(h.$$.fragment,q),q.forEach(d),H.forEach(d),w.forEach(d),F=U(s),B(P.$$.fragment,s),O=U(s),N=V(s,"DIV",{class:!0});var y=T(N);B(E.$$.fragment,y),m=U(y),B(j.$$.fragment,y),y.forEach(d),s.forEach(d),X=U(i),B(L.$$.fragment,i),this.h()},h(){A(t,"class","relative flex flex-col gap-4 text-sm"),A(p,"data-testid","namespace-selector-title"),A($,"class","flex items-center gap-2"),A(f,"class","flex items-center justify-between"),A(o,"class","flex flex-col gap-1"),A(N,"class","flex items-center gap-4"),A(n,"class","flex flex-col gap-8")},m(i,s){Q(i,n,s),u(n,t),G(a,t,null),u(n,r),u(n,o),u(o,f),u(f,p),u(p,v),u(f,D),u(f,$),G(_,$,null),u($,l),G(h,$,null),u(n,F),G(P,n,null),u(n,O),u(n,N),G(E,N,null),u(N,m),G(j,N,null),Q(i,X,s),G(L,i,s),W=!0},p(i,[s]){e=i;const g={};s&2048&&(g.href=se(e[11].params.id)),s&131072&&(g.$$scope={dirty:s,ctx:e}),a.$set(g),(!W||s&1)&&c!==(c=e[0].spec.name+"")&&le(v,c);const w={};s&131072&&(w.$$scope={dirty:s,ctx:e}),_.$set(w);const H={};s&64&&(H.loading=e[6]),s&131072&&(H.$$scope={dirty:s,ctx:e}),h.$set(H);const b={};s&1&&(b.endpoint=e[0]),s&256&&(b.nameRegexPattern=e[8]),s&2&&(b.targetNamespaceList=e[1]),s&4&&(b.callerNamespaceList=e[2]),s&32&&(b.error=e[5]),s&128&&(b.isCloud=e[7]),P.$set(b);const q={};s&64&&(q.loading=e[6]),s&131072&&(q.$$scope={dirty:s,ctx:e}),E.$set(q);const y={};s&131072&&(y.$$scope={dirty:s,ctx:e}),j.$set(y);const ee={};s&64&&(ee.loading=e[6]),s&1025&&(ee.confirmDisabled=e[10]!==e[0].spec.name),s&132097&&(ee.$$scope={dirty:s,ctx:e}),!R&&s&512&&(R=!0,ee.open=e[9],me(()=>R=!1)),L.$set(ee)},i(i){W||(Z(a.$$.fragment,i),Z(_.$$.fragment,i),Z(h.$$.fragment,i),Z(P.$$.fragment,i),Z(E.$$.fragment,i),Z(j.$$.fragment,i),Z(L.$$.fragment,i),W=!0)},o(i){J(a.$$.fragment,i),J(_.$$.fragment,i),J(h.$$.fragment,i),J(P.$$.fragment,i),J(E.$$.fragment,i),J(j.$$.fragment,i),J(L.$$.fragment,i),W=!1},d(i){i&&(d(n),d(X)),K(a),K(_),K(h),K(P),K(E),K(j),K(L,i)}}}function Te(e,n,t){let a;ae(e,pe,m=>t(11,a=m));let{endpoint:r}=n,{targetNamespaceList:o=[]}=n,{callerNamespaceList:f=[]}=n,{onUpdate:p}=n,{onDelete:c}=n,{error:v=void 0}=n,{loading:D=!1}=n,{isCloud:$=!1}=n,{nameRegexPattern:_=/^[A-Za-z_][A-Za-z0-9_]*$/}=n,l=!1,h="";const F=()=>t(9,l=!0),P=()=>re(se(a.params.id));function O(m){h=m,t(10,h)}function N(m){l=m,t(9,l)}const E=()=>t(9,l=!1);return e.$$set=m=>{"endpoint"in m&&t(0,r=m.endpoint),"targetNamespaceList"in m&&t(1,o=m.targetNamespaceList),"callerNamespaceList"in m&&t(2,f=m.callerNamespaceList),"onUpdate"in m&&t(3,p=m.onUpdate),"onDelete"in m&&t(4,c=m.onDelete),"error"in m&&t(5,v=m.error),"loading"in m&&t(6,D=m.loading),"isCloud"in m&&t(7,$=m.isCloud),"nameRegexPattern"in m&&t(8,_=m.nameRegexPattern)},[r,o,f,p,c,v,D,$,_,l,h,a,F,P,O,N,E]}class Ue extends ue{constructor(n){super(),ce(this,n,Te,Ve,ie,{endpoint:0,targetNamespaceList:1,callerNamespaceList:2,onUpdate:3,onDelete:4,error:5,loading:6,isCloud:7,nameRegexPattern:8})}}function Fe(e){let n,t,a,r;return n=new ge({props:{title:`Edit ${k("nexus.nexus-endpoint",{id:e[4].params.id})}`,url:e[4].url.href}}),a=new Ue({props:{endpoint:e[3],loading:e[1],targetNamespaceList:e[2],onUpdate:e[5],onDelete:e[6],error:e[0]}}),{c(){z(n.$$.fragment),t=S(),z(a.$$.fragment)},l(o){B(n.$$.fragment,o),t=U(o),B(a.$$.fragment,o)},m(o,f){G(n,o,f),Q(o,t,f),G(a,o,f),r=!0},p(o,[f]){const p={};f&16&&(p.title=`Edit ${k("nexus.nexus-endpoint",{id:o[4].params.id})}`),f&16&&(p.url=o[4].url.href),n.$set(p);const c={};f&8&&(c.endpoint=o[3]),f&2&&(c.loading=o[1]),f&4&&(c.targetNamespaceList=o[2]),f&1&&(c.error=o[0]),a.$set(c)},i(o){r||(Z(n.$$.fragment,o),Z(a.$$.fragment,o),r=!0)},o(o){J(n.$$.fragment,o),J(a.$$.fragment,o),r=!1},d(o){o&&d(t),K(n,o),K(a,o)}}}function Oe(e,n,t){let a,r,o,f,p;ae(e,Le,l=>t(8,o=l)),ae(e,be,l=>t(9,f=l)),ae(e,pe,l=>t(4,p=l));let{data:c}=n,v,D=!1;const $=async()=>{t(0,v=void 0),t(1,D=!0);const l={...f};l.id=a.id,l.version=a.version;const h=await we(JSON.stringify(l.spec.descriptionString));l.spec.description=h[0],delete l.spec.allowedCallerNamespaces,delete l.spec.descriptionString;try{await Ee(a.id,l),re(se(a.id),{invalidateAll:!0})}catch(F){t(0,v=F),console.error("Error updating endpoint",F)}finally{t(1,D=!1)}},_=async()=>{t(0,v=void 0),t(1,D=!0);try{await De(a.id,a.version),re(Ne())}catch(l){t(0,v=l),console.error("Error deleting endpoint",l)}finally{t(1,D=!1)}};return e.$$set=l=>{"data"in l&&t(7,c=l.data)},e.$$.update=()=>{e.$$.dirty&128&&t(3,{endpoint:a}=c,a),e.$$.dirty&256&&t(2,r=o.map(l=>({namespace:l.namespaceInfo.name})))},[v,D,r,a,p,$,_,c,o]}class xe extends ue{constructor(n){super(),ce(this,n,Oe,Fe,ie,{data:7})}}export{xe as component};
