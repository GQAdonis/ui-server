import{s as ie,W as oe,M as fe,h as R,b as M,t as T,j as S,k as V,f as d,d as U,l as C,m as A,i as W,n as u,q as le,N as me,c as ae,v as x}from"../chunks/scheduler.BTg3iwM1.js";import{S as ue,i as ce,f as de,c as z,a as Z,m as q,t as B,b as G,d as J}from"../chunks/index.64bqrcBm.js";import{g as re}from"../chunks/entry.Bir9ei59.js";import{p as pe}from"../chunks/stores.BuJq-dpk.js";import{P as ge}from"../chunks/page-title.CzCBRjr4.js";import{t as D}from"../chunks/translate.BBe5dcco.js";import{B as ne}from"../chunks/button.Cf81qLf3.js";import{I as _e}from"../chunks/input.ConLYLRQ.js";import{L as he}from"../chunks/link.CWueJdfB.js";import{M as ve}from"../chunks/modal.CVrl9EMM.js";import{N as be,e as Ne}from"../chunks/nexus-form.DmhRn6T1.js";import{j as se,h as $e}from"../chunks/route-for.D5YJnlsv.js";import{u as Ee,d as De}from"../chunks/nexus-service.BF5K2t2D.js";import{n as Le}from"../chunks/namespaces.D2k25bvd.js";import{e as we}from"../chunks/encode-payload.D-NGb_Q7.js";function ke(e){let n=D("nexus.back-to-endpoint")+"",t;return{c(){t=T(n)},l(a){t=C(a,n)},m(a,i){W(a,t,i)},p:x,d(a){a&&d(t)}}}function Pe(e){let n=D("nexus.delete-endpoint")+"",t;return{c(){t=T(n)},l(a){t=C(a,n)},m(a,i){W(a,t,i)},p:x,d(a){a&&d(t)}}}function Ie(e){let n=D("common.save")+"",t;return{c(){t=T(n)},l(a){t=C(a,n)},m(a,i){W(a,t,i)},p:x,d(a){a&&d(t)}}}function Te(e){let n=D("common.save")+"",t;return{c(){t=T(n)},l(a){t=C(a,n)},m(a,i){W(a,t,i)},p:x,d(a){a&&d(t)}}}function Ce(e){let n=D("common.cancel")+"",t;return{c(){t=T(n)},l(a){t=C(a,n)},m(a,i){W(a,t,i)},p:x,d(a){a&&d(t)}}}function He(e){let n,t=D("nexus.delete-modal-title")+"",a;return{c(){n=R("h3"),a=T(t),this.h()},l(i){n=S(i,"H3",{slot:!0});var o=V(n);a=C(o,t),o.forEach(d),this.h()},h(){A(n,"slot","title")},m(i,o){W(i,n,o),u(n,a)},p:x,d(i){i&&d(n)}}}function Re(e){let n,t,a=D("nexus.delete-modal-confirmation-preface")+"",i,o,m,p=e[0].spec.name+"",c,b,L=D("nexus.delete-modal-confirmation-postface")+"",N,h,r,g=D("nexus.type-confirm-preface")+"",P,I,j,$=e[0].spec.name+"",E,K,l=D("nexus.type-confirm-postface")+"",X,w,H,Q,Y;function te(s){e[15](s)}let f={id:"delete-endpoint",labelHidden:!0,label:D("nexus.delete-endpoint")};return e[11]!==void 0&&(f.value=e[11]),H=new _e({props:f}),fe.push(()=>de(H,"value",te)),{c(){n=R("div"),t=R("p"),i=T(a),o=M(),m=R("strong"),c=T(p),b=T(`?
      `),N=T(L),h=M(),r=R("p"),P=T(g),I=M(),j=R("strong"),E=T($),K=M(),X=T(l),w=M(),z(H.$$.fragment),this.h()},l(s){n=S(s,"DIV",{slot:!0,class:!0});var _=V(n);t=S(_,"P",{});var k=V(t);i=C(k,a),o=U(k),m=S(k,"STRONG",{class:!0});var F=V(m);c=C(F,p),F.forEach(d),b=C(k,`?
      `),N=C(k,L),k.forEach(d),h=U(_),r=S(_,"P",{});var v=V(r);P=C(v,g),I=U(v),j=S(v,"STRONG",{class:!0});var O=V(j);E=C(O,$),O.forEach(d),K=U(v),X=C(v,l),v.forEach(d),w=U(_),Z(H.$$.fragment,_),_.forEach(d),this.h()},h(){A(m,"class","select-all"),A(j,"class","select-all"),A(n,"slot","content"),A(n,"class","flex flex-col gap-4")},m(s,_){W(s,n,_),u(n,t),u(t,i),u(t,o),u(t,m),u(m,c),u(t,b),u(t,N),u(n,h),u(n,r),u(r,P),u(r,I),u(r,j),u(j,E),u(r,K),u(r,X),u(n,w),q(H,n,null),Y=!0},p(s,_){(!Y||_&1)&&p!==(p=s[0].spec.name+"")&&le(c,p),(!Y||_&1)&&$!==($=s[0].spec.name+"")&&le(E,$);const k={};!Q&&_&2048&&(Q=!0,k.value=s[11],me(()=>Q=!1)),H.$set(k)},i(s){Y||(B(H.$$.fragment,s),Y=!0)},o(s){G(H.$$.fragment,s),Y=!1},d(s){s&&d(n),J(H)}}}function Me(e){let n,t,a,i,o,m,p,c=e[0].spec.name+"",b,L,N,h,r,g,P,I,j,$,E,K,l,X,w,H,Q;a=new he({props:{href:se(e[12].params.id),icon:"chevron-left",$$slots:{default:[ke]},$$scope:{ctx:e}}}),h=new ne({props:{variant:"destructive",$$slots:{default:[Pe]},$$scope:{ctx:e}}}),h.$on("click",e[13]),g=new ne({props:{loading:e[6],$$slots:{default:[Ie]},$$scope:{ctx:e}}}),g.$on("click",function(){oe(e[3])&&e[3].apply(this,arguments)}),I=new be({props:{endpoint:e[0],nameHintText:e[9],nameRegexPattern:e[8],targetNamespaceList:e[1],callerNamespaceList:e[2],error:e[5],isCloud:e[7],nameDisabled:!0}}),E=new ne({props:{loading:e[6],$$slots:{default:[Te]},$$scope:{ctx:e}}}),E.$on("click",function(){oe(e[3])&&e[3].apply(this,arguments)}),l=new ne({props:{variant:"ghost",$$slots:{default:[Ce]},$$scope:{ctx:e}}}),l.$on("click",e[14]);function Y(f){e[16](f)}let te={id:"delete-endpoint-modal",loading:e[6],confirmType:"destructive",confirmText:D("common.delete"),cancelText:D("common.cancel"),confirmDisabled:e[11]!==e[0].spec.name,$$slots:{content:[Re],title:[He]},$$scope:{ctx:e}};return e[10]!==void 0&&(te.open=e[10]),w=new ve({props:te}),fe.push(()=>de(w,"open",Y)),w.$on("confirmModal",function(){oe(e[4])&&e[4].apply(this,arguments)}),w.$on("cancelModal",e[17]),{c(){n=R("div"),t=R("div"),z(a.$$.fragment),i=M(),o=R("div"),m=R("div"),p=R("h1"),b=T(c),L=M(),N=R("div"),z(h.$$.fragment),r=M(),z(g.$$.fragment),P=M(),z(I.$$.fragment),j=M(),$=R("div"),z(E.$$.fragment),K=M(),z(l.$$.fragment),X=M(),z(w.$$.fragment),this.h()},l(f){n=S(f,"DIV",{class:!0});var s=V(n);t=S(s,"DIV",{class:!0});var _=V(t);Z(a.$$.fragment,_),_.forEach(d),i=U(s),o=S(s,"DIV",{class:!0});var k=V(o);m=S(k,"DIV",{class:!0});var F=V(m);p=S(F,"H1",{"data-testid":!0});var v=V(p);b=C(v,c),v.forEach(d),L=U(F),N=S(F,"DIV",{class:!0});var O=V(N);Z(h.$$.fragment,O),r=U(O),Z(g.$$.fragment,O),O.forEach(d),F.forEach(d),k.forEach(d),P=U(s),Z(I.$$.fragment,s),j=U(s),$=S(s,"DIV",{class:!0});var y=V($);Z(E.$$.fragment,y),K=U(y),Z(l.$$.fragment,y),y.forEach(d),s.forEach(d),X=U(f),Z(w.$$.fragment,f),this.h()},h(){A(t,"class","relative flex flex-col gap-4 text-sm"),A(p,"data-testid","namespace-selector-title"),A(N,"class","flex items-center gap-2"),A(m,"class","flex items-center justify-between"),A(o,"class","flex flex-col gap-1"),A($,"class","flex items-center gap-4"),A(n,"class","flex flex-col gap-8")},m(f,s){W(f,n,s),u(n,t),q(a,t,null),u(n,i),u(n,o),u(o,m),u(m,p),u(p,b),u(m,L),u(m,N),q(h,N,null),u(N,r),q(g,N,null),u(n,P),q(I,n,null),u(n,j),u(n,$),q(E,$,null),u($,K),q(l,$,null),W(f,X,s),q(w,f,s),Q=!0},p(f,[s]){e=f;const _={};s&4096&&(_.href=se(e[12].params.id)),s&262144&&(_.$$scope={dirty:s,ctx:e}),a.$set(_),(!Q||s&1)&&c!==(c=e[0].spec.name+"")&&le(b,c);const k={};s&262144&&(k.$$scope={dirty:s,ctx:e}),h.$set(k);const F={};s&64&&(F.loading=e[6]),s&262144&&(F.$$scope={dirty:s,ctx:e}),g.$set(F);const v={};s&1&&(v.endpoint=e[0]),s&512&&(v.nameHintText=e[9]),s&256&&(v.nameRegexPattern=e[8]),s&2&&(v.targetNamespaceList=e[1]),s&4&&(v.callerNamespaceList=e[2]),s&32&&(v.error=e[5]),s&128&&(v.isCloud=e[7]),I.$set(v);const O={};s&64&&(O.loading=e[6]),s&262144&&(O.$$scope={dirty:s,ctx:e}),E.$set(O);const y={};s&262144&&(y.$$scope={dirty:s,ctx:e}),l.$set(y);const ee={};s&64&&(ee.loading=e[6]),s&2049&&(ee.confirmDisabled=e[11]!==e[0].spec.name),s&264193&&(ee.$$scope={dirty:s,ctx:e}),!H&&s&1024&&(H=!0,ee.open=e[10],me(()=>H=!1)),w.$set(ee)},i(f){Q||(B(a.$$.fragment,f),B(h.$$.fragment,f),B(g.$$.fragment,f),B(I.$$.fragment,f),B(E.$$.fragment,f),B(l.$$.fragment,f),B(w.$$.fragment,f),Q=!0)},o(f){G(a.$$.fragment,f),G(h.$$.fragment,f),G(g.$$.fragment,f),G(I.$$.fragment,f),G(E.$$.fragment,f),G(l.$$.fragment,f),G(w.$$.fragment,f),Q=!1},d(f){f&&(d(n),d(X)),J(a),J(h),J(g),J(I),J(E),J(l),J(w,f)}}}function Se(e,n,t){let a;ae(e,pe,l=>t(12,a=l));let{endpoint:i}=n,{targetNamespaceList:o=[]}=n,{callerNamespaceList:m=[]}=n,{onUpdate:p}=n,{onDelete:c}=n,{error:b=void 0}=n,{loading:L=!1}=n,{isCloud:N=!1}=n,{nameRegexPattern:h=/^[a-zA-Z][a-zA-Z0-9-]*[a-zA-Z0-9]$/}=n,{nameHintText:r=D("nexus.endpoint-name-hint-with-dash")}=n,g=!1,P="";const I=()=>t(10,g=!0),j=()=>re(se(a.params.id));function $(l){P=l,t(11,P)}function E(l){g=l,t(10,g)}const K=()=>t(10,g=!1);return e.$$set=l=>{"endpoint"in l&&t(0,i=l.endpoint),"targetNamespaceList"in l&&t(1,o=l.targetNamespaceList),"callerNamespaceList"in l&&t(2,m=l.callerNamespaceList),"onUpdate"in l&&t(3,p=l.onUpdate),"onDelete"in l&&t(4,c=l.onDelete),"error"in l&&t(5,b=l.error),"loading"in l&&t(6,L=l.loading),"isCloud"in l&&t(7,N=l.isCloud),"nameRegexPattern"in l&&t(8,h=l.nameRegexPattern),"nameHintText"in l&&t(9,r=l.nameHintText)},[i,o,m,p,c,b,L,N,h,r,g,P,a,I,j,$,E,K]}class Ve extends ue{constructor(n){super(),ce(this,n,Se,Me,ie,{endpoint:0,targetNamespaceList:1,callerNamespaceList:2,onUpdate:3,onDelete:4,error:5,loading:6,isCloud:7,nameRegexPattern:8,nameHintText:9})}}function Ue(e){let n,t,a,i;return n=new ge({props:{title:`Edit ${D("nexus.nexus-endpoint",{id:e[4].params.id})}`,url:e[4].url.href}}),a=new Ve({props:{endpoint:e[3],loading:e[1],targetNamespaceList:e[2],onUpdate:e[5],onDelete:e[6],error:e[0]}}),{c(){z(n.$$.fragment),t=M(),z(a.$$.fragment)},l(o){Z(n.$$.fragment,o),t=U(o),Z(a.$$.fragment,o)},m(o,m){q(n,o,m),W(o,t,m),q(a,o,m),i=!0},p(o,[m]){const p={};m&16&&(p.title=`Edit ${D("nexus.nexus-endpoint",{id:o[4].params.id})}`),m&16&&(p.url=o[4].url.href),n.$set(p);const c={};m&8&&(c.endpoint=o[3]),m&2&&(c.loading=o[1]),m&4&&(c.targetNamespaceList=o[2]),m&1&&(c.error=o[0]),a.$set(c)},i(o){i||(B(n.$$.fragment,o),B(a.$$.fragment,o),i=!0)},o(o){G(n.$$.fragment,o),G(a.$$.fragment,o),i=!1},d(o){o&&d(t),J(n,o),J(a,o)}}}function je(e,n,t){let a,i,o,m,p;ae(e,Le,r=>t(8,o=r)),ae(e,Ne,r=>t(9,m=r)),ae(e,pe,r=>t(4,p=r));let{data:c}=n,b,L=!1;const N=async()=>{t(0,b=void 0),t(1,L=!0);const r={...m};r.id=a.id,r.version=a.version;const g=await we(JSON.stringify(r.spec.descriptionString),"json/plain");r.spec.description=g[0],delete r.spec.allowedCallerNamespaces,delete r.spec.descriptionString;try{await Ee(a.id,r),re(se(a.id),{invalidateAll:!0})}catch(P){t(0,b=P),console.error("Error updating endpoint",P)}finally{t(1,L=!1)}},h=async()=>{t(0,b=void 0),t(1,L=!0);try{await De(a.id,a.version),re($e())}catch(r){t(0,b=r),console.error("Error deleting endpoint",r)}finally{t(1,L=!1)}};return e.$$set=r=>{"data"in r&&t(7,c=r.data)},e.$$.update=()=>{e.$$.dirty&128&&t(3,{endpoint:a}=c,a),e.$$.dirty&256&&t(2,i=o.map(r=>({namespace:r.namespaceInfo.name})))},[b,L,i,a,p,N,h,c,o]}class xe extends ue{constructor(n){super(),ce(this,n,je,Ue,ie,{data:7})}}export{xe as component};
