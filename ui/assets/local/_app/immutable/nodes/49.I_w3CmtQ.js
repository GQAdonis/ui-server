import{s as x,a1 as U,h as A,b as R,t as j,j as V,k as z,f as L,d as S,l as q,m as B,i as D,n as C,c as Z,v as H}from"../chunks/scheduler.pPC3woXQ.js";import{S as G,i as K,c as b,a as $,m as w,t as k,b as P,d as v}from"../chunks/index.Z3Qqxacm.js";import{g as M}from"../chunks/entry.3tOnTt-b.js";import{p as W}from"../chunks/stores.09ACnm7Q.js";import{P as X}from"../chunks/page-title.cMwNI31f.js";import{t as F}from"../chunks/translate.HrioCK44.js";import{B as Q}from"../chunks/button.zLgHuv4A.js";import{L as Y}from"../chunks/link.zt3ihVpi.js";import{N as y,e as T}from"../chunks/nexus-form.kW7Tkzsq.js";import{h as J}from"../chunks/route-for.LtKT5wyP.js";import{c as ee}from"../chunks/nexus-service.b94yFG9c.js";import{n as te}from"../chunks/namespaces.wwc7NRIp.js";import{e as ae}from"../chunks/encode-payload.P_bW7c8N.js";function ne(e){let t=F("nexus.back-to-endpoints")+"",a;return{c(){a=j(t)},l(n){a=q(n,t)},m(n,s){D(n,a,s)},p:H,d(n){n&&L(a)}}}function re(e){let t=F("nexus.create-endpoint")+"",a;return{c(){a=j(t)},l(n){a=q(n,t)},m(n,s){D(n,a,s)},p:H,d(n){n&&L(a)}}}function se(e){let t=F("common.cancel")+"",a;return{c(){a=j(t)},l(n){a=q(n,t)},m(n,s){D(n,a,s)},p:H,d(n){n&&L(a)}}}function oe(e){let t,a,n,s,r,m=F("nexus.create-endpoint")+"",g,f,u,i,p,d,l,_,I;return n=new Y({props:{href:J(),icon:"chevron-left",$$slots:{default:[ne]},$$scope:{ctx:e}}}),u=new y({props:{nameRegexPattern:e[6],error:e[3],targetNamespaceList:e[1],callerNamespaceList:e[2],isCloud:e[5]}}),d=new Q({props:{variant:"primary",disabled:e[7],loading:e[4],$$slots:{default:[re]},$$scope:{ctx:e}}}),d.$on("click",function(){U(e[0])&&e[0].apply(this,arguments)}),_=new Q({props:{variant:"ghost",$$slots:{default:[se]},$$scope:{ctx:e}}}),_.$on("click",e[9]),{c(){t=A("div"),a=A("div"),b(n.$$.fragment),s=R(),r=A("h1"),g=j(m),f=R(),b(u.$$.fragment),i=R(),p=A("div"),b(d.$$.fragment),l=R(),b(_.$$.fragment),this.h()},l(c){t=V(c,"DIV",{class:!0});var o=z(t);a=V(o,"DIV",{class:!0});var E=z(a);$(n.$$.fragment,E),E.forEach(L),s=S(o),r=V(o,"H1",{"data-testid":!0});var h=z(r);g=q(h,m),h.forEach(L),f=S(o),$(u.$$.fragment,o),i=S(o),p=V(o,"DIV",{class:!0});var N=z(p);$(d.$$.fragment,N),l=S(N),$(_.$$.fragment,N),N.forEach(L),o.forEach(L),this.h()},h(){B(a,"class","text-sm"),B(r,"data-testid","namespace-selector-title"),B(p,"class","flex items-center gap-4"),B(t,"class","flex w-full flex-col gap-8")},m(c,o){D(c,t,o),C(t,a),w(n,a,null),C(t,s),C(t,r),C(r,g),C(t,f),w(u,t,null),C(t,i),C(t,p),w(d,p,null),C(p,l),w(_,p,null),I=!0},p(c,[o]){e=c;const E={};o&1024&&(E.$$scope={dirty:o,ctx:e}),n.$set(E);const h={};o&64&&(h.nameRegexPattern=e[6]),o&8&&(h.error=e[3]),o&2&&(h.targetNamespaceList=e[1]),o&4&&(h.callerNamespaceList=e[2]),o&32&&(h.isCloud=e[5]),u.$set(h);const N={};o&128&&(N.disabled=e[7]),o&16&&(N.loading=e[4]),o&1024&&(N.$$scope={dirty:o,ctx:e}),d.$set(N);const O={};o&1024&&(O.$$scope={dirty:o,ctx:e}),_.$set(O)},i(c){I||(k(n.$$.fragment,c),k(u.$$.fragment,c),k(d.$$.fragment,c),k(_.$$.fragment,c),I=!0)},o(c){P(n.$$.fragment,c),P(u.$$.fragment,c),P(d.$$.fragment,c),P(_.$$.fragment,c),I=!1},d(c){c&&L(t),v(n),v(u),v(d),v(_)}}}function ie(e,t,a){let n,s;Z(e,T,l=>a(8,s=l));let{onCreate:r}=t,{targetNamespaceList:m=[]}=t,{callerNamespaceList:g=[]}=t,{error:f=void 0}=t,{loading:u=!1}=t,{isCloud:i=!1}=t,{nameRegexPattern:p=/^[A-Za-z_][A-Za-z0-9_]*$/}=t;const d=()=>M(J());return e.$$set=l=>{"onCreate"in l&&a(0,r=l.onCreate),"targetNamespaceList"in l&&a(1,m=l.targetNamespaceList),"callerNamespaceList"in l&&a(2,g=l.callerNamespaceList),"error"in l&&a(3,f=l.error),"loading"in l&&a(4,u=l.loading),"isCloud"in l&&a(5,i=l.isCloud),"nameRegexPattern"in l&&a(6,p=l.nameRegexPattern)},e.$$.update=()=>{e.$$.dirty&256&&a(7,n=s.spec.name===""||s.spec.target.worker.namespace===""||s.spec.target.worker.taskQueue==="")},[r,m,g,f,u,i,p,n,s,d]}class le extends G{constructor(t){super(),K(this,t,ie,oe,x,{onCreate:0,targetNamespaceList:1,callerNamespaceList:2,error:3,loading:4,isCloud:5,nameRegexPattern:6})}}function me(e){let t,a,n,s;return t=new X({props:{title:F("nexus.create-endpoint"),url:e[3].url.href}}),n=new le({props:{onCreate:e[4],targetNamespaceList:e[2],error:e[0],loading:e[1]}}),{c(){b(t.$$.fragment),a=R(),b(n.$$.fragment)},l(r){$(t.$$.fragment,r),a=S(r),$(n.$$.fragment,r)},m(r,m){w(t,r,m),D(r,a,m),w(n,r,m),s=!0},p(r,[m]){const g={};m&8&&(g.url=r[3].url.href),t.$set(g);const f={};m&4&&(f.targetNamespaceList=r[2]),m&1&&(f.error=r[0]),m&2&&(f.loading=r[1]),n.$set(f)},i(r){s||(k(t.$$.fragment,r),k(n.$$.fragment,r),s=!0)},o(r){P(t.$$.fragment,r),P(n.$$.fragment,r),s=!1},d(r){r&&L(a),v(t,r),v(n,r)}}}function ce(e,t,a){let n,s,r,m;Z(e,te,i=>a(5,s=i)),Z(e,T,i=>a(6,r=i)),Z(e,W,i=>a(3,m=i));let g,f=!1;const u=async()=>{a(1,f=!0);try{const i={...r},p=await ae(JSON.stringify(i.spec.descriptionString));i.spec.description=p[0],delete i.spec.allowedCallerNamespaces,delete i.spec.descriptionString,await ee(i),M(J(),{invalidateAll:!0})}catch(i){a(0,g=i),console.error("Error creating endpoint",i)}finally{a(1,f=!1)}};return e.$$.update=()=>{e.$$.dirty&32&&a(2,n=s.map(i=>({namespace:i.namespaceInfo.name})))},[g,f,n,m,u,s]}class ke extends G{constructor(t){super(),K(this,t,ce,me,x,{})}}export{ke as component};
