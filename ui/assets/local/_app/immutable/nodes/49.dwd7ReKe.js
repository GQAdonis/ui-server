import{s as O,a1 as U,h as D,b as T,t as z,j as F,k as I,f as N,d as x,l as B,m as A,i as S,n as L,c as V,v as Z}from"../chunks/scheduler.QPr9T_9m.js";import{S as Q,i as G,c as C,a as b,m as w,t as k,b as P,d as v}from"../chunks/index.InrFPQ3N.js";import{g as K}from"../chunks/entry.b5zYybV1.js";import{p as W}from"../chunks/stores.GqmIu8RX.js";import{P as X}from"../chunks/page-title.XUhL_9zW.js";import{t as H}from"../chunks/translate.HrioCK44.js";import{B as J}from"../chunks/button.9a4lMgpF.js";import{L as Y}from"../chunks/link._pIjfKbw.js";import{N as y,e as M}from"../chunks/nexus-form.ovkW5Tnh.js";import{h as j}from"../chunks/route-for.F8m9c2OM.js";import{c as ee}from"../chunks/nexus-service.zYczuNwV.js";import{n as te}from"../chunks/namespaces.-PM2cfSP.js";import{e as ae}from"../chunks/encode-payload.1OJuKcat.js";function ne(e){let t=H("nexus.back-to-endpoints")+"",a;return{c(){a=z(t)},l(n){a=B(n,t)},m(n,i){S(n,a,i)},p:Z,d(n){n&&N(a)}}}function re(e){let t=H("nexus.create-endpoint")+"",a;return{c(){a=z(t)},l(n){a=B(n,t)},m(n,i){S(n,a,i)},p:Z,d(n){n&&N(a)}}}function se(e){let t=H("common.cancel")+"",a;return{c(){a=z(t)},l(n){a=B(n,t)},m(n,i){S(n,a,i)},p:Z,d(n){n&&N(a)}}}function oe(e){let t,a,n,i,r,m=H("nexus.create-endpoint")+"",p,c,u,l,g,d,E,s,$;return n=new Y({props:{href:j(),icon:"chevron-left",$$slots:{default:[ne]},$$scope:{ctx:e}}}),u=new y({props:{nameRegexPattern:e[6],nameHintText:e[7],error:e[3],targetNamespaceList:e[1],callerNamespaceList:e[2],isCloud:e[5]}}),d=new J({props:{variant:"primary",disabled:e[8],loading:e[4],$$slots:{default:[re]},$$scope:{ctx:e}}}),d.$on("click",function(){U(e[0])&&e[0].apply(this,arguments)}),s=new J({props:{variant:"ghost",$$slots:{default:[se]},$$scope:{ctx:e}}}),s.$on("click",e[10]),{c(){t=D("div"),a=D("div"),C(n.$$.fragment),i=T(),r=D("h1"),p=z(m),c=T(),C(u.$$.fragment),l=T(),g=D("div"),C(d.$$.fragment),E=T(),C(s.$$.fragment),this.h()},l(f){t=F(f,"DIV",{class:!0});var o=I(t);a=F(o,"DIV",{class:!0});var R=I(a);b(n.$$.fragment,R),R.forEach(N),i=x(o),r=F(o,"H1",{"data-testid":!0});var _=I(r);p=B(_,m),_.forEach(N),c=x(o),b(u.$$.fragment,o),l=x(o),g=F(o,"DIV",{class:!0});var h=I(g);b(d.$$.fragment,h),E=x(h),b(s.$$.fragment,h),h.forEach(N),o.forEach(N),this.h()},h(){A(a,"class","text-sm"),A(r,"data-testid","namespace-selector-title"),A(g,"class","flex items-center gap-4"),A(t,"class","flex w-full flex-col gap-8")},m(f,o){S(f,t,o),L(t,a),w(n,a,null),L(t,i),L(t,r),L(r,p),L(t,c),w(u,t,null),L(t,l),L(t,g),w(d,g,null),L(g,E),w(s,g,null),$=!0},p(f,[o]){e=f;const R={};o&2048&&(R.$$scope={dirty:o,ctx:e}),n.$set(R);const _={};o&64&&(_.nameRegexPattern=e[6]),o&128&&(_.nameHintText=e[7]),o&8&&(_.error=e[3]),o&2&&(_.targetNamespaceList=e[1]),o&4&&(_.callerNamespaceList=e[2]),o&32&&(_.isCloud=e[5]),u.$set(_);const h={};o&256&&(h.disabled=e[8]),o&16&&(h.loading=e[4]),o&2048&&(h.$$scope={dirty:o,ctx:e}),d.$set(h);const q={};o&2048&&(q.$$scope={dirty:o,ctx:e}),s.$set(q)},i(f){$||(k(n.$$.fragment,f),k(u.$$.fragment,f),k(d.$$.fragment,f),k(s.$$.fragment,f),$=!0)},o(f){P(n.$$.fragment,f),P(u.$$.fragment,f),P(d.$$.fragment,f),P(s.$$.fragment,f),$=!1},d(f){f&&N(t),v(n),v(u),v(d),v(s)}}}function ie(e,t,a){let n,i;V(e,M,s=>a(9,i=s));let{onCreate:r}=t,{targetNamespaceList:m=[]}=t,{callerNamespaceList:p=[]}=t,{error:c=void 0}=t,{loading:u=!1}=t,{isCloud:l=!1}=t,{nameRegexPattern:g=/^[A-Za-z_][A-Za-z0-9_]*$/}=t,{nameHintText:d=H("nexus.endpoint-name-hint")}=t;const E=()=>K(j());return e.$$set=s=>{"onCreate"in s&&a(0,r=s.onCreate),"targetNamespaceList"in s&&a(1,m=s.targetNamespaceList),"callerNamespaceList"in s&&a(2,p=s.callerNamespaceList),"error"in s&&a(3,c=s.error),"loading"in s&&a(4,u=s.loading),"isCloud"in s&&a(5,l=s.isCloud),"nameRegexPattern"in s&&a(6,g=s.nameRegexPattern),"nameHintText"in s&&a(7,d=s.nameHintText)},e.$$.update=()=>{e.$$.dirty&512&&a(8,n=i.spec.name===""||i.spec.target.worker.namespace===""||i.spec.target.worker.taskQueue==="")},[r,m,p,c,u,l,g,d,n,i,E]}class le extends Q{constructor(t){super(),G(this,t,ie,oe,O,{onCreate:0,targetNamespaceList:1,callerNamespaceList:2,error:3,loading:4,isCloud:5,nameRegexPattern:6,nameHintText:7})}}function me(e){let t,a,n,i;return t=new X({props:{title:H("nexus.create-endpoint"),url:e[3].url.href}}),n=new le({props:{onCreate:e[4],targetNamespaceList:e[2],error:e[0],loading:e[1]}}),{c(){C(t.$$.fragment),a=T(),C(n.$$.fragment)},l(r){b(t.$$.fragment,r),a=x(r),b(n.$$.fragment,r)},m(r,m){w(t,r,m),S(r,a,m),w(n,r,m),i=!0},p(r,[m]){const p={};m&8&&(p.url=r[3].url.href),t.$set(p);const c={};m&4&&(c.targetNamespaceList=r[2]),m&1&&(c.error=r[0]),m&2&&(c.loading=r[1]),n.$set(c)},i(r){i||(k(t.$$.fragment,r),k(n.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),P(n.$$.fragment,r),i=!1},d(r){r&&N(a),v(t,r),v(n,r)}}}function fe(e,t,a){let n,i,r,m;V(e,te,l=>a(5,i=l)),V(e,M,l=>a(6,r=l)),V(e,W,l=>a(3,m=l));let p,c=!1;const u=async()=>{a(1,c=!0);try{const l={...r},g=await ae(JSON.stringify(l.spec.descriptionString));l.spec.description=g[0],delete l.spec.allowedCallerNamespaces,delete l.spec.descriptionString,await ee(l),K(j(),{invalidateAll:!0})}catch(l){a(0,p=l),console.error("Error creating endpoint",l)}finally{a(1,c=!1)}};return e.$$.update=()=>{e.$$.dirty&32&&a(2,n=i.map(l=>({namespace:l.namespaceInfo.name})))},[p,c,n,m,u,i]}class Pe extends Q{constructor(t){super(),G(this,t,fe,me,O,{})}}export{Pe as component};
