import{s as ie,a1 as oe,L as fe,h as R,b as S,t as I,j as V,k as M,f as d,d as U,l as C,m as O,i as K,n as u,q as le,T as me,c as ae,v as x}from"../chunks/scheduler.QPr9T_9m.js";import{S as ue,i as ce,f as de,c as q,a as z,m as B,t as G,b as Z,d as J}from"../chunks/index.InrFPQ3N.js";import{g as re}from"../chunks/entry.uvj_FgnD.js";import{p as pe}from"../chunks/stores.JjWGYvR_.js";import{P as ge}from"../chunks/page-title.XUhL_9zW.js";import{t as L}from"../chunks/translate.HrioCK44.js";import{B as ne}from"../chunks/button.iIW0KbkM.js";import{I as _e}from"../chunks/input.xvs_iXcy.js";import{L as he}from"../chunks/link.L_koyPuO.js";import{M as ve}from"../chunks/modal.6JuBRHMj.js";import{N as be,e as Ne}from"../chunks/nexus-form.JY-Mnh-H.js";import{j as se,h as $e}from"../chunks/route-for.dHBHfClC.js";import{u as Ee,d as Le}from"../chunks/nexus-service.IJHwZqZc.js";import{n as De}from"../chunks/namespaces.8cn-da00.js";import{e as we}from"../chunks/encode-payload._lUdPNmv.js";function ke(e){let n=L("nexus.back-to-endpoint")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,i){K(a,t,i)},p:x,d(a){a&&d(t)}}}function Pe(e){let n=L("nexus.delete-endpoint")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,i){K(a,t,i)},p:x,d(a){a&&d(t)}}}function Te(e){let n=L("common.save")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,i){K(a,t,i)},p:x,d(a){a&&d(t)}}}function Ie(e){let n=L("common.save")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,i){K(a,t,i)},p:x,d(a){a&&d(t)}}}function Ce(e){let n=L("common.cancel")+"",t;return{c(){t=I(n)},l(a){t=C(a,n)},m(a,i){K(a,t,i)},p:x,d(a){a&&d(t)}}}function He(e){let n,t=L("nexus.delete-modal-title")+"",a;return{c(){n=R("h3"),a=I(t),this.h()},l(i){n=V(i,"H3",{slot:!0});var o=M(n);a=C(o,t),o.forEach(d),this.h()},h(){O(n,"slot","title")},m(i,o){K(i,n,o),u(n,a)},p:x,d(i){i&&d(n)}}}function Re(e){let n,t,a=L("nexus.delete-modal-confirmation-preface")+"",i,o,m,p=e[0].spec.name+"",c,b,D=L("nexus.delete-modal-confirmation-postface")+"",N,h,r,g=L("nexus.type-confirm-preface")+"",P,T,F,$=e[0].spec.name+"",E,Q,l=L("nexus.type-confirm-postface")+"",X,w,H,W,Y;function te(s){e[15](s)}let f={id:"delete-endpoint",labelHidden:!0,label:L("nexus.delete-endpoint")};return e[11]!==void 0&&(f.value=e[11]),H=new _e({props:f}),fe.push(()=>de(H,"value",te)),{c(){n=R("div"),t=R("p"),i=I(a),o=S(),m=R("strong"),c=I(p),b=I(`?
      `),N=I(D),h=S(),r=R("p"),P=I(g),T=S(),F=R("strong"),E=I($),Q=S(),X=I(l),w=S(),q(H.$$.fragment),this.h()},l(s){n=V(s,"DIV",{slot:!0,class:!0});var _=M(n);t=V(_,"P",{});var k=M(t);i=C(k,a),o=U(k),m=V(k,"STRONG",{class:!0});var j=M(m);c=C(j,p),j.forEach(d),b=C(k,`?
      `),N=C(k,D),k.forEach(d),h=U(_),r=V(_,"P",{});var v=M(r);P=C(v,g),T=U(v),F=V(v,"STRONG",{class:!0});var A=M(F);E=C(A,$),A.forEach(d),Q=U(v),X=C(v,l),v.forEach(d),w=U(_),z(H.$$.fragment,_),_.forEach(d),this.h()},h(){O(m,"class","select-all"),O(F,"class","select-all"),O(n,"slot","content"),O(n,"class","flex flex-col gap-4")},m(s,_){K(s,n,_),u(n,t),u(t,i),u(t,o),u(t,m),u(m,c),u(t,b),u(t,N),u(n,h),u(n,r),u(r,P),u(r,T),u(r,F),u(F,E),u(r,Q),u(r,X),u(n,w),B(H,n,null),Y=!0},p(s,_){(!Y||_&1)&&p!==(p=s[0].spec.name+"")&&le(c,p),(!Y||_&1)&&$!==($=s[0].spec.name+"")&&le(E,$);const k={};!W&&_&2048&&(W=!0,k.value=s[11],me(()=>W=!1)),H.$set(k)},i(s){Y||(G(H.$$.fragment,s),Y=!0)},o(s){Z(H.$$.fragment,s),Y=!1},d(s){s&&d(n),J(H)}}}function Se(e){let n,t,a,i,o,m,p,c=e[0].spec.name+"",b,D,N,h,r,g,P,T,F,$,E,Q,l,X,w,H,W;a=new he({props:{href:se(e[12].params.id),icon:"chevron-left",$$slots:{default:[ke]},$$scope:{ctx:e}}}),h=new ne({props:{variant:"destructive",$$slots:{default:[Pe]},$$scope:{ctx:e}}}),h.$on("click",e[13]),g=new ne({props:{loading:e[6],$$slots:{default:[Te]},$$scope:{ctx:e}}}),g.$on("click",function(){oe(e[3])&&e[3].apply(this,arguments)}),T=new be({props:{endpoint:e[0],nameHintText:e[9],nameRegexPattern:e[8],targetNamespaceList:e[1],callerNamespaceList:e[2],error:e[5],isCloud:e[7],nameDisabled:!0}}),E=new ne({props:{loading:e[6],$$slots:{default:[Ie]},$$scope:{ctx:e}}}),E.$on("click",function(){oe(e[3])&&e[3].apply(this,arguments)}),l=new ne({props:{variant:"ghost",$$slots:{default:[Ce]},$$scope:{ctx:e}}}),l.$on("click",e[14]);function Y(f){e[16](f)}let te={id:"delete-endpoint-modal",loading:e[6],confirmType:"destructive",confirmText:L("common.delete"),cancelText:L("common.cancel"),confirmDisabled:e[11]!==e[0].spec.name,$$slots:{content:[Re],title:[He]},$$scope:{ctx:e}};return e[10]!==void 0&&(te.open=e[10]),w=new ve({props:te}),fe.push(()=>de(w,"open",Y)),w.$on("confirmModal",function(){oe(e[4])&&e[4].apply(this,arguments)}),w.$on("cancelModal",e[17]),{c(){n=R("div"),t=R("div"),q(a.$$.fragment),i=S(),o=R("div"),m=R("div"),p=R("h1"),b=I(c),D=S(),N=R("div"),q(h.$$.fragment),r=S(),q(g.$$.fragment),P=S(),q(T.$$.fragment),F=S(),$=R("div"),q(E.$$.fragment),Q=S(),q(l.$$.fragment),X=S(),q(w.$$.fragment),this.h()},l(f){n=V(f,"DIV",{class:!0});var s=M(n);t=V(s,"DIV",{class:!0});var _=M(t);z(a.$$.fragment,_),_.forEach(d),i=U(s),o=V(s,"DIV",{class:!0});var k=M(o);m=V(k,"DIV",{class:!0});var j=M(m);p=V(j,"H1",{"data-testid":!0});var v=M(p);b=C(v,c),v.forEach(d),D=U(j),N=V(j,"DIV",{class:!0});var A=M(N);z(h.$$.fragment,A),r=U(A),z(g.$$.fragment,A),A.forEach(d),j.forEach(d),k.forEach(d),P=U(s),z(T.$$.fragment,s),F=U(s),$=V(s,"DIV",{class:!0});var y=M($);z(E.$$.fragment,y),Q=U(y),z(l.$$.fragment,y),y.forEach(d),s.forEach(d),X=U(f),z(w.$$.fragment,f),this.h()},h(){O(t,"class","relative flex flex-col gap-4 text-sm"),O(p,"data-testid","namespace-selector-title"),O(N,"class","flex items-center gap-2"),O(m,"class","flex items-center justify-between"),O(o,"class","flex flex-col gap-1"),O($,"class","flex items-center gap-4"),O(n,"class","flex flex-col gap-8")},m(f,s){K(f,n,s),u(n,t),B(a,t,null),u(n,i),u(n,o),u(o,m),u(m,p),u(p,b),u(m,D),u(m,N),B(h,N,null),u(N,r),B(g,N,null),u(n,P),B(T,n,null),u(n,F),u(n,$),B(E,$,null),u($,Q),B(l,$,null),K(f,X,s),B(w,f,s),W=!0},p(f,[s]){e=f;const _={};s&4096&&(_.href=se(e[12].params.id)),s&262144&&(_.$$scope={dirty:s,ctx:e}),a.$set(_),(!W||s&1)&&c!==(c=e[0].spec.name+"")&&le(b,c);const k={};s&262144&&(k.$$scope={dirty:s,ctx:e}),h.$set(k);const j={};s&64&&(j.loading=e[6]),s&262144&&(j.$$scope={dirty:s,ctx:e}),g.$set(j);const v={};s&1&&(v.endpoint=e[0]),s&512&&(v.nameHintText=e[9]),s&256&&(v.nameRegexPattern=e[8]),s&2&&(v.targetNamespaceList=e[1]),s&4&&(v.callerNamespaceList=e[2]),s&32&&(v.error=e[5]),s&128&&(v.isCloud=e[7]),T.$set(v);const A={};s&64&&(A.loading=e[6]),s&262144&&(A.$$scope={dirty:s,ctx:e}),E.$set(A);const y={};s&262144&&(y.$$scope={dirty:s,ctx:e}),l.$set(y);const ee={};s&64&&(ee.loading=e[6]),s&2049&&(ee.confirmDisabled=e[11]!==e[0].spec.name),s&264193&&(ee.$$scope={dirty:s,ctx:e}),!H&&s&1024&&(H=!0,ee.open=e[10],me(()=>H=!1)),w.$set(ee)},i(f){W||(G(a.$$.fragment,f),G(h.$$.fragment,f),G(g.$$.fragment,f),G(T.$$.fragment,f),G(E.$$.fragment,f),G(l.$$.fragment,f),G(w.$$.fragment,f),W=!0)},o(f){Z(a.$$.fragment,f),Z(h.$$.fragment,f),Z(g.$$.fragment,f),Z(T.$$.fragment,f),Z(E.$$.fragment,f),Z(l.$$.fragment,f),Z(w.$$.fragment,f),W=!1},d(f){f&&(d(n),d(X)),J(a),J(h),J(g),J(T),J(E),J(l),J(w,f)}}}function Ve(e,n,t){let a;ae(e,pe,l=>t(12,a=l));let{endpoint:i}=n,{targetNamespaceList:o=[]}=n,{callerNamespaceList:m=[]}=n,{onUpdate:p}=n,{onDelete:c}=n,{error:b=void 0}=n,{loading:D=!1}=n,{isCloud:N=!1}=n,{nameRegexPattern:h=/^[A-Za-z_][A-Za-z0-9_]*$/}=n,{nameHintText:r=L("nexus.endpoint-name-hint")}=n,g=!1,P="";const T=()=>t(10,g=!0),F=()=>re(se(a.params.id));function $(l){P=l,t(11,P)}function E(l){g=l,t(10,g)}const Q=()=>t(10,g=!1);return e.$$set=l=>{"endpoint"in l&&t(0,i=l.endpoint),"targetNamespaceList"in l&&t(1,o=l.targetNamespaceList),"callerNamespaceList"in l&&t(2,m=l.callerNamespaceList),"onUpdate"in l&&t(3,p=l.onUpdate),"onDelete"in l&&t(4,c=l.onDelete),"error"in l&&t(5,b=l.error),"loading"in l&&t(6,D=l.loading),"isCloud"in l&&t(7,N=l.isCloud),"nameRegexPattern"in l&&t(8,h=l.nameRegexPattern),"nameHintText"in l&&t(9,r=l.nameHintText)},[i,o,m,p,c,b,D,N,h,r,g,P,a,T,F,$,E,Q]}class Me extends ue{constructor(n){super(),ce(this,n,Ve,Se,ie,{endpoint:0,targetNamespaceList:1,callerNamespaceList:2,onUpdate:3,onDelete:4,error:5,loading:6,isCloud:7,nameRegexPattern:8,nameHintText:9})}}function Ue(e){let n,t,a,i;return n=new ge({props:{title:`Edit ${L("nexus.nexus-endpoint",{id:e[4].params.id})}`,url:e[4].url.href}}),a=new Me({props:{endpoint:e[3],loading:e[1],targetNamespaceList:e[2],onUpdate:e[5],onDelete:e[6],error:e[0]}}),{c(){q(n.$$.fragment),t=S(),q(a.$$.fragment)},l(o){z(n.$$.fragment,o),t=U(o),z(a.$$.fragment,o)},m(o,m){B(n,o,m),K(o,t,m),B(a,o,m),i=!0},p(o,[m]){const p={};m&16&&(p.title=`Edit ${L("nexus.nexus-endpoint",{id:o[4].params.id})}`),m&16&&(p.url=o[4].url.href),n.$set(p);const c={};m&8&&(c.endpoint=o[3]),m&2&&(c.loading=o[1]),m&4&&(c.targetNamespaceList=o[2]),m&1&&(c.error=o[0]),a.$set(c)},i(o){i||(G(n.$$.fragment,o),G(a.$$.fragment,o),i=!0)},o(o){Z(n.$$.fragment,o),Z(a.$$.fragment,o),i=!1},d(o){o&&d(t),J(n,o),J(a,o)}}}function Fe(e,n,t){let a,i,o,m,p;ae(e,De,r=>t(8,o=r)),ae(e,Ne,r=>t(9,m=r)),ae(e,pe,r=>t(4,p=r));let{data:c}=n,b,D=!1;const N=async()=>{t(0,b=void 0),t(1,D=!0);const r={...m};r.id=a.id,r.version=a.version;const g=await we(JSON.stringify(r.spec.descriptionString));r.spec.description=g[0],delete r.spec.allowedCallerNamespaces,delete r.spec.descriptionString;try{await Ee(a.id,r),re(se(a.id),{invalidateAll:!0})}catch(P){t(0,b=P),console.error("Error updating endpoint",P)}finally{t(1,D=!1)}},h=async()=>{t(0,b=void 0),t(1,D=!0);try{await Le(a.id,a.version),re($e())}catch(r){t(0,b=r),console.error("Error deleting endpoint",r)}finally{t(1,D=!1)}};return e.$$set=r=>{"data"in r&&t(7,c=r.data)},e.$$.update=()=>{e.$$.dirty&128&&t(3,{endpoint:a}=c,a),e.$$.dirty&256&&t(2,i=o.map(r=>({namespace:r.namespaceInfo.name})))},[b,D,i,a,p,N,h,c,o]}class xe extends ue{constructor(n){super(),ce(this,n,Fe,Ue,ie,{data:7})}}export{xe as component};
