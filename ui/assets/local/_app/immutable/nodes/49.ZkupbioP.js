import{s as K,a1 as W,h as V,b as S,t as H,j as B,k as j,f as h,d as D,l as J,m as q,i as F,n as $,c as A,v as Q}from"../chunks/scheduler.1T9hOnFr.js";import{S as M,i as R,c as L,a as C,m as b,t as w,b as k,d as v}from"../chunks/index.cVovwi_s.js";import{g as T}from"../chunks/entry.5XxhZjhB.js";import{p as X}from"../chunks/stores.dLjYtTtn.js";import{P as Y}from"../chunks/page-title.YnYjoVKm.js";import{t as I}from"../chunks/translate.HrioCK44.js";import{B as G}from"../chunks/button.WBI8CIW-.js";import{L as Z}from"../chunks/link.xl7lwh0e.js";import{N as x,e as U}from"../chunks/nexus-form.Q450UzWB.js";import{h as y}from"../chunks/route-for.NPjF-Sn4.js";import{c as ee}from"../chunks/nexus-service.qtQJHKBa.js";import{n as te}from"../chunks/namespaces.6Dxrvd01.js";import{e as ae}from"../chunks/encode-payload.kRNnFupN.js";function ne(e){let t=I("nexus.back-to-endpoints")+"",a;return{c(){a=H(t)},l(n){a=J(n,t)},m(n,r){F(n,a,r)},p:Q,d(n){n&&h(a)}}}function se(e){let t=I("nexus.create-endpoint")+"",a;return{c(){a=H(t)},l(n){a=J(n,t)},m(n,r){F(n,a,r)},p:Q,d(n){n&&h(a)}}}function re(e){let t=I("common.cancel")+"",a;return{c(){a=H(t)},l(n){a=J(n,t)},m(n,r){F(n,a,r)},p:Q,d(n){n&&h(a)}}}function oe(e){let t,a,n,r,s,c=I("nexus.create-endpoint")+"",p,f,u,i,g,o,O,d,P;return n=new Z({props:{href:y(),icon:"chevron-left",$$slots:{default:[ne]},$$scope:{ctx:e}}}),u=new x({props:{error:e[3],targetNamespaceList:e[1],callerNamespaceList:e[2],isCloud:e[5]}}),o=new G({props:{variant:"primary",disabled:e[6],loading:e[4],$$slots:{default:[se]},$$scope:{ctx:e}}}),o.$on("click",function(){W(e[0])&&e[0].apply(this,arguments)}),d=new G({props:{variant:"ghost",$$slots:{default:[re]},$$scope:{ctx:e}}}),d.$on("click",e[8]),{c(){t=V("div"),a=V("div"),L(n.$$.fragment),r=S(),s=V("h1"),p=H(c),f=S(),L(u.$$.fragment),i=S(),g=V("div"),L(o.$$.fragment),O=S(),L(d.$$.fragment),this.h()},l(m){t=B(m,"DIV",{class:!0});var l=j(t);a=B(l,"DIV",{class:!0});var E=j(a);C(n.$$.fragment,E),E.forEach(h),r=D(l),s=B(l,"H1",{"data-testid":!0});var N=j(s);p=J(N,c),N.forEach(h),f=D(l),C(u.$$.fragment,l),i=D(l),g=B(l,"DIV",{class:!0});var _=j(g);C(o.$$.fragment,_),O=D(_),C(d.$$.fragment,_),_.forEach(h),l.forEach(h),this.h()},h(){q(a,"class","text-sm"),q(s,"data-testid","namespace-selector-title"),q(g,"class","flex items-center gap-4"),q(t,"class","flex w-full flex-col gap-8")},m(m,l){F(m,t,l),$(t,a),b(n,a,null),$(t,r),$(t,s),$(s,p),$(t,f),b(u,t,null),$(t,i),$(t,g),b(o,g,null),$(g,O),b(d,g,null),P=!0},p(m,[l]){e=m;const E={};l&512&&(E.$$scope={dirty:l,ctx:e}),n.$set(E);const N={};l&8&&(N.error=e[3]),l&2&&(N.targetNamespaceList=e[1]),l&4&&(N.callerNamespaceList=e[2]),l&32&&(N.isCloud=e[5]),u.$set(N);const _={};l&64&&(_.disabled=e[6]),l&16&&(_.loading=e[4]),l&512&&(_.$$scope={dirty:l,ctx:e}),o.$set(_);const z={};l&512&&(z.$$scope={dirty:l,ctx:e}),d.$set(z)},i(m){P||(w(n.$$.fragment,m),w(u.$$.fragment,m),w(o.$$.fragment,m),w(d.$$.fragment,m),P=!0)},o(m){k(n.$$.fragment,m),k(u.$$.fragment,m),k(o.$$.fragment,m),k(d.$$.fragment,m),P=!1},d(m){m&&h(t),v(n),v(u),v(o),v(d)}}}function ie(e,t,a){let n,r;A(e,U,o=>a(7,r=o));let{onCreate:s}=t,{targetNamespaceList:c=[]}=t,{callerNamespaceList:p=[]}=t,{error:f=void 0}=t,{loading:u=!1}=t,{isCloud:i=!1}=t;const g=()=>T(y());return e.$$set=o=>{"onCreate"in o&&a(0,s=o.onCreate),"targetNamespaceList"in o&&a(1,c=o.targetNamespaceList),"callerNamespaceList"in o&&a(2,p=o.callerNamespaceList),"error"in o&&a(3,f=o.error),"loading"in o&&a(4,u=o.loading),"isCloud"in o&&a(5,i=o.isCloud)},e.$$.update=()=>{e.$$.dirty&128&&a(6,n=r.spec.name===""||r.spec.target.worker.namespace===""||r.spec.target.worker.taskQueue==="")},[s,c,p,f,u,i,n,r,g]}class le extends M{constructor(t){super(),R(this,t,ie,oe,K,{onCreate:0,targetNamespaceList:1,callerNamespaceList:2,error:3,loading:4,isCloud:5})}}function ce(e){let t,a,n,r;return t=new Y({props:{title:I("nexus.create-endpoint"),url:e[3].url.href}}),n=new le({props:{onCreate:e[4],targetNamespaceList:e[2],error:e[0],loading:e[1]}}),{c(){L(t.$$.fragment),a=S(),L(n.$$.fragment)},l(s){C(t.$$.fragment,s),a=D(s),C(n.$$.fragment,s)},m(s,c){b(t,s,c),F(s,a,c),b(n,s,c),r=!0},p(s,[c]){const p={};c&8&&(p.url=s[3].url.href),t.$set(p);const f={};c&4&&(f.targetNamespaceList=s[2]),c&1&&(f.error=s[0]),c&2&&(f.loading=s[1]),n.$set(f)},i(s){r||(w(t.$$.fragment,s),w(n.$$.fragment,s),r=!0)},o(s){k(t.$$.fragment,s),k(n.$$.fragment,s),r=!1},d(s){s&&h(a),v(t,s),v(n,s)}}}function me(e,t,a){let n,r,s,c;A(e,te,i=>a(5,r=i)),A(e,U,i=>a(6,s=i)),A(e,X,i=>a(3,c=i));let p,f=!1;const u=async()=>{a(1,f=!0);try{const i={...s},g=await ae(JSON.stringify(i.spec.descriptionString));i.spec.description=g[0],delete i.spec.allowedCallerNamespaces,delete i.spec.descriptionString,await ee(i),T(y(),{invalidateAll:!0})}catch(i){a(0,p=i),console.error("Error creating endpoint",i)}finally{a(1,f=!1)}};return e.$$.update=()=>{e.$$.dirty&32&&a(2,n=r.map(i=>({namespace:i.namespaceInfo.name})))},[p,f,n,c,u,r]}class ke extends M{constructor(t){super(),R(this,t,me,ce,K,{})}}export{ke as component};
